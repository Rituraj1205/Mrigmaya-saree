import{r as o,A as ue,C as pe,u as me,i as b,j as e,L as ee,a as ge,z as g}from"./index-a1a7f1c8.js";const te=r=>`Rs. ${new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(r||0)}`,re="data:image/gif;base64,R0lGODlhAQABAAD/ACw=",he=r=>ge(r,re),se={processing:"Processing",packed:"Packed",shipped:"Shipped",delivered:"Delivered",cancelled:"Cancelled"},ae={none:"No return",requested:"Return requested",approved:"Return approved",rejected:"Return rejected",received:"Item received",refunded:"Refunded"},be=r=>{if(r.status!=="delivered")return!1;const d=r.createdAt?new Date(r.createdAt).getTime():0;return(Date.now()-d)/(1e3*60*60*24)<=7},ye={cod_pending:"Awaiting COD",awaiting_upi:"Awaiting UPI",awaiting_gateway:"Awaiting gateway",paid:"Paid",cancelled:"Cancelled"},fe=r=>r!=null&&r.trackingLink&&r.trackingLink.startsWith("http")?r.trackingLink:r!=null&&r.trackingNumber&&r.trackingNumber.startsWith("http")?r.trackingNumber:null;function Ne(){const{token:r,user:d}=o.useContext(ue),{addToCart:D}=o.useContext(pe),A=me(),[y,_]=o.useState([]),[ne,q]=o.useState(!0),[I,O]=o.useState(""),[h,R]=o.useState(1),[f,S]=o.useState(1),[T,$]=o.useState(!1),[ie,C]=o.useState(null),[P,j]=o.useState(""),[B,N]=o.useState(""),[z,v]=o.useState(null),[E,F]=o.useState(!1),[w,le]=o.useState(null),x=r||localStorage.getItem("token");o.useEffect(()=>{if(!x){A("/login");return}let t=!0;return q(!0),b.get(`/orders?page=${h}&limit=10`,{headers:{Authorization:`Bearer ${x}`}}).then(a=>{if(!t)return;const s=a.data,i=Array.isArray(s)?s:s==null?void 0:s.orders;_(i||[]),s!=null&&s.totalPages?S(s.totalPages):S(1),O("")}).catch(()=>{t&&O("Could not load your orders right now.")}).finally(()=>t&&q(!1)),()=>{t=!1}},[x,A,h]);const U=["processing","packed","shipped","delivered"],M=o.useMemo(()=>[...y].sort((t,a)=>new Date(a.createdAt)-new Date(t.createdAt)),[y]),W=o.useMemo(()=>{const t=[],a=new Set,s=l=>String(l||"").trim().toLowerCase().replace(/\s+/g," "),i=l=>String(l||"").replace(/\D/g,"");return y.forEach(l=>{const n=l.shippingAddress||{},u=[s(n.name),i(n.phone||l.customerContact),s(n.line1),s(n.line2),s(n.city),s(n.state),s(n.pincode)].join("|");!n.name||a.has(u)||(a.add(u),t.push({key:u,...n}))}),t},[y]),ce=async t=>{var a;try{const s=t.items||[];for(const i of s){const l=((a=i.product)==null?void 0:a._id)||i.product;l&&await D(l,i.quantity||1)}g.success("Items added to cart"),A("/cart")}catch(s){console.error(s),g.error("Could not add items to cart")}},oe=async t=>{try{const a=await b.get(`/orders/${t}/invoice`,{headers:{Authorization:`Bearer ${x}`},responseType:"blob"}),s=new Blob([a.data],{type:"application/pdf"}),i=window.URL.createObjectURL(s),l=document.createElement("a");l.href=i,l.download=`invoice-${t.slice(-6)}.pdf`,document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(i)}catch(a){console.error(a),g.error("Could not download invoice")}},de=async t=>{var a,s;if(!P.trim()){g.error("Please add a reason");return}$(!0);try{let i="";if(z){F(!0);const m=new FormData;m.append("file",z),i=(await b.post("/uploads",m,{headers:{Authorization:`Bearer ${x}`,"Content-Type":"multipart/form-data"}})).data.url}await b.post(`/orders/${t}/return-request`,{reason:P.trim(),note:B.trim(),images:i?[i]:[]},{headers:{Authorization:`Bearer ${x}`}}),g.success("Return request submitted"),R(1);const n=(await b.get("/orders?page=1&limit=10",{headers:{Authorization:`Bearer ${x}`}})).data,u=Array.isArray(n)?n:n==null?void 0:n.orders;_(u||[]),S((n==null?void 0:n.totalPages)||1)}catch(i){console.error(i),g.error(((s=(a=i.response)==null?void 0:a.data)==null?void 0:s.msg)||"Could not submit return request")}finally{$(!1),F(!1),le({orderId:t,message:"Return request submitted"}),C(null),j(""),N(""),v(null)}};return x?e.jsx("div",{className:"bg-[#fefbfe] min-h-screen",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-10 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Your orders"}),e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Track and manage"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Status updates appear here as soon as admin changes them."})]}),e.jsx(ee,{to:"/products",className:"text-sm text-pink-600 font-semibold border border-pink-100 rounded-full px-4 py-2",children:"Continue shopping"})]}),W.length>0&&e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-3",children:W.map(t=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-3 text-sm text-gray-700",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("p",{children:t.line1}),t.line2&&e.jsx("p",{children:t.line2}),e.jsxs("p",{children:[t.city,", ",t.state," ",t.pincode]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Phone: ",t.phone]})]},t.key))}),ne?e.jsx("div",{className:"grid gap-4",children:Array.from({length:3}).map((t,a)=>e.jsx("div",{className:"h-32 bg-white rounded-3xl animate-pulse"},a))}):I?e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-2xl p-4 text-sm",children:I}):M.length===0?e.jsxs("div",{className:"bg-white border border-gray-100 rounded-3xl p-8 text-center space-y-3",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No orders found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"If you just placed an order, refresh once. Orders show only for the account youâ€™re signed in with."}),e.jsx(ee,{to:"/products",className:"inline-flex items-center justify-center px-5 py-3 bg-pink-600 text-white rounded-full text-sm font-semibold",children:"Browse sarees"})]}):e.jsxs("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto pr-1",children:[M.map(t=>{var L,G,Q,K,Y,H,J,V,X;const a=t.status||"processing",s=t.paymentStatus||"cod_pending",i=t.createdAt?new Date(t.createdAt).toLocaleString():"",l=U.indexOf(a),n=t.items||[],u=fe(t),m=t.trackingLink||t.trackingNumber;return e.jsxs("div",{className:"bg-white border border-gray-100 rounded-3xl p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:["ORDER #",(G=(L=t._id)==null?void 0:L.slice(-6))==null?void 0:G.toUpperCase()]}),e.jsx("p",{className:"text-sm text-gray-500",children:i})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"px-3 py-1 rounded-full bg-amber-50 text-amber-700 text-xs font-semibold border border-amber-100",children:se[a]||a}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-semibold border border-emerald-100",children:ye[s]||s}),e.jsx("button",{onClick:()=>oe(t._id),className:"text-[var(--primary)] text-xs font-semibold underline",type:"button",children:"Download bill"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[U.map((c,p)=>{const k=l>=p;return e.jsx("div",{className:`px-3 py-2 rounded-full text-xs font-semibold border ${k?"bg-pink-600 text-white border-pink-600":"bg-gray-50 text-gray-500 border-gray-200"}`,children:se[c]},c)}),t.returnStatus&&t.returnStatus!=="none"&&e.jsx("span",{className:"px-3 py-2 rounded-full text-xs font-semibold border bg-amber-50 text-amber-700 border-amber-100",children:ae[t.returnStatus]||t.returnStatus})]}),e.jsxs("div",{className:"grid md:grid-cols-[2fr,1fr] gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[n.map(c=>{var p,k,Z;return e.jsxs("div",{className:"flex items-center justify-between text-sm border-b border-gray-100 py-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:he(c.product),alt:((p=c.product)==null?void 0:p.name)||"Product",className:"w-14 h-14 object-cover rounded-xl border border-gray-100",onError:xe=>{xe.currentTarget.src=re}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:((k=c.product)==null?void 0:k.name)||"Product"}),e.jsxs("p",{className:"text-gray-500",children:["Qty: ",c.quantity]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold text-gray-900",children:te((c.price||0)*(c.quantity||1))})})]},c._id||((Z=c.product)==null?void 0:Z._id)||Math.random())}),e.jsx("button",{type:"button",onClick:()=>ce(t),className:"inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-semibold bg-white border border-pink-200 text-pink-600 hover:bg-pink-50",children:"Reorder these items"}),t.status==="delivered"&&(t.returnStatus==="none"||t.returnStatus==="rejected")&&e.jsx("div",{className:"mt-3 space-y-2",children:be(t)?e.jsxs(e.Fragment,{children:[(w==null?void 0:w.orderId)===t._id&&e.jsx("p",{className:"text-xs text-emerald-600",children:w.message}),ie===t._id?e.jsxs("div",{className:"space-y-2 bg-white border border-pink-100 rounded-2xl p-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Reason"}),e.jsx("textarea",{value:P,onChange:c=>j(c.target.value),className:"border rounded-xl px-3 py-2 w-full text-sm",rows:2,placeholder:"Why are you returning?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Note (optional)"}),e.jsx("textarea",{value:B,onChange:c=>N(c.target.value),className:"border rounded-xl px-3 py-2 w-full text-sm",rows:2,placeholder:"Any extra details"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Photo (optional)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:c=>{var p;return v(((p=c.target.files)==null?void 0:p[0])||null)},className:"text-xs"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>de(t._id),disabled:T||E,className:"inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-semibold bg-pink-600 text-white hover:bg-pink-700 disabled:opacity-60",children:T||E?"Submitting...":"Submit return"}),e.jsx("button",{type:"button",onClick:()=>{C(null),j(""),N(""),v(null)},className:"inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-semibold bg-white border border-gray-200 text-gray-700 hover:bg-gray-50",children:"Cancel"})]})]}):e.jsx("button",{type:"button",onClick:()=>{C(t._id),j(""),N(""),v(null)},className:"inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-semibold bg-white border border-pink-200 text-pink-600 hover:bg-pink-50 disabled:opacity-60",children:"Request return"})]}):e.jsx("p",{className:"text-xs text-gray-400",children:"Return window (7 days) has expired."})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-3 space-y-2 text-sm text-gray-700",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Delivery"}),e.jsx("p",{className:"text-gray-600",children:((Q=t.shippingAddress)==null?void 0:Q.name)||(d==null?void 0:d.name)||"Customer"}),e.jsx("p",{className:"text-gray-500",children:((K=t.shippingAddress)==null?void 0:K.phone)||(d==null?void 0:d.mobile)}),e.jsx("p",{className:"text-gray-500",children:[(Y=t.shippingAddress)==null?void 0:Y.line1,(H=t.shippingAddress)==null?void 0:H.line2].filter(Boolean).join(", ")}),e.jsxs("p",{className:"text-gray-500",children:[[(J=t.shippingAddress)==null?void 0:J.city,(V=t.shippingAddress)==null?void 0:V.state].filter(Boolean).join(", "),(X=t.shippingAddress)!=null&&X.pincode?` - ${t.shippingAddress.pincode}`:""]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Total"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:te(t.amount)}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Payment: ",t.paymentMethod||"COD"]}),(m||t.carrier)&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Tracking"}),e.jsxs("div",{className:"flex items-center flex-wrap gap-3",children:[m&&e.jsx("span",{className:"text-xs text-gray-600 break-all",children:m}),u&&e.jsx("a",{href:u,target:"_blank",rel:"noreferrer",className:"text-xs text-pink-600 underline",children:"Track shipment"}),t.carrier&&e.jsx("span",{className:"text-xs text-gray-500 border border-gray-200 rounded-full px-3 py-1",children:t.carrier})]})]}),t.returnStatus&&t.returnStatus!=="none"&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Return"}),e.jsx("p",{className:"text-xs text-gray-600",children:ae[t.returnStatus]||t.returnStatus}),t.returnReason&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Reason: ",t.returnReason]}),t.returnNote&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Note: ",t.returnNote]})]})]})]})]})]},t._id)}),f>1&&e.jsxs("div",{className:"flex items-center justify-center gap-3 pt-2",children:[e.jsx("button",{className:"px-3 py-2 border rounded-full text-sm",onClick:()=>R(t=>Math.max(1,t-1)),disabled:h===1,children:"Prev"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",h," of ",f]}),e.jsx("button",{className:"px-3 py-2 border rounded-full text-sm",onClick:()=>R(t=>Math.min(f,t+1)),disabled:h===f,children:"Next"})]})]})]})}):null}export{Ne as default};
