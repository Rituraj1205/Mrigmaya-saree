import{c as H,u as J,r as i,A as X,i as o,j as e,L as Y,b as Z}from"./index-99c83c38.js";const ee="data:image/gif;base64,R0lGODlhAQABAAD/ACw=",te=a=>{var l;return Z((l=a==null?void 0:a.images)==null?void 0:l[0],ee)},z=a=>`Rs. ${new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(a||0)}`,M={processing:"Processing",packed:"Packed",shipped:"Shipped",delivered:"Delivered",cancelled:"Cancelled"},b={none:"No return",requested:"Return requested",approved:"Return approved",rejected:"Return rejected",received:"Item received",refunded:"Refunded"},se=a=>{if((a==null?void 0:a.status)!=="delivered")return!1;const l=a!=null&&a.createdAt?new Date(a.createdAt).getTime():0;return(Date.now()-l)/(1e3*60*60*24)<=7},T={cod_pending:"Awaiting COD",awaiting_upi:"Awaiting UPI",awaiting_gateway:"Awaiting gateway",paid:"Paid",cancelled:"Cancelled"},ae=a=>a?a.trackingLink&&a.trackingLink.startsWith("http")?a.trackingLink:a.trackingNumber&&a.trackingNumber.startsWith("http")?a.trackingNumber:null:null;function ie(){var D,P,$,B,_,F,I,O,U;const{id:a}=H(),l=J(),{token:d}=i.useContext(X),[t,y]=i.useState(null),[W,j]=i.useState(!0),[f,N]=i.useState(""),[v,k]=i.useState(!1),[x,u]=i.useState(""),[w,p]=i.useState(""),[S,m]=i.useState(null),[A,R]=i.useState(!1),[G,g]=i.useState(!1),[C,Q]=i.useState("");i.useEffect(()=>{if(!d){l("/login");return}let s=!0;return j(!0),o.get(`/orders/${a}`,{headers:{Authorization:`Bearer ${d}`}}).then(r=>{s&&(y(r.data),N(""))}).catch(r=>{var n,c;s&&N(((c=(n=r.response)==null?void 0:n.data)==null?void 0:c.msg)||"Could not load order")}).finally(()=>s&&j(!1)),()=>{s=!1}},[a,d,l]);const L=["processing","packed","shipped","delivered"],K=i.useMemo(()=>{const s=L.indexOf(t==null?void 0:t.status);return s===-1?-1:s},[t==null?void 0:t.status]);if(!d)return null;const q=ae(t),h=(t==null?void 0:t.trackingLink)||(t==null?void 0:t.trackingNumber),V=async()=>{var s,r;if(!x.trim()){toast.error("Please add a reason");return}k(!0);try{let n="";if(S){R(!0);const E=new FormData;E.append("file",S),n=(await o.post("/uploads",E,{headers:{Authorization:`Bearer ${d}`,"Content-Type":"multipart/form-data"}})).data.url}await o.post(`/orders/${a}/return-request`,{reason:x.trim(),note:w.trim(),images:n?[n]:[]},{headers:{Authorization:`Bearer ${d}`}}),toast.success("Return request submitted");const c=await o.get(`/orders/${a}`,{headers:{Authorization:`Bearer ${d}`}});y(c.data),u(""),p(""),m(null),g(!1),Q("Return request submitted")}catch(n){console.error(n),toast.error(((r=(s=n.response)==null?void 0:s.data)==null?void 0:r.msg)||"Could not submit return request")}finally{k(!1),R(!1)}};return e.jsx("div",{className:"bg-[#fefbfe] min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-10 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Order detail"}),e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:t?`#${(P=(D=t._id)==null?void 0:D.slice(-6))==null?void 0:P.toUpperCase()}`:"Loading..."}),(t==null?void 0:t.createdAt)&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Placed on ",new Date(t.createdAt).toLocaleString()]}),(t==null?void 0:t.returnStatus)&&t.returnStatus!=="none"&&e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:b[t.returnStatus]||t.returnStatus})]}),e.jsx("button",{onClick:()=>l("/orders"),className:"text-sm text-pink-600 font-semibold border border-pink-100 rounded-full px-4 py-2",children:"Back to orders"})]}),W?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-24 bg-white rounded-3xl animate-pulse"}),e.jsx("div",{className:"h-32 bg-white rounded-3xl animate-pulse"}),e.jsx("div",{className:"h-40 bg-white rounded-3xl animate-pulse"})]}):f?e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-2xl p-4 text-sm",children:f}):t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white border border-gray-100 rounded-3xl p-4 shadow-sm",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:L.map((s,r)=>{const n=K>=r;return e.jsx("div",{className:`px-3 py-2 rounded-full text-xs font-semibold border ${n?"bg-pink-600 text-white border-pink-600":"bg-gray-50 text-gray-500 border-gray-200"}`,children:M[s]},s)})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white border border-gray-100 rounded-3xl p-4 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-3 py-1 rounded-full bg-amber-50 text-amber-700 text-xs font-semibold border border-amber-100",children:M[t.status]||t.status}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-semibold border border-emerald-100",children:T[t.paymentStatus]||t.paymentStatus}),t.returnStatus&&t.returnStatus!=="none"&&e.jsx("span",{className:"px-3 py-1 rounded-full bg-amber-50 text-amber-700 text-xs font-semibold border border-amber-100",children:b[t.returnStatus]||t.returnStatus})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Payment"}),e.jsxs("p",{className:"text-sm text-gray-700",children:["Method: ",t.paymentMethod||"COD"," â€¢ Status:"," ",T[t.paymentStatus]||t.paymentStatus]}),(h||t.carrier)&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Tracking"}),e.jsxs("div",{className:"flex items-center flex-wrap gap-3",children:[h&&e.jsx("span",{className:"text-sm text-gray-700 break-all",children:h}),q&&e.jsx("a",{className:"text-sm text-pink-600 underline",href:q,target:"_blank",rel:"noreferrer",children:"Track shipment"}),t.carrier&&e.jsx("span",{className:"text-xs text-gray-500 border border-gray-200 rounded-full px-3 py-1",children:t.carrier})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Amount"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:z(t.amount)})]}),t.returnStatus&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Return"}),e.jsx("p",{className:"text-sm text-gray-700",children:b[t.returnStatus]||t.returnStatus}),t.returnReason&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Reason: ",t.returnReason]}),t.returnNote&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Note: ",t.returnNote]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-3xl p-4 shadow-sm space-y-2 text-sm text-gray-700",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Delivery"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:(($=t.shippingAddress)==null?void 0:$.name)||t.customerContact||"Customer"}),e.jsx("p",{className:"text-gray-600",children:((B=t.shippingAddress)==null?void 0:B.phone)||t.customerContact}),e.jsx("p",{className:"text-gray-600",children:[(_=t.shippingAddress)==null?void 0:_.line1,(F=t.shippingAddress)==null?void 0:F.line2].filter(Boolean).join(", ")}),e.jsxs("p",{className:"text-gray-600",children:[[(I=t.shippingAddress)==null?void 0:I.city,(O=t.shippingAddress)==null?void 0:O.state].filter(Boolean).join(", "),(U=t.shippingAddress)!=null&&U.pincode?` - ${t.shippingAddress.pincode}`:""]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-3xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Items"}),e.jsx("div",{className:"divide-y divide-gray-100 mt-2",children:(t.items||[]).map(s=>{var r,n,c;return e.jsxs("div",{className:"flex items-center justify-between py-3 text-sm gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:te(s.product),alt:(r=s.product)==null?void 0:r.name,className:"w-16 h-16 object-cover rounded-xl border border-gray-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:((n=s.product)==null?void 0:n.name)||"Product"}),e.jsxs("p",{className:"text-gray-500",children:["Qty: ",s.quantity]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:z((s.price||0)*(s.quantity||1))}),((c=s.product)==null?void 0:c._id)&&e.jsx(Y,{to:`/product/${s.product._id}`,className:"text-xs text-pink-600 underline",children:"View product"})]})]},s._id)})})]}),t.status==="delivered"&&(t.returnStatus==="none"||t.returnStatus==="rejected")&&e.jsxs("div",{className:"bg-white border border-gray-100 rounded-3xl p-4 shadow-sm space-y-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Return request"}),C&&e.jsx("p",{className:"text-xs text-emerald-600",children:C}),se(t)?G?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Reason"}),e.jsx("textarea",{value:x,onChange:s=>u(s.target.value),className:"border rounded-xl px-3 py-2 w-full text-sm",rows:2,placeholder:"Why are you returning?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Note (optional)"}),e.jsx("textarea",{value:w,onChange:s=>p(s.target.value),className:"border rounded-xl px-3 py-2 w-full text-sm",rows:2,placeholder:"Any extra details"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Photo (optional)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>{var r;return m(((r=s.target.files)==null?void 0:r[0])||null)},className:"text-xs"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:V,disabled:v||A,className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-pink-600 text-white text-sm font-semibold hover:bg-pink-700 disabled:opacity-60",children:v||A?"Submitting...":"Submit return"}),e.jsx("button",{type:"button",onClick:()=>{g(!1),u(""),p(""),m(null)},className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700 text-sm font-semibold hover:bg-gray-50",children:"Cancel"})]})]}):e.jsx("button",{type:"button",onClick:()=>g(!0),className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white border border-pink-200 text-pink-600 text-sm font-semibold hover:bg-pink-50",children:"Request return"}):e.jsx("p",{className:"text-xs text-gray-400",children:"Return window (7 days) has expired."})]})]}):e.jsx("div",{className:"bg-white border border-gray-100 rounded-3xl p-6 text-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Order not found"})})]})})}export{ie as default};
