import{a as me,u as xe,r as l,C as je,c as Ne,i as W,j as s,b as Ce}from"./index-341cd16a.js";import{B as ve}from"./BrandLoader-f1aaa9a5.js";import{s as ye}from"./seo-4fb2e452.js";const Se="data:image/gif;base64,R0lGODlhAQABAAD/ACw=",be=[{value:"featured",label:"Featured"},{value:"priceLow",label:"Price: Low to High"},{value:"priceHigh",label:"Price: High to Low"},{value:"new",label:"Newest first"}],L=n=>`Rs. ${new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(n||0)}`,ae=n=>{if(n==null)return 0;if(typeof n=="number")return n;if(typeof n=="string"){const b=n.replace(/,/g,"").trim(),m=Number(b);return Number.isNaN(m)?0:m}return 0},re=(n,b=0)=>{var m,I;return Ce(((m=n==null?void 0:n.images)==null?void 0:m[b])||((I=n==null?void 0:n.images)==null?void 0:I[0]),Se)};function Ie(){var Y,Z;const n=me(),b=xe(),{addToCart:m}=l.useContext(je),{slug:I}=Ne(),[C,ce]=l.useState([]),[x,le]=l.useState([]),[f,ie]=l.useState([]),[q,oe]=l.useState(["All Sarees"]),[D,z]=l.useState(!0),[G,O]=l.useState(""),[u,v]=l.useState("All Sarees"),[y,P]=l.useState(""),[p,w]=l.useState(""),[j,B]=l.useState(4e3),[K,ne]=l.useState(6e3),[A,Q]=l.useState("featured"),[S,F]=l.useState(""),[E,V]=l.useState([]),[_,J]=l.useState(""),[T,de]=l.useState(""),[X,ue]=l.useState(!1),[M,he]=l.useState(4e3),[pe,R]=l.useState(!1),[fe,$]=l.useState(!1),g=y||T;l.useEffect(()=>{const e=[];_&&e.push(_),u&&u!=="All Sarees"&&e.push(u);const t=e.length?` | ${e.join(" · ")}`:"";ye({title:`Mrigmaya | Shop sarees${t}`,description:"Explore Mrigmaya edits: handcrafted silks, chiffons, Banarasis, and contemporary drapes with concierge support and fast pan-India delivery."})},[_,u]),l.useEffect(()=>{const e=new URLSearchParams(n.search);if(!(e.has("moodId")||e.has("ids")||e.has("collectionSlug")))return;const r=document.querySelector(".product-area");r&&setTimeout(()=>r.scrollIntoView({behavior:"smooth",block:"start"}),80)},[n.search]),l.useEffect(()=>{let e=!0;return z(!0),W.get("/products?includeInactive=true").then(t=>{var r;e&&(ce(Array.isArray(t.data)?t.data:((r=t.data)==null?void 0:r.products)||[]),O(""))}).catch(()=>{e&&O("We could not load the sarees. Please try again.")}).finally(()=>e&&z(!1)),()=>{e=!1}},[]),l.useEffect(()=>{const e=C.reduce((r,d)=>{const a=d.discountPrice||d.price||0;return a>r?a:r},0),t=Math.max(e,6e3);he(t),ne(t),B(t)},[C]),l.useEffect(()=>{const e=new URLSearchParams(n.search),t=e.get("ids"),r=e.get("collectionSlug"),d=e.get("moodId"),a=e.get("search")||"";F(a),V(t?t.split(",").map(c=>c.trim()).filter(Boolean):[]),J(r||""),P(d||""),de(d||"")},[n.search]),l.useEffect(()=>{W.get("/collections").then(e=>le(e.data||[])).catch(()=>{})},[]),l.useEffect(()=>{W.get("/home-sections").then(e=>{const t=(e.data||[]).filter(r=>r.group==="category"&&r.active!==!1).sort((r,d)=>(r.order??0)-(d.order??0));ie(t),ue(!0),y&&t.length>0&&!t.find(r=>r._id===y)&&P("")}).catch(()=>{})},[y]),l.useEffect(()=>{const e=y||T;if(!e||!X||!f.length)return;const t=f.find(r=>r._id===e);t!=null&&t.title&&v(t.title)},[y,T,f,X]),l.useEffect(()=>{const e=_||I;if(!e||!x.length)return;const t=x.find(r=>r.slug===e);t?(w(t._id),v("All Sarees")):w("")},[I,x,_]),l.useEffect(()=>{const e=f.map(c=>c.title).filter(Boolean),t=(C||[]).map(c=>{var i;return(c.category||"").trim()||(((i=c.categoryRef)==null?void 0:i.name)||"").trim()}).filter(Boolean),r=(x||[]).map(c=>c.title).filter(Boolean),a=["All Sarees",...Array.from(new Set([...e,...t,...r].filter(Boolean)))];oe(a),(a.length===1||u!=="All Sarees"&&!a.includes(u))&&(v("All Sarees"),P(""))},[C,f,x,u]);const U=l.useMemo(()=>{var r,d;let e=[...C];const t=!!g;if(E.length&&(e=e.filter(a=>E.includes(a._id)||E.includes(a.productId))),g){const a=f.find(c=>c._id===g);if(a){const c=((r=a.meta)==null?void 0:r.products)||a.productIds||[],i=a.slug,N=a.title||"";c.length?e=e.filter(h=>c.includes(h._id)||c.includes(h.productId)):i?e=e.filter(h=>(h.collections||[]).some(o=>(o.slug||o)===i||(o._id||o)===i)):a.title&&(e=e.filter(h=>{var o;return[h.category||"",((o=h.categoryRef)==null?void 0:o.name)||"",...(h.collections||[]).map(k=>(k==null?void 0:k.title)||"")].join(" ").toLowerCase().includes(N.toLowerCase())}))}}if(!t&&u&&u!=="All Sarees"){const a=u.toLowerCase();e=e.filter(c=>{var N,h;return[c.category||"",((N=c.categoryRef)==null?void 0:N.name)||"",((h=c.categoryRef)==null?void 0:h.slug)||"",...(c.collections||[]).map(o=>(o==null?void 0:o.title)||(o==null?void 0:o.slug)||"")].join(" ").toLowerCase().includes(a)})}if(p&&(e=e.filter(a=>(a.collections||[]).some(c=>(c._id||c)===p))),t||(e=e.filter(a=>(a.discountPrice||a.price||0)<=j)),S.trim()&&(e=e.filter(a=>(a.name||"").toLowerCase().includes(S.trim().toLowerCase()))),A==="priceLow"?e.sort((a,c)=>(a.discountPrice||a.price||0)-(c.discountPrice||c.price||0)):A==="priceHigh"?e.sort((a,c)=>(c.discountPrice||c.price||0)-(a.discountPrice||a.price||0)):A==="new"&&e.sort((a,c)=>new Date(c.createdAt||0)-new Date(a.createdAt||0)),e.length===0&&g){const a=f.find(i=>i._id===g),c=((d=a==null?void 0:a.meta)==null?void 0:d.customProducts)||[];if(c.length)return c.map((i,N)=>{if(i.productId){const te=C.find(ge=>ge._id===i.productId);if(te)return te}const h=Array.isArray(i.images)&&i.images.length?i.images:[i.image||""],o=ae(i.price||i.sellingPrice||i.discountPrice),k=ae(i.mrp||i.originalPrice||i.priceMrp),ee=k>o&&o>0,se=i.productId||`custom-${N}`;return{_id:se,productId:se,isCustom:!0,name:i.name||"Custom item",price:ee?k:o,discountPrice:ee?o:void 0,images:h,category:(a==null?void 0:a.title)||"Edit item"}})}return e},[C,u,j,S,A,p,E,y,f]),H=()=>{v("All Sarees"),P(""),w(""),B(M),Q("featured"),F("")};return s.jsx("div",{className:"collection-page",children:s.jsxs("section",{className:"collection-body",children:[s.jsxs("div",{className:"product-area",children:[s.jsxs("div",{className:"product-toolbar",children:[s.jsxs("div",{className:"toolbar-copy",children:[s.jsx(ve,{compact:!0,message:""}),s.jsxs("div",{className:"meta",children:[s.jsx("span",{children:`${U.length} styles ready to ship`}),s.jsx("span",{className:"meta-dot"}),s.jsx("span",{children:`Cap ${L(j)}`}),p?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"meta-dot"}),s.jsx("span",{children:((Y=x.find(e=>e._id===p))==null?void 0:Y.title)||"Collection"})]}):null]})]}),s.jsxs("div",{className:"toolbar-actions",children:[s.jsxs("div",{className:"quick-filters",children:[s.jsx("button",{className:"pill pill--ghost",onClick:()=>R(!0),children:"Category"}),s.jsx("button",{className:"pill pill--ghost",onClick:()=>$(!0),children:"Filters"})]}),s.jsxs("div",{className:"search-shell",children:[s.jsx("span",{className:"search-icon",children:"Search"}),s.jsx("input",{type:"text",placeholder:"Prints, fabrics, hues...",value:S,onChange:e=>F(e.target.value)})]})]})]}),G&&s.jsx("p",{className:"error",children:G}),s.jsx("div",{className:"tag-strip",children:(p||u&&u!=="All Sarees"||!g&&j!==M||S.trim())&&s.jsxs(s.Fragment,{children:[u&&u!=="All Sarees"&&s.jsxs("span",{className:"tag-chip",onClick:()=>v("All Sarees"),children:[u," ×"]}),p&&s.jsxs("span",{className:"tag-chip",onClick:()=>w(""),children:[((Z=x.find(e=>e._id===p))==null?void 0:Z.title)||"Collection"," ×"]}),!g&&j!==M&&s.jsxs("span",{className:"tag-chip",onClick:()=>B(M),children:["Cap ",L(j)," ×"]}),S.trim()&&s.jsxs("span",{className:"tag-chip",onClick:()=>F(""),children:["“",S.trim(),"” ×"]}),s.jsx("button",{className:"tag-chip tag-chip--clear",onClick:H,children:"Clear all"})]})}),s.jsxs("div",{className:"product-grid",children:[D&&Array.from({length:8}).map((e,t)=>s.jsx("div",{className:"product-card skeleton"},t)),!D&&U.length===0&&s.jsxs("div",{className:"empty-state",children:[s.jsx("p",{children:"No sarees match these filters yet."}),s.jsx("p",{className:"text-sm text-gray-500",children:"Try clearing filters or searching a simpler term."}),s.jsx("button",{onClick:H,className:"px-4 py-2 rounded-full border border-gray-200 text-sm font-semibold",children:"Clear filters"})]}),!D&&U.map(e=>{const t=!!e.isCustom,r=e.productId||e._id,d=!t||!!e.productId,a=e.discountPrice||e.price,c=!!(e.discountPrice&&e.discountPrice!==e.price),i=c?Math.round((e.price-e.discountPrice)/e.price*100):null,N=i?`-${i}%`:"New",h=async o=>{o.stopPropagation(),!(!r||!e.productId&&t)&&(await m(r),b("/checkout"))};return s.jsxs("article",{className:"product-card",onClick:()=>{d&&b(`/product/${r}`)},children:[s.jsxs("div",{className:"card-image",children:[s.jsx("img",{src:re(e),alt:e.name,className:"card-image__img",loading:"lazy",decoding:"async"}),s.jsx("img",{src:re(e,1),alt:e.name,className:"card-image__img card-image__img--hover",loading:"lazy",decoding:"async"}),s.jsx("span",{className:"card-badge",children:N})]}),s.jsxs("div",{className:"card-body",children:[s.jsx("p",{className:"card-category",children:e.category||"Saree"}),s.jsx("h3",{children:e.name}),s.jsxs("div",{className:"card-meta",children:[s.jsx("span",{children:"Ready to ship"}),e.fabric&&s.jsx("span",{children:e.fabric})]}),s.jsxs("div",{className:"card-price",children:[s.jsx("strong",{children:L(a)}),c&&s.jsx("span",{children:L(e.price)})]}),s.jsx("button",{className:"card-cta",disabled:!r||!e.productId&&t,onClick:o=>{o.stopPropagation(),!(!r||!e.productId&&t)&&m(r)},children:"Add to cart"}),s.jsx("button",{className:"card-cta mt-2 bg-gradient-to-r from-[var(--primary)] to-[var(--accent)] text-white",disabled:!r||!e.productId&&t,onClick:h,children:"Buy now"})]})]},e._id)})]})]}),pe&&s.jsx("div",{className:"sheet-backdrop",onClick:()=>R(!1),children:s.jsxs("div",{className:"filter-panel sheet",onClick:e=>{e.stopPropagation()},children:[s.jsxs("div",{className:"sheet-header",children:[s.jsx("h3",{children:"Category"}),s.jsx("button",{className:"close-sheet",onClick:()=>R(!1),children:"Close"})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Category"}),s.jsx("div",{className:"filter-pills",children:q.map(e=>s.jsx("button",{className:e===u?"pill active":"pill",onClick:()=>{v(e);const t=f.find(r=>{var d;return((d=r.title)==null?void 0:d.toLowerCase())===e.toLowerCase()});P((t==null?void 0:t._id)||""),R(!1)},children:e},e))})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Sort"}),s.jsx("div",{className:"select-shell select-shell--sheet",children:s.jsx("select",{value:A,onChange:e=>Q(e.target.value),children:be.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})})]})]})}),fe&&s.jsx("div",{className:"sheet-backdrop",onClick:()=>$(!1),children:s.jsxs("div",{className:"filter-panel sheet",onClick:e=>{e.stopPropagation()},children:[s.jsxs("div",{className:"sheet-header",children:[s.jsx("h3",{children:"Filters"}),s.jsx("button",{className:"close-sheet",onClick:()=>$(!1),children:"Close"})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Category"}),s.jsx("div",{className:"filter-pills",children:q.map(e=>s.jsx("button",{className:e===u?"pill active":"pill",onClick:()=>{v(e);const t=f.find(r=>{var d;return((d=r.title)==null?void 0:d.toLowerCase())===e.toLowerCase()});P((t==null?void 0:t._id)||"")},children:e},e))})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Collections"}),s.jsxs("div",{className:"filter-pills",children:[s.jsx("button",{className:p?"pill":"pill active",onClick:()=>w(""),children:"All"}),x.map(e=>s.jsx("button",{className:p===e._id?"pill active":"pill",onClick:()=>w(p===e._id?"":e._id),children:e.title},e._id))]})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Budget cap"}),s.jsx("input",{type:"range",min:"0",max:Math.max(1e3,K),step:"100",value:g?Math.max(1e3,K):j,onChange:e=>{g||B(Number(e.target.value))}}),s.jsx("div",{className:"price-display",children:g?"Budget cap disabled for this edit":`Up to ${L(j)}`})]}),s.jsxs("div",{className:"filter-footer",children:[s.jsx("button",{onClick:()=>{H(),$(!1)},children:"Reset filters"}),s.jsx("p",{children:"Need help styling? WhatsApp our saree expert."})]})]})})]})})}export{Ie as default};
