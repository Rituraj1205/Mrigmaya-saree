import{r as u,A as Rt,u as Ot,z as c,i as p,j as e,b as zt}from"./index-99c83c38.js";const G=l=>zt(l,""),Fe=(l="")=>{const b=l.split("?")[0].toLowerCase();return/\.(mp4|webm|ogg)$/.test(b)},Te=l=>l?Array.isArray(l.colors)&&l.colors.length?l.colors.join(", "):l.color||"":"",He=l=>{const b=Ee.find(_=>_.label.toLowerCase()===(l||"").toLowerCase());return(b==null?void 0:b.swatch)||"linear-gradient(135deg, #fdfcfb, #e2d1c3)"},Ft=l=>{if(!(l!=null&&l.startsWith("#"))||l.length!==7&&l.length!==4)return!1;const b=l.length===4?`#${l[1]}${l[1]}${l[2]}${l[2]}${l[3]}${l[3]}`:l,_=parseInt(b.slice(1),16),I=_>>16&255,y=_>>8&255,m=_&255;return(I*299+y*587+m*114)/1e3>180},ge={name:"",description:"",category:"",categoryRef:"",fabric:"",color:"",colors:[],sizes:[],amazonLink:"",flipkartLink:"",price:"",discountPrice:"",stock:"",images:"",video:"",collectionIds:[]},Be={title:"",slug:"",subtitle:"",description:"",ctaLabel:"",heroImage:"",accentColor:"#c1275a",displayOnHome:!0,priority:999},Tt=[{value:"processing",label:"Processing"},{value:"packed",label:"Packed"},{value:"shipped",label:"Shipped"},{value:"delivered",label:"Delivered"},{value:"cancelled",label:"Cancelled"}],Ee=[{label:"Red",swatch:"#e53935"},{label:"Pink",swatch:"#f06292"},{label:"Magenta",swatch:"#d81b60"},{label:"Maroon",swatch:"#7b1fa2"},{label:"Yellow",swatch:"#fbc02d"},{label:"Mustard",swatch:"#d3a518"},{label:"Orange",swatch:"#ff7043"},{label:"Peach",swatch:"#f8b195"},{label:"Green",swatch:"#43a047"},{label:"Olive",swatch:"#708238"},{label:"Mint",swatch:"#7bdcb5"},{label:"Sea Green",swatch:"#2e8b57"},{label:"Teal",swatch:"#009688"},{label:"Blue",swatch:"#1e88e5"},{label:"Navy",swatch:"#1b3b6f"},{label:"Purple",swatch:"#9c27b0"},{label:"Lavender",swatch:"#c6a5d8"},{label:"Brown",swatch:"#8d6e63"},{label:"Beige",swatch:"#d9c4a1"},{label:"Cream",swatch:"#f6e7c1"},{label:"Grey",swatch:"#9e9e9e"},{label:"Black",swatch:"#212121"},{label:"White",swatch:"#f5f5f5"},{label:"Gold",swatch:"#d4af37"},{label:"Silver",swatch:"#c0c0c0"},{label:"Multi",swatch:"linear-gradient(120deg, #e53935, #fbc02d, #43a047, #1e88e5, #9c27b0)"}],Ht=["XS","S","M","L","XL"],Bt=[{value:"cod_pending",label:"Awaiting COD"},{value:"awaiting_upi",label:"Awaiting UPI"},{value:"awaiting_gateway",label:"Awaiting gateway"},{value:"paid",label:"Paid"},{value:"cancelled",label:"Cancelled"}];function Qt(){const{token:l,user:b,logout:_}=u.useContext(Rt),I=Ot(),[y,m]=u.useState([]),[N,A]=u.useState([]),[L,P]=u.useState([]),[o,i]=u.useState(ge),[h,v]=u.useState([]),[k,$]=u.useState([]),[W,g]=u.useState(""),[j,z]=u.useState(!1),[J,Z]=u.useState(!1),[O,K]=u.useState(null),[C,F]=u.useState(Be),[q,Ve]=u.useState([]),[ye,fe]=u.useState([{_id:null,title:"",subtitle:"",image:""},{_id:null,title:"",subtitle:"",image:""}]),[be,Ge]=u.useState([]),[w,B]=u.useState({code:"",discountType:"flat",value:"",maxDiscount:"",maxRedemptions:1,expiresAt:"",minOrderValue:"",active:!0}),[de,je]=u.useState(""),[We,re]=u.useState(!1),[qe,Ne]=u.useState(!1),[M,R]=u.useState({title:"",subtitle:"",tag:"",ctaLabel:"",ctaLink:"/products",image:"",order:1,active:!0,productIds:[]}),[ee,ve]=u.useState(null),[Xe,le]=u.useState(!1),[we,Je]=u.useState([]),[ne,Ke]=u.useState([]),Ce=u.useMemo(()=>ne.filter(t=>t.returnRequested||t.returnStatus&&t.returnStatus!=="none"),[ne]),te=u.useMemo(()=>(o.images||"").split(/[\n,]/).map(t=>t.trim()).filter(Boolean),[o.images]),X=u.useMemo(()=>L.find(t=>t._id===o.categoryRef),[L,o.categoryRef]),xe=u.useMemo(()=>`${(X==null?void 0:X.name)||""} ${(X==null?void 0:X.slug)||""} ${o.category||""}`.toLowerCase().trim(),[o.category,X]).includes("suit"),[E,Qe]=u.useState("collections"),Ye=[{id:"collections",label:"Collections"},{id:"products",label:"Products"},{id:"coupons",label:"Coupons"},{id:"homepage",label:"Homepage Slider"},{id:"usp",label:"Offers Rail"},{id:"orders",label:"Orders"},{id:"returns",label:"Returns"},{id:"login-visuals",label:"Login visuals"}],f=u.useMemo(()=>({headers:{Authorization:`Bearer ${l||localStorage.getItem("token")||""}`}}),[l]),Q=t=>{Je(s=>[{message:t,ts:new Date().toISOString()},...s].slice(0,15))},ke=(t,s=2)=>{var r;if(!t)return!1;if(!((r=t.type)!=null&&r.startsWith("image/")))return c.error("Please upload an image file"),!1;const a=s*1024*1024;return t.size>a?(c.error(`Image too large. Max ${s}MB allowed.`),!1):!0},Ze=(t,s=20)=>{var d,x;if(!t)return!1;const a=(d=t.type)==null?void 0:d.startsWith("image/"),r=(x=t.type)==null?void 0:x.startsWith("video/");if(!a&&!r)return c.error("Upload an image or video"),!1;const n=s*1024*1024;return t.size>n?(c.error(`File too large. Max ${s}MB allowed.`),!1):!0},ue=t=>{i(s=>{const a=s.colors||[],n=a.includes(t)?a.filter(d=>d!==t):[...a,t];return{...s,colors:n,color:n[0]||""}})},Se=()=>{const t=W.trim();t&&(ue(t),g(""))},et=t=>{i(s=>{const a=s.sizes||[],n=a.includes(t)?a.filter(d=>d!==t):[...a,t];return{...s,sizes:n}})},_e=xe||j||(o.sizes||[]).length>0,tt=t=>{const s=(t==null?void 0:t.shippingAddress)||{},a=[s.name,s.phone||t.customerContact,s.line1,s.line2,[s.city,s.state].filter(Boolean).join(", "),s.pincode].filter(Boolean);return a.length===0?"No address":a.join(" | ")};u.useEffect(()=>{if(!l){I("/admin/login");return}(b==null?void 0:b.role)!=="admin"&&(c.error("Admin access only"),I("/"))},[l,b,I]),u.useEffect(()=>{l&&(se(),Y(),S(),st(),oe(),ie())},[l]),u.useEffect(()=>{S()},[]);const se=async()=>{try{const t=await p.get("/products?includeInactive=true");m(t.data)}catch(t){console.error(t)}},Y=async()=>{try{const t=await p.get("/collections?includeProducts=true");A(t.data)}catch(t){console.error(t)}},st=async()=>{if(l)try{const t=await p.get("/categories/all",f);P(t.data||[])}catch(t){console.error(t)}},oe=async()=>{if(l)try{const t=await p.get("/coupons",f);Ge(t.data||[])}catch(t){console.error(t)}},ie=async()=>{if(l)try{const s=(await p.get("/orders",f)).data||{};Ke(Array.isArray(s.orders)?s.orders:Array.isArray(s)?s:[])}catch(t){console.error(t)}},at=async t=>{try{const s=await p.get(`/orders/${t}/invoice`,{...f,responseType:"blob"}),a=new Blob([s.data],{type:"application/pdf"}),r=window.URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=`invoice-${t.slice(-6)}.pdf`,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(r)}catch(s){console.error(s),c.error("Could not download invoice")}},S=async()=>{var t;try{const s=await p.get("/home-sections?includeInactive=true");Ve(s.data)}catch(s){console.error("Home sections fetch failed",((t=s==null?void 0:s.response)==null?void 0:t.data)||s.message),c.error("Could not load homepage cards")}},U=u.useMemo(()=>[...q.filter(t=>t.group==="hero")].sort((t,s)=>(t.order??0)-(s.order??0)),[q]),Le=u.useMemo(()=>U.length?Math.max(...U.map(t=>t.order??0)):0,[U]);u.useEffect(()=>{const t=[...q.filter(a=>{var r;return a.group==="custom"&&((r=a.meta)==null?void 0:r.loginSlot)!==void 0})].sort((a,r)=>{var n,d;return(((n=a.meta)==null?void 0:n.loginSlot)??0)-(((d=r.meta)==null?void 0:d.loginSlot)??0)}),s=[0,1].map(a=>{const r=t.find(n=>{var d;return Number((d=n.meta)==null?void 0:d.loginSlot)===a});return{_id:(r==null?void 0:r._id)||null,title:(r==null?void 0:r.title)||"",subtitle:(r==null?void 0:r.subtitle)||"",image:(r==null?void 0:r.image)||""}});fe(s)},[q]);const ce=(t,s,a)=>{fe(r=>{const n=[...r];return n[t]={...n[t],[s]:a},n})},rt=async()=>{try{await Promise.all(ye.map(async(s,a)=>{const r={group:"custom",title:s.title,subtitle:s.subtitle,image:s.image,order:a,active:!0,meta:{...s.meta||{},loginSlot:a}};if(s._id){if(!s.image){await p.delete(`/home-sections/${s._id}`,f);return}await p.put(`/home-sections/${s._id}`,r,f)}else s.image&&await p.post("/home-sections",r,f)}))&&(c.success("Login visuals saved"),S())}catch(t){console.error(t),c.error("Could not save visuals")}},lt=async(t,s)=>{var r;if(!((r=t.title)!=null&&r.trim())){c.error("Enter a title for the offer");return}const a={...t,group:"usp",order:Number(t.order)||Ie.length+1};try{s?(await p.put(`/home-sections/${s}`,a,f),c.success("Offer updated")):(await p.post("/home-sections",a,f),c.success("Offer added")),S()}catch(n){console.error(n),c.error("Could not save offer")}},nt=async t=>{if(window.confirm("Delete this offer?"))try{await p.delete(`/home-sections/${t}`,f),c.success("Deleted"),S()}catch(s){console.error(s),c.error("Could not delete offer")}},ot=async(t,s)=>{if(ke(t)&&t){Ne(!0);try{const a=new FormData;a.append("file",t);const n=(await p.post("/uploads",a,{headers:{...f.headers,"Content-Type":"multipart/form-data"}})).data.url;ce(s,"image",n),c.success("Image uploaded")}catch(a){console.error(a),c.error("Upload failed")}finally{Ne(!1)}}},D=u.useMemo(()=>[...q.filter(t=>t.group==="category")].sort((t,s)=>(t.order??0)-(s.order??0)),[q]),Ie=u.useMemo(()=>[...q.filter(t=>t.group==="usp")].sort((t,s)=>(t.order??0)-(s.order??0)),[q]);u.useEffect(()=>{if(!O){v([]);return}const t=y.find(a=>a._id===O);if(!t)return;const s=D.filter(a=>{var n;return(((n=a.meta)==null?void 0:n.products)||a.productIds||[]).includes(t._id)}).map(a=>a._id);v(s)},[O,y,D]);const Ae=async t=>{if(!ke(t))return null;const s=new FormData;return s.append("file",t),(await p.post("/uploads",s,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}})).data.url},it=async t=>{if(!Ze(t,25))return null;const s=new FormData;return s.append("file",t),(await p.post("/uploads",s,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}})).data.url},pe=()=>{R({title:"",subtitle:"",tag:"",ctaLabel:"",ctaLink:"/products",image:"",order:1,active:!0,productIds:[]}),ve(null)},De=async(t,s)=>{await p.post("/home-sections",{group:"hero",...t,order:s,active:!0},f)},ct=async()=>{if(!M.title.trim()){c.error("Enter a title");return}if(!M.image.trim()){c.error("Add an image");return}const t={...M,order:Number(M.order)||D.length+1,group:"category"};t.meta={...t.meta||{},products:M.productIds||[]};try{ee?(await p.put(`/home-sections/${ee}`,t,f),c.success("Card updated")):(await p.post("/home-sections",t,f),c.success("Card added")),pe(),S()}catch(s){console.error(s),c.error("Could not save card")}},dt=t=>{var s;ve(t._id),R({title:t.title||"",subtitle:t.subtitle||"",tag:t.tag||"",ctaLabel:t.ctaLabel||"",ctaLink:t.ctaLink||"/products",image:t.image||"",order:t.order??1,active:t.active!==!1,productIds:((s=t.meta)==null?void 0:s.products)||t.productIds||[]})},xt=async t=>{if(window.confirm("Delete this card?"))try{await p.delete(`/home-sections/${t}`,f),c.success("Card deleted"),ee===t&&pe(),S()}catch(s){console.error(s),c.error("Could not delete card")}},Pe=async(t,s)=>{const a=D.findIndex(x=>x._id===t);if(a===-1)return;const r=s==="up"?a-1:a+1;if(r<0||r>=D.length)return;const n=D[a],d=D[r];try{await Promise.all([p.put(`/home-sections/${n._id}`,{order:d.order??r},f),p.put(`/home-sections/${d._id}`,{order:n.order??a},f)]),S()}catch(x){console.error(x),c.error("Could not reorder cards")}},ut=async t=>{if(t)try{le(!0);const s=await Ae(t);R(a=>({...a,image:s})),c.success("Image uploaded")}catch(s){console.error(s),c.error("Upload failed")}finally{le(!1)}},pt=async(t,s)=>{var n;if(!s)return;const a=D.find(d=>d._id===t),r=((n=a==null?void 0:a.meta)==null?void 0:n.products)||(a==null?void 0:a.productIds)||[];if(!r.includes(s))try{await p.put(`/home-sections/${t}`,{meta:{...a.meta||{},products:[...r,s]}},f),S()}catch(d){console.error(d),c.error("Could not attach product")}},Ue=()=>{B({code:"",discountType:"flat",value:"",maxDiscount:"",maxRedemptions:1,expiresAt:"",active:!0})},mt=async()=>{var t,s;if(!w.code.trim()||!w.value){c.error("Code and value are required");return}try{await p.post("/coupons",{...w,code:w.code.trim().toUpperCase(),value:Number(w.value),maxDiscount:w.maxDiscount?Number(w.maxDiscount):void 0,maxRedemptions:w.maxRedemptions?Number(w.maxRedemptions):1},f),c.success("Coupon saved"),Ue(),oe()}catch(a){c.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.msg)||"Could not save coupon")}},ht=async(t,s)=>{var Me,Re,Oe,ze;const a=D.find(H=>H._id===t),r=Array.isArray(s.images)&&s.images.length?s.images:[s.image||""],n=new FormData;n.append("name",s.name||"Custom item"),n.append("description",`Custom product for ${(a==null?void 0:a.title)||"edit"}`),n.append("category",(a==null?void 0:a.title)||"Custom"),n.append("price",Number(s.mrp||s.price||0));const d=Number(s.price||0),x=Number(s.mrp||0);x>d&&d>0&&(n.append("discountPrice",d),n.append("price",x)),n.append("stock",50),n.append("images",r.filter(Boolean).join(`
`));let T=s.productId;try{T=((Me=(await p.post("/products",n,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}})).data)==null?void 0:Me._id)||T,c.success("Product created & attached"),se()}catch(H){console.error("Custom product creation failed",H),c.error("Could not create product for this item");return}const he=((Re=a==null?void 0:a.meta)==null?void 0:Re.products)||(a==null?void 0:a.productIds)||[],Mt=[...(((Oe=a==null?void 0:a.meta)==null?void 0:Oe.productsDetails)||[]).filter(H=>(H==null?void 0:H._id)!==T),{_id:T,name:s.name||"Custom item"}];try{await p.put(`/home-sections/${t}`,{meta:{...a.meta||{},products:[...new Set([...he,T])],productsDetails:Mt,customProducts:((ze=a==null?void 0:a.meta)==null?void 0:ze.customProducts)||[]}},f),S()}catch(H){console.error(H),c.error("Could not attach product to this card")}},gt=async(t,s)=>{var d;const a=D.find(x=>x._id===t),n=(((d=a==null?void 0:a.meta)==null?void 0:d.customProducts)||[]).filter((x,V)=>V!==s);try{await p.put(`/home-sections/${t}`,{meta:{...a.meta||{},customProducts:n}},f),S()}catch(x){console.error(x),c.error("Could not remove product")}},yt=async t=>{if(!t)return"";try{return le(!0),await Ae(t)}catch(s){return console.error(s),c.error("Upload failed"),""}finally{le(!1)}},ft=async(t,s)=>{var d;const a=D.find(x=>x._id===t),n=(((d=a==null?void 0:a.meta)==null?void 0:d.products)||(a==null?void 0:a.productIds)||[]).filter(x=>x!==s);try{await p.put(`/home-sections/${t}`,{meta:{...a.meta||{},products:n}},f),S()}catch(x){console.error(x),c.error("Could not remove product")}},bt=async t=>{var s;if(t!=null&&t.length){re(!0);try{let a=Le+1;for(const r of Array.from(t)){const n=await it(r);if(!n)continue;const d=(s=r.type)!=null&&s.startsWith("video/")||Fe(n)?{video:n}:{image:n};await De(d,a),a+=1}c.success("Slides added"),Q("Added hero slides via upload"),S()}catch(a){console.error(a),c.error("Could not upload slides")}finally{re(!1)}}},jt=async()=>{if(de.trim()){re(!0);try{const t=de.trim(),s=Fe(t)?{video:t}:{image:t};await De(s,Le+1),je(""),c.success("Slide added"),Q("Added hero slide via link"),S()}catch(t){console.error(t),c.error("Could not save slide")}finally{re(!1)}}},Nt=async(t,s)=>{try{await p.put(`/home-sections/${t}`,{active:s},f),Q(`Slide ${s?"enabled":"disabled"}`),S()}catch(a){console.error(a),c.error("Could not update slide")}},vt=async t=>{if(window.confirm("Delete this slide?"))try{await p.delete(`/home-sections/${t}`,f),c.success("Slide removed"),Q("Removed a hero slide"),S()}catch(s){console.error(s),c.error("Could not delete slide")}},$e=async(t,s)=>{const a=U.findIndex(x=>x._id===t);if(a===-1)return;const r=s==="up"?a-1:a+1;if(r<0||r>=U.length)return;const n=U[a],d=U[r];try{await Promise.all([p.put(`/home-sections/${n._id}`,{order:d.order??r},f),p.put(`/home-sections/${d._id}`,{order:n.order??a},f)]),Q("Reordered hero slides"),S()}catch(x){console.error(x),c.error("Could not reorder slides")}},wt=async(t,s)=>{if(!t||!s||t===s)return;const a=U.findIndex(x=>x._id===t),r=U.findIndex(x=>x._id===s);if(a===-1||r===-1)return;const n=U[a],d=U[r];try{await Promise.all([p.put(`/home-sections/${n._id}`,{order:d.order??r},f),p.put(`/home-sections/${d._id}`,{order:n.order??a},f)]),Q("Reordered hero slides (drag)"),S()}catch(x){console.error(x),c.error("Could not reorder slides")}},Ct=async(t,s=[])=>{const a=[];D.forEach(r=>{var V;const n=((V=r.meta)==null?void 0:V.products)||r.productIds||[],d=n.includes(t),x=s.includes(r._id);if(x&&!d&&a.push(p.put(`/home-sections/${r._id}`,{meta:{...r.meta||{},products:[...n,t]}},f)),!x&&d){const T=n.filter(he=>he!==t);a.push(p.put(`/home-sections/${r._id}`,{meta:{...r.meta||{},products:T}},f))}}),a.length&&(await Promise.all(a),S())},kt=async()=>{var t,s,a;try{if(_e&&(o.sizes||[]).length===0){c.error("Select at least one size for suits");return}const r=new FormData;r.append("name",o.name),r.append("description",o.description),r.append("category",o.category),o.categoryRef&&r.append("categoryRef",o.categoryRef),r.append("fabric",o.fabric);const n=(o.colors||[]).join(",").trim();r.append("color",n||o.color||""),r.append("colors",(o.colors||[]).join(",")),r.append("sizes",(o.sizes||[]).join(",")),r.append("price",o.price||0),o.discountPrice&&r.append("discountPrice",o.discountPrice),r.append("stock",o.stock||0),o.amazonLink&&r.append("amazonLink",o.amazonLink.trim()),o.flipkartLink&&r.append("flipkartLink",o.flipkartLink.trim()),r.append("images",o.images),o.video&&r.append("video",o.video),r.append("collections",o.collectionIds.join(",")),k.forEach(V=>r.append("images",V));const d={headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}};let x=O;O?(await p.put(`/products/${O}`,r,d),c.success("Product updated")):(x=((t=(await p.post("/products",r,d)).data)==null?void 0:t._id)||x,c.success("Product created")),x&&await Ct(x,h),i(ge),v([]),$([]),K(null),se(),Y()}catch(r){console.error(r),c.error(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.msg)||"Failed to save product")}},St=t=>{var a,r,n,d;K(t._id),$([]),z(((a=t.sizes)==null?void 0:a.length)>0),i({name:t.name||"",description:t.description||"",category:t.category||"",categoryRef:((r=t.categoryRef)==null?void 0:r._id)||t.categoryRef||"",fabric:t.fabric||"",color:t.color||((n=t.colors)==null?void 0:n[0])||"",colors:Array.isArray(t.colors)&&t.colors.length?t.colors:t.color?t.color.split(/[,\\n]/).map(x=>x.trim()).filter(Boolean):[],sizes:t.sizes||[],amazonLink:t.amazonLink||"",flipkartLink:t.flipkartLink||"",price:t.price||"",discountPrice:t.discountPrice||"",stock:t.stock||"",images:(t.images||[]).join(`
`),video:t.video||"",collectionIds:((d=t.collections)==null?void 0:d.map(x=>x._id||x))||[]});const s=D.filter(x=>{var T;return(((T=x.meta)==null?void 0:T.products)||x.productIds||[]).includes(t._id)}).map(x=>x._id);v(s)},_t=()=>{i(ge),v([]),$([]),g(""),z(!1),K(null)},Lt=async t=>{if(window.confirm("Delete this product?"))try{await p.delete(`/products/${t}`,f),c.success("Deleted"),se(),Y()}catch{c.error("Failed to delete")}},It=async()=>{var t,s;try{await p.post("/collections",C,f),c.success("Collection created"),F(Be),Y()}catch(a){c.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.msg)||"Failed to create collection")}},me=async(t,s)=>{try{await p.put(`/collections/${t}`,s,f),c.success("Collection updated"),Y()}catch{c.error("Update failed")}},At=async t=>{if(window.confirm("Delete this collection?"))try{await p.delete(`/collections/${t}`,f),c.success("Collection removed"),Y(),se()}catch{c.error("Could not delete")}},Dt=async(t,s)=>{if(s)try{const a=new FormData;a.append("file",s);const r=await p.post("/uploads",a,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}});await me(t,{heroImage:r.data.url}),c.success("Image uploaded")}catch(a){console.error(a),c.error("Upload failed")}},Pt=async t=>{if(t)try{Z(!0);const s=new FormData;s.append("file",t);const a=await p.post("/uploads",s,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}});i(r=>({...r,video:a.data.url})),c.success("Video uploaded")}catch(s){console.error(s),c.error("Video upload failed")}finally{Z(!1)}},Ut=async t=>{if(!t)return"";try{const s=new FormData;s.append("file",t);const a=await p.post("/uploads",s,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}});return c.success("Image uploaded"),a.data.url}catch(s){return console.error(s),c.error("Upload failed"),""}},ae=async(t,s)=>{var a,r;try{await p.patch(`/orders/${t}`,s,f),c.success("Order updated"),ie()}catch(n){console.error(n),c.error(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.msg)||"Could not update order")}},$t=(t=[])=>t.map(s=>{var a;return(a=N.find(r=>r._id===s))==null?void 0:a.title}).filter(Boolean).join(", ");return!l||(b==null?void 0:b.role)!=="admin"?null:e.jsxs("div",{className:"admin-page min-h-screen bg-[var(--bg)]",children:[e.jsx("header",{className:"sticky top-0 z-30 bg-gradient-to-b from-[var(--surface)]/95 to-[var(--surface-muted)]/88 backdrop-blur border-b border-[var(--border)] shadow-[0_12px_40px_rgba(24,16,10,0.08)]",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[var(--muted)]",children:"Admin"}),e.jsx("h1",{className:"text-xl font-semibold text-[var(--ink)]",children:"Mrigmaya Control Room"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-[var(--muted)]",children:["Logged in as ",b==null?void 0:b.mobile]}),e.jsx("button",{onClick:()=>{_(),I("/admin/login")},className:"pill-button secondary hover:-translate-y-0.5",children:"Logout"})]})]})}),e.jsxs("main",{className:"max-w-6xl mx-auto px-6 py-8 space-y-10 admin-main",children:[e.jsxs("section",{className:"card-shell p-6 admin-card admin-grid",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Quick sections"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"What would you like to manage?"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Pick a section below. Each panel only shows the tools needed for that part of the store."}),e.jsx("div",{className:"flex flex-wrap gap-3 mt-4",children:Ye.map(t=>e.jsx("button",{onClick:()=>Qe(t.id),className:`admin-tab px-4 py-2 rounded-full text-sm font-semibold border transition ${E===t.id?"bg-[var(--primary)] text-white border-[var(--primary)] shadow-sm":"border-[var(--border)] text-[var(--muted)] hover:border-[var(--primary)] hover:text-[var(--ink)]"}`,children:t.label},t.id))})]}),E==="coupons"&&e.jsxs("section",{className:"card-shell p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Promotions"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Coupon generator"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create one-time or limited-use coupon codes with flat or percent discounts."})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Code"}),e.jsx("input",{value:w.code,onChange:t=>B({...w,code:t.target.value}),placeholder:"FIRST123",className:"border rounded-xl px-4 py-3 w-full"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Discount type"}),e.jsxs("select",{value:w.discountType,onChange:t=>B({...w,discountType:t.target.value}),className:"border rounded-xl px-4 py-3 w-full",children:[e.jsx("option",{value:"flat",children:"Flat amount (₹)"}),e.jsx("option",{value:"percent",children:"Percent (%)"})]}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Value"}),e.jsx("input",{type:"number",min:"1",value:w.value,onChange:t=>B({...w,value:t.target.value}),placeholder:"e.g. 500 or 10",className:"border rounded-xl px-4 py-3 w-full"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Max discount (optional, for %)"}),e.jsx("input",{type:"number",min:"0",value:w.maxDiscount,onChange:t=>B({...w,maxDiscount:t.target.value}),placeholder:"Cap for percent coupons",className:"border rounded-xl px-4 py-3 w-full"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Min order value (optional)"}),e.jsx("input",{type:"number",min:"0",value:w.minOrderValue,onChange:t=>B({...w,minOrderValue:t.target.value}),placeholder:"Apply only above this amount",className:"border rounded-xl px-4 py-3 w-full"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Max redemptions (overall)"}),e.jsx("input",{type:"number",min:"1",value:w.maxRedemptions,onChange:t=>B({...w,maxRedemptions:t.target.value}),className:"border rounded-xl px-4 py-3 w-full"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Expires at (optional)"}),e.jsx("input",{type:"datetime-local",value:w.expiresAt,onChange:t=>B({...w,expiresAt:t.target.value}),className:"border rounded-xl px-4 py-3 w-full"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:w.active,onChange:t=>B({...w,active:t.target.checked})}),"Active"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:mt,className:"bg-pink-600 text-white px-6 py-3 rounded-full",children:"Save coupon"}),e.jsx("button",{onClick:Ue,className:"border border-gray-200 text-gray-600 px-4 py-3 rounded-full",children:"Clear"})]})]})]}),e.jsx("div",{className:"mt-8 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"py-2",children:"Code"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Value"}),e.jsx("th",{children:"Min"}),e.jsx("th",{children:"Used"}),e.jsx("th",{children:"Expires"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[be.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 font-semibold text-gray-900",children:t.code}),e.jsx("td",{children:t.discountType}),e.jsxs("td",{children:[t.discountType==="percent"?`${t.value}%`:`₹${t.value}`,t.maxDiscount?` (cap ₹${t.maxDiscount})`:""]}),e.jsxs("td",{children:["₹",t.minOrderValue||0]}),e.jsxs("td",{children:[t.redemptions||0," / ",t.maxRedemptions||1]}),e.jsx("td",{children:t.expiresAt?new Date(t.expiresAt).toLocaleString():"No expiry"}),e.jsx("td",{children:t.active?"Active":"Inactive"}),e.jsxs("td",{className:"space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>p.patch(`/coupons/${t._id}`,{active:!t.active},f).then(oe).catch(()=>c.error("Update failed")),className:"text-xs text-pink-600",children:t.active?"Disable":"Enable"}),e.jsx("button",{type:"button",onClick:()=>window.confirm("Delete coupon?")&&p.delete(`/coupons/${t._id}`,f).then(oe).catch(()=>c.error("Delete failed")),className:"text-xs text-red-500",children:"Delete"})]})]},t._id)),be.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-4 text-center text-gray-400",children:"No coupons yet"})})]})]})})]}),E==="orders"&&e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Orders"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Recent orders"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Update payment or delivery status from one place."})]}),e.jsx("button",{onClick:ie,className:"text-sm text-gray-500 underline",children:"Refresh"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"py-2",children:"Order"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Shipping"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Payment"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Tracking"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[ne.map(t=>{var s,a;return e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"py-2",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["#",t._id.slice(-6).toUpperCase()]}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(t.createdAt).toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.items.length," item(s)"]}),e.jsx("div",{className:"text-[11px] text-gray-500 space-y-1 mt-1",children:t.items.map((r,n)=>{var d;return e.jsxs("div",{className:"flex flex-wrap gap-1 items-center",children:[e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-gray-100 text-gray-800 border border-gray-200",children:((d=r.product)==null?void 0:d.name)||"Item"}),r.selectedColor&&e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-amber-50 text-amber-800 border border-amber-100",children:r.selectedColor}),r.selectedSize&&e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-100",children:r.selectedSize}),e.jsxs("span",{className:"text-gray-400",children:["×",r.quantity]})]},`${r.product}-${n}`)})})]}),e.jsx("td",{className:"text-xs text-gray-600",children:((s=t.user)==null?void 0:s.mobile)||t.customerContact||"NA"}),e.jsxs("td",{className:"text-xs text-gray-600 max-w-xs",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:((a=t.shippingAddress)==null?void 0:a.name)||"—"}),e.jsx("p",{className:"text-gray-500",children:tt(t)}),t.customerNote&&e.jsxs("p",{className:"text-[11px] text-gray-400 mt-1",children:["Note: ",t.customerNote]})]}),e.jsxs("td",{className:"font-semibold text-gray-900",children:["₹",new Intl.NumberFormat("en-IN").format(t.amount||0)]}),e.jsx("td",{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:t.paymentMethod}),e.jsx("select",{className:"border rounded-lg px-2 py-1 text-xs",value:t.paymentStatus,onChange:r=>ae(t._id,{paymentStatus:r.target.value}),children:Bt.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]})}),e.jsx("td",{children:e.jsx("select",{className:"border rounded-lg px-2 py-1 text-xs",value:t.status,onChange:r=>ae(t._id,{status:r.target.value}),children:Tt.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})}),e.jsx("td",{className:"text-xs text-gray-600",children:e.jsxs("div",{className:"space-y-1",children:[(t.trackingLink||t.trackingNumber)&&e.jsx("a",{href:(t.trackingLink||t.trackingNumber||"").startsWith("http")?t.trackingLink||t.trackingNumber:void 0,target:"_blank",rel:"noreferrer",className:"text-[11px] text-pink-600 underline",children:"Open tracking"}),e.jsx("input",{type:"text",className:"border rounded-lg px-2 py-1 w-full",placeholder:"Paste tracking URL",defaultValue:t.trackingLink||"",onBlur:r=>ae(t._id,{trackingLink:r.target.value.trim()})}),!t.trackingLink&&t.trackingNumber&&e.jsxs("p",{className:"text-[11px] text-gray-500",children:["Current: ",t.trackingNumber]})]})}),e.jsxs("td",{className:"text-right space-y-2",children:[t.paymentMethod==="UPI"&&t.upiIntent&&e.jsx("a",{href:t.upiIntent,target:"_blank",rel:"noreferrer",className:"text-xs text-pink-600",children:"UPI link"}),e.jsx("button",{type:"button",onClick:()=>at(t._id),className:"block text-xs text-pink-600 underline",children:"Download bill"})]})]},t._id)}),ne.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-6 text-center text-gray-400",children:"No orders yet"})})]})]})})]}),E==="returns"&&e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Returns"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Return requests"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Approve/reject and view photos sent by customers."})]}),e.jsx("button",{onClick:ie,className:"text-sm text-gray-500 underline",children:"Refresh"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"py-2",children:"Order"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Reason"}),e.jsx("th",{children:"Photos"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Note"})]})}),e.jsxs("tbody",{children:[Ce.map(t=>{var s,a,r;return e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"py-2",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["#",t._id.slice(-6).toUpperCase()]}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(t.createdAt).toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.items.length," item(s)"]})]}),e.jsxs("td",{className:"text-xs text-gray-600",children:[((s=t.user)==null?void 0:s.mobile)||t.customerContact||"NA",e.jsxs("div",{className:"text-gray-500",children:[(a=t.shippingAddress)==null?void 0:a.name," ",(r=t.shippingAddress)==null?void 0:r.phone]})]}),e.jsxs("td",{className:"text-xs text-gray-600 max-w-xs",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.returnReason||"No reason"}),t.returnNote&&e.jsxs("p",{className:"text-gray-500",children:["Note: ",t.returnNote]})]}),e.jsx("td",{className:"text-xs text-gray-600",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(t.returnImages||[]).map((n,d)=>{const x=G(n);return e.jsx("a",{href:x,target:"_blank",rel:"noreferrer",className:"block w-16 h-16 rounded-lg overflow-hidden border border-gray-200",children:e.jsx("img",{src:x,alt:"return",className:"w-full h-full object-cover"})},d)}),(t.returnImages||[]).length===0&&e.jsx("span",{children:"None"})]})}),e.jsx("td",{children:e.jsx("select",{className:"border rounded-lg px-2 py-1 text-xs",value:t.returnStatus||"none",onChange:n=>ae(t._id,{returnStatus:n.target.value}),children:["requested","approved","rejected","received","refunded"].map(n=>e.jsx("option",{value:n,children:n},n))})}),e.jsx("td",{className:"text-xs",children:e.jsx("textarea",{className:"border rounded-lg px-2 py-1 text-xs w-full",placeholder:"Return note",defaultValue:t.returnNote||"",onBlur:n=>ae(t._id,{returnNote:n.target.value})})})]},t._id)}),Ce.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-6 text-center text-gray-400",children:"No return requests yet"})})]})]})})]}),E==="products"&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Catalog"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:O?"Edit product":"Create product"})]}),O&&e.jsx("button",{onClick:_t,className:"text-sm text-gray-500 underline",children:"Cancel edit"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-6",children:[e.jsx("input",{value:o.name,onChange:t=>i({...o,name:t.target.value}),placeholder:"Product name",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Assign category"}),e.jsxs("select",{value:o.categoryRef,onChange:t=>i({...o,categoryRef:t.target.value}),className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100 w-full",children:[e.jsx("option",{value:"",children:"Select category"}),L.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsx("input",{value:o.category,onChange:t=>i({...o,category:t.target.value}),placeholder:"Display label (ex. Banarasi, Poshaak)",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100"}),e.jsx("input",{value:o.fabric,onChange:t=>i({...o,fabric:t.target.value}),placeholder:"Fabric",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Available colors (Saree / Suit)"}),o.colors.length>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[o.colors.length," selected"]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:t=>z(t.target.checked)}),"Suit product? Show size picker"]}),e.jsxs("span",{className:"text-[11px]",children:["Detected category: ",xe?"Suit":"Other"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Ee.map(t=>{const s=o.colors.includes(t.label),a=He(t.label),r=typeof a=="string"&&a.startsWith("#")&&Ft(a)?"#1f2937":"#ffffff";return e.jsx("button",{type:"button",onClick:()=>ue(t.label),title:t.label,className:`px-3 py-2 rounded-full text-xs border transition shadow-sm ${s?"ring-2 ring-pink-200 border-pink-200":"border-gray-200"}`,style:{background:a,color:s?r:"#ffffff",minWidth:64,boxShadow:s?"0 4px 12px rgba(0,0,0,0.12)":"0 2px 6px rgba(0,0,0,0.06)"},children:t.label},t.label)})}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("input",{value:W,onChange:t=>g(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),Se())},placeholder:"Add custom color (press Enter)",className:"border rounded-xl px-4 py-3 flex-1 focus:outline-none focus:ring-2 focus:ring-pink-100"}),e.jsx("button",{type:"button",onClick:Se,className:"px-4 py-3 rounded-xl bg-gray-900 text-white text-sm",children:"Add"})]}),o.colors.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:o.colors.map(t=>e.jsxs("span",{className:"px-3 py-1 rounded-full border text-xs text-gray-700 flex items-center gap-2 shadow-sm",style:{background:He(t),borderColor:"rgba(0,0,0,0.08)",color:"#1f2937"},children:[t,e.jsx("button",{type:"button",className:"text-gray-400",onClick:()=>ue(t),children:"×"})]},t))})]}),_e&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Available sizes (Suit)"}),o.sizes.length===0&&e.jsx("span",{className:"text-xs text-red-500",children:"Select sizes for suits"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:t=>z(t.target.checked)}),"Force show sizes (for suit products without “suit” in category name)"]}),e.jsxs("span",{children:["Detected: ",xe?"Suit category":"Other"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Ht.map(t=>{const s=o.sizes.includes(t);return e.jsx("button",{type:"button",onClick:()=>et(t),className:`px-3 py-2 rounded-full text-xs border transition ${s?"bg-indigo-100 border-indigo-300 text-indigo-700":"bg-white border-gray-200 text-gray-600 hover:border-indigo-200"}`,children:t},t)})})]}),e.jsx("input",{value:o.amazonLink,onChange:t=>i({...o,amazonLink:t.target.value}),placeholder:"Amazon product link (optional)",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100",type:"url"}),e.jsx("input",{value:o.flipkartLink,onChange:t=>i({...o,flipkartLink:t.target.value}),placeholder:"Flipkart product link (optional)",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100",type:"url"}),e.jsx("input",{value:o.price,onChange:t=>i({...o,price:t.target.value}),placeholder:"Price (MRP)",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100",type:"number"}),e.jsx("input",{value:o.discountPrice,onChange:t=>i({...o,discountPrice:t.target.value}),placeholder:"Selling price",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100",type:"number"}),e.jsx("input",{value:o.stock,onChange:t=>i({...o,stock:t.target.value}),placeholder:"Stock",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100",type:"number"})]}),e.jsx("textarea",{value:o.description,onChange:t=>i({...o,description:t.target.value}),placeholder:"Description / story",className:"border rounded-2xl px-4 py-3 w-full mt-4 focus:outline-none focus:ring-2 focus:ring-pink-100",rows:3}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Existing image URLs (one per line)"}),e.jsx("textarea",{value:o.images,onChange:t=>i({...o,images:t.target.value}),className:"border rounded-2xl px-4 py-3 w-full focus:outline-none focus:ring-2 focus:ring-pink-100",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Upload new images (select multiple)"}),e.jsx("input",{type:"file",multiple:!0,onChange:t=>$(Array.from(t.target.files)),className:"border rounded-xl px-4 py-3 w-full"}),k.length>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-2 space-y-1",children:[e.jsxs("p",{children:[k.length," new file(s) selected"]}),e.jsxs("ul",{className:"list-disc list-inside space-y-0.5",children:[k.slice(0,4).map(t=>e.jsx("li",{children:t.name},t.name)),k.length>4&&e.jsxs("li",{children:["+",k.length-4," more"]})]})]}),te.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Currently attached (",te.length,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[te.slice(0,8).map((t,s)=>e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-gray-200 bg-gray-50",children:e.jsx("img",{src:G(t),alt:"",className:"w-full h-full object-cover"})},`${t}-${s}`)),te.length>8&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",te.length-8," more"]})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Attach to homepage collections (Sarees / Suits / Gold / Best Seller)"}),e.jsx("select",{multiple:!0,value:o.collectionIds,onChange:t=>i({...o,collectionIds:Array.from(t.target.selectedOptions,s=>s.value)}),className:"border rounded-xl px-4 py-3 w-full focus:outline-none focus:ring-2 focus:ring-pink-100 h-40",children:N.map(t=>e.jsx("option",{value:t._id,children:t.title},t._id))}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2 text-xs",children:[N.map(t=>e.jsxs("button",{type:"button",className:"px-3 py-1 border border-gray-200 rounded-full",onClick:()=>i(s=>s.collectionIds.includes(t._id)?s:{...s,collectionIds:[...s.collectionIds,t._id]}),children:["Add to ",t.title]},`quick-${t._id}`)),o.collectionIds.length>0&&e.jsx("button",{type:"button",className:"px-3 py-1 border border-gray-200 rounded-full text-gray-500",onClick:()=>i(t=>({...t,collectionIds:[]})),children:"Clear selections"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Attach to mood cards (home tiles)"}),e.jsx("select",{multiple:!0,value:h,onChange:t=>v(Array.from(t.target.selectedOptions,s=>s.value)),className:"border rounded-xl px-4 py-3 w-full focus:outline-none focus:ring-2 focus:ring-pink-100 h-32",children:D.map(t=>e.jsxs("option",{value:t._id,children:[t.title||"Untitled"," ",t.tag?`(${t.tag})`:""]},t._id))}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2 text-xs",children:[D.map(t=>e.jsxs("button",{type:"button",className:"px-3 py-1 border border-gray-200 rounded-full",onClick:()=>v(s=>s.includes(t._id)?s:[...s,t._id]),children:["Add to ",t.title||"Mood"]},`quick-mood-${t._id}`)),h.length>0&&e.jsx("button",{type:"button",className:"px-3 py-1 border border-gray-200 rounded-full text-gray-500",onClick:()=>v([]),children:"Clear mood selection"})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Product video URL (optional)"}),e.jsx("input",{value:o.video,onChange:t=>i({...o,video:t.target.value}),placeholder:"https://... (mp4 / hosted link)",className:"border rounded-xl px-4 py-3 w-full focus:outline-none focus:ring-2 focus:ring-pink-100"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"file",accept:"video/*",className:"text-sm",onChange:t=>{var s;return Pt((s=t.target.files)==null?void 0:s[0])}}),J&&e.jsx("span",{className:"text-xs text-gray-400",children:"Uploading..."})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Paste a hosted link or upload to store on server."})]})}),e.jsx("button",{onClick:kt,className:"mt-6 bg-pink-600 text-white px-6 py-3 rounded-full",children:O?"Update product":"Create product"})]}),e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Live catalog"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Products"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"py-2",children:"Name"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Collections"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:y.map(t=>{var s;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2",children:t.name}),e.jsx("td",{children:t.discountPrice||t.price}),e.jsx("td",{className:"text-xs text-gray-500",children:$t((s=t.collections)==null?void 0:s.map(a=>a._id||a))}),e.jsxs("td",{className:"text-right space-x-3",children:[e.jsx("button",{className:"text-pink-600",onClick:()=>St(t),children:"Edit"}),e.jsx("button",{className:"text-gray-400",onClick:()=>Lt(t._id),children:"Delete"})]})]},t._id)})})]})})]})]}),E==="usp"&&e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Offers rail"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Homepage offers"}),e.jsx("p",{className:"text-sm text-gray-500",children:"These cards show in the scrolling rail. Set order to control their position."})]}),e.jsx("button",{onClick:S,className:"text-sm text-gray-500 underline",children:"Refresh"})]}),e.jsx(Wt,{items:Ie,onSave:lt,onDelete:nt})]}),E==="collections"&&e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Homepage sections"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Collection studio"})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-6",children:[e.jsx("input",{value:C.title,onChange:t=>F({...C,title:t.target.value}),placeholder:"Title",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:C.slug,onChange:t=>F({...C,slug:t.target.value}),placeholder:"Slug (unique)",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:C.subtitle,onChange:t=>F({...C,subtitle:t.target.value}),placeholder:"Subtitle",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:C.ctaLabel,onChange:t=>F({...C,ctaLabel:t.target.value}),placeholder:"CTA Label",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:C.heroImage,onChange:t=>F({...C,heroImage:t.target.value}),placeholder:"Hero image URL",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:C.accentColor,onChange:t=>F({...C,accentColor:t.target.value}),placeholder:"Accent color",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:C.priority,type:"number",onChange:t=>F({...C,priority:Number(t.target.value)}),placeholder:"Priority (lower first)",className:"border rounded-xl px-4 py-3"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:C.displayOnHome,onChange:t=>F({...C,displayOnHome:t.target.checked})}),"Display on homepage"]})]}),e.jsx("textarea",{value:C.description,onChange:t=>F({...C,description:t.target.value}),placeholder:"Description",className:"border rounded-2xl px-4 py-3 w-full mt-4",rows:3}),e.jsx("button",{onClick:It,className:"mt-4 bg-gray-900 text-white px-6 py-3 rounded-full",children:"Create collection"}),e.jsxs("div",{className:"mt-10 space-y-10 admin-collections",children:[N.length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:"Create a collection to start building your home tiles."}),N.map(t=>e.jsxs("div",{className:"admin-collection-row",children:[e.jsx(Gt,{collection:t,onSave:s=>me(t._id,s),onDelete:()=>At(t._id),onHeroUpload:s=>Dt(t._id,s),onGalleryUpload:s=>Ut(s)}),e.jsx(qt,{collection:t,products:y,onUpdate:s=>me(t._id,{products:s})})]},t._id))]})]}),E==="homepage"&&e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Homepage slider"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Hero image manager"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Upload multiple hero images at once and they will rotate on the storefront automatically."})]}),e.jsxs("div",{className:"mt-6 border border-gray-100 rounded-2xl p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Upload photos / videos"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select one or more images or MP4/WebM clips."}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",className:"mt-3 text-sm",onChange:t=>{bt(t.target.files),t.target.value=""}})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Or paste an image / video link"}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row mt-2",children:[e.jsx("input",{value:de,onChange:t=>je(t.target.value),placeholder:"https://example.com/hero.jpg or https://example.com/hero.mp4",className:"border rounded-xl px-4 py-2 text-sm flex-1"}),e.jsx("button",{onClick:jt,className:"px-4 py-2 rounded-xl bg-gray-900 text-white text-sm",children:"Add slide"})]})]}),We&&e.jsx("p",{className:"text-xs text-gray-400",children:"Uploading..."})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Slides"}),e.jsxs("h3",{className:"text-xl font-semibold text-gray-900",children:[U.length," slide",U.length===1?"":"s"]})]})}),U.length===0?e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"No slides yet. Upload images to get started."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:U.map((t,s)=>e.jsx(Et,{slide:t,index:s,isLast:s===U.length-1,onToggle:a=>Nt(t._id,a),onDelete:()=>vt(t._id),onMoveUp:()=>$e(t._id,"up"),onMoveDown:()=>$e(t._id,"down"),onReorder:a=>wt(a,t._id)},t._id))})]}),we.length>0&&e.jsxs("div",{className:"mt-6 bg-white border border-gray-100 rounded-2xl p-4 space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Recent changes"}),e.jsx("ul",{className:"space-y-1 text-sm text-gray-700",children:we.map((t,s)=>e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:new Date(t.ts).toLocaleTimeString()})," ",t.message]},`${t.ts}-${s}`))})]}),e.jsxs("div",{className:"mt-10 border-t pt-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Featured edits"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Mood cards (home tiles)"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Add tiles like Saree / Suit / Jewellery. Set title, badge, link, and image."})]}),ee&&e.jsx("button",{onClick:pe,className:"text-sm text-gray-500 underline",children:"Cancel edit"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Title"}),e.jsx("input",{value:M.title,onChange:t=>R(s=>({...s,title:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Saree"}),e.jsx("label",{className:"text-sm text-gray-600",children:"Subtitle"}),e.jsx("input",{value:M.subtitle,onChange:t=>R(s=>({...s,subtitle:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Pure zari woven"}),e.jsx("label",{className:"text-sm text-gray-600",children:"Badge / tag"}),e.jsx("input",{value:M.tag,onChange:t=>R(s=>({...s,tag:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Bestseller / New"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"CTA label"}),e.jsx("input",{value:M.ctaLabel,onChange:t=>R(s=>({...s,ctaLabel:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Shop sarees >"}),e.jsx("label",{className:"text-sm text-gray-600",children:"CTA link"}),e.jsx("input",{value:M.ctaLink,onChange:t=>R(s=>({...s,ctaLink:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"/products or /collection/sarees"}),e.jsx("label",{className:"text-sm text-gray-600",children:"Display order"}),e.jsx("input",{type:"number",value:M.order,onChange:t=>R(s=>({...s,order:Number(t.target.value)})),className:"border rounded-xl px-3 py-2 w-full"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Image URL"}),e.jsx("input",{value:M.image,onChange:t=>R(s=>({...s,image:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"https://..."}),e.jsx("input",{type:"file",accept:"image/*",className:"mt-2 text-sm",onChange:t=>{var s;return ut((s=t.target.files)==null?void 0:s[0])}}),Xe&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Uploading..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Attach products"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("select",{className:"border rounded-xl px-3 py-2 text-sm flex-1",value:"",onChange:t=>{const s=t.target.value;s&&R(a=>a.productIds.includes(s)?a:{...a,productIds:[...a.productIds,s]})},children:[e.jsx("option",{value:"",children:"Choose product"}),y.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]}),e.jsx("span",{className:"text-xs text-gray-500 self-center",children:"Pick items to show when opening this edit."})]}),M.productIds.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:M.productIds.map(t=>{const s=y.find(a=>a._id===t);return e.jsxs("span",{className:"px-3 py-1 rounded-full bg-gray-100 text-xs text-gray-700 flex items-center gap-2",children:[(s==null?void 0:s.name)||"Product",e.jsx("button",{type:"button",className:"text-gray-500",onClick:()=>R(a=>({...a,productIds:a.productIds.filter(r=>r!==t)})),children:"×"})]},t)})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-6",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:M.active,onChange:t=>R(s=>({...s,active:t.target.checked}))}),"Active"]}),e.jsx("button",{onClick:ct,className:"px-5 py-3 bg-pink-600 text-white rounded-full text-sm font-semibold",children:ee?"Update card":"Save card"})]}),e.jsxs("div",{className:"mt-6 grid md:grid-cols-3 gap-3",children:[D.map((t,s)=>e.jsx(Vt,{card:{...t,allProducts:y},index:s,isLast:s===D.length-1,onEdit:()=>dt(t),onDelete:()=>xt(t._id),onToggle:a=>p.put(`/home-sections/${t._id}`,{active:a},f).then(S).catch(()=>c.error("Could not update card")),onMoveUp:()=>Pe(t._id,"up"),onMoveDown:()=>Pe(t._id,"down"),onAddProduct:a=>pt(t._id,a),onDeleteProduct:a=>ft(t._id,a),allProducts:y,onAddCustom:a=>ht(t._id,a),onDeleteCustom:a=>gt(t._id,a),onUploadCustom:yt},t._id)),D.length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:"No mood cards yet. Add up to 3 tiles."})]})]})]}),E==="login-visuals"&&e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Login page"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Side visuals"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Update the left and right images shown on the login screen. Leave blank to hide."})]})}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:ye.map((t,s)=>e.jsxs("div",{className:"border border-gray-100 rounded-2xl p-4 space-y-3",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-800",children:["Visual ",s===0?"Left":"Right"]}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Title"}),e.jsx("input",{value:t.title,onChange:a=>ce(s,"title",a.target.value),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Sequin night"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Subtitle"}),e.jsx("input",{value:t.subtitle,onChange:a=>ce(s,"subtitle",a.target.value),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Cocktail sarees"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Image URL"}),e.jsx("input",{value:t.image,onChange:a=>ce(s,"image",a.target.value),className:"border rounded-xl px-3 py-2 w-full",placeholder:"https://..."}),e.jsx("input",{type:"file",accept:"image/*",className:"text-sm",onChange:a=>{var n;const r=(n=a.target.files)==null?void 0:n[0];ot(r,s),a.target.value=""}}),qe&&e.jsx("p",{className:"text-xs text-gray-400",children:"Uploading..."}),t.image&&e.jsx("div",{className:"mt-2 rounded-xl overflow-hidden h-32 bg-gray-100",children:e.jsx("img",{src:G(t.image),alt:t.title,className:"w-full h-full object-cover"})})]},s))}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:rt,className:"px-5 py-3 bg-pink-600 text-white rounded-full text-sm font-semibold",children:"Save visuals"})})]})]})]})}function Et({slide:l,index:b,isLast:_,onToggle:I,onDelete:y,onMoveUp:m,onMoveDown:N,onReorder:A}){var v;const L=G(l.video||l.heroVideo||((v=l.meta)==null?void 0:v.video)||""),P=G(l.image||l.heroImage||(Array.isArray(l.images)?l.images[0]:"")),o=L||P,i=l.active!==!1,h=!!L;return e.jsxs("div",{className:"border border-gray-200 rounded-2xl p-4 space-y-3 bg-white",draggable:!0,onDragStart:k=>k.dataTransfer.setData("text/plain",l._id),onDragOver:k=>k.preventDefault(),onDrop:k=>{k.preventDefault();const $=k.dataTransfer.getData("text/plain");$&&(A==null||A($,l._id))},children:[e.jsx("div",{className:"rounded-xl overflow-hidden bg-gray-100 aspect-[16/9]",children:o?h?e.jsx("video",{src:o,poster:P||void 0,className:"w-full h-full object-cover",muted:!0,loop:!0,playsInline:!0,preload:"metadata"}):e.jsx("img",{src:o,alt:l.title||`Slide ${b+1}`,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-400",children:"No media"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["Slide ",b+1]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Order ",l.order??b+1]})]}),o&&e.jsx("a",{href:o,target:"_blank",rel:"noreferrer",className:"text-xs text-pink-600",children:"View"})]}),h&&e.jsx("span",{className:"inline-block text-[11px] text-indigo-600 font-semibold",children:"Video slide"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:k=>I(k.target.checked)}),"Show on homepage"]}),(l.title||l.description)&&e.jsxs("div",{className:"text-xs text-gray-500",children:[l.title&&e.jsx("p",{className:"font-semibold",children:l.title}),l.description&&e.jsx("p",{children:l.description})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[e.jsx("button",{type:"button",onClick:m,disabled:b===0,className:`px-3 py-2 rounded-xl border ${b===0?"text-gray-300 border-gray-200 cursor-not-allowed":"text-gray-700 border-gray-300"}`,children:"Move up"}),e.jsx("button",{type:"button",onClick:N,disabled:_,className:`px-3 py-2 rounded-xl border ${_?"text-gray-300 border-gray-200 cursor-not-allowed":"text-gray-700 border-gray-300"}`,children:"Move down"}),e.jsx("button",{type:"button",onClick:y,className:"px-3 py-2 rounded-xl border border-red-200 text-red-600",children:"Delete"})]})]})}function Vt({card:l,index:b,isLast:_,onEdit:I,onDelete:y,onToggle:m,onMoveUp:N,onMoveDown:A,onAddProduct:L,onDeleteProduct:P,onAddCustom:o,onDeleteCustom:i,onUploadCustom:h,allProducts:v}){var W,g;u.useState({name:"",price:"",mrp:"",image:"",images:[]});const k=l.active!==!1,$=((W=l.meta)==null?void 0:W.products)||l.productIds||[];return(g=l.meta)!=null&&g.customProducts,e.jsxs("div",{className:"border border-gray-200 rounded-2xl p-3 space-y-2 bg-white shadow-sm",children:[e.jsx("div",{className:"rounded-xl overflow-hidden bg-gray-100 aspect-[4/5]",children:l.image?e.jsx("img",{src:G(l.image),alt:l.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-400",children:"No image"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400 flex items-center gap-2",children:[l.tag||"Mood"," ",e.jsx("span",{className:"text-gray-300",children:"·"})," Order ",l.order??b+1]}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:l.title||"Untitled"}),l.subtitle&&e.jsx("p",{className:"text-sm text-gray-500",children:l.subtitle}),$.length>0&&e.jsxs("p",{className:"text-[11px] text-gray-500",children:[$.length," product",$.length===1?"":"s"]}),l.ctaLabel&&e.jsxs("p",{className:"text-[11px] text-pink-600 mt-1",children:[l.ctaLabel," → ",l.ctaLink||"/products"]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:j=>m(j.target.checked)}),"Active"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[e.jsx("button",{onClick:I,className:"px-3 py-2 rounded-xl border border-gray-300 text-gray-700",children:"Edit"}),e.jsx("button",{onClick:N,disabled:b===0,className:`px-3 py-2 rounded-xl border ${b===0?"text-gray-300 border-gray-200 cursor-not-allowed":"text-gray-700 border-gray-300"}`,children:"Up"}),e.jsx("button",{onClick:A,disabled:_,className:`px-3 py-2 rounded-xl border ${_?"text-gray-300 border-gray-200 cursor-not-allowed":"text-gray-700 border-gray-300"}`,children:"Down"}),e.jsx("button",{onClick:y,className:"px-3 py-2 rounded-xl border border-red-200 text-red-600",children:"Delete"})]}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[e.jsx("p",{className:"font-semibold",children:"Attached products"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[$.length===0&&e.jsx("span",{className:"text-gray-400",children:"None"}),$.map(j=>{var z,J,Z,O,K;return e.jsxs("span",{className:"px-3 py-1 rounded-full bg-gray-100 text-gray-700 flex items-center gap-2",children:[((J=(z=l.products)==null?void 0:z.find(C=>C._id===j))==null?void 0:J.name)||((K=(O=(Z=l.meta)==null?void 0:Z.productsDetails)==null?void 0:O.find(C=>C._id===j))==null?void 0:K.name)||j,e.jsx("button",{type:"button",className:"text-gray-500",onClick:()=>P(j),children:"×"})]},j)})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{className:"border rounded-xl px-2 py-1 flex-1",value:"",onChange:j=>L(j.target.value),children:[e.jsx("option",{value:"",children:"Add product"}),(v||[]).map(j=>e.jsx("option",{value:j._id,children:j.name},j._id))]})})]})]})}function Gt({collection:l,onSave:b,onDelete:_,onHeroUpload:I,onGalleryUpload:y}){var W;const[m,N]=u.useState({title:l.title,subtitle:l.subtitle||"",description:l.description||"",ctaLabel:l.ctaLabel||"",heroImage:l.heroImage||"",accentColor:l.accentColor||"#c1275a",displayOnHome:l.displayOnHome,priority:l.priority}),[A,L]=u.useState(l.heroImages||[]),[P,o]=u.useState(""),[i,h]=u.useState(!1);u.useEffect(()=>{N({title:l.title,subtitle:l.subtitle||"",description:l.description||"",ctaLabel:l.ctaLabel||"",heroImage:l.heroImage||"",accentColor:l.accentColor||"#c1275a",displayOnHome:l.displayOnHome,priority:l.priority}),L(l.heroImages||[])},[l]);const v=()=>{P.trim()&&(L(g=>[...g,P.trim()]),o(""))},k=g=>{L(j=>j.filter((z,J)=>J!==g))},$=async g=>{if(g){h(!0);try{const j=await y(g);j&&L(z=>[...z,j])}finally{h(!1)}}};return e.jsx("div",{className:"border border-gray-200 rounded-2xl p-4",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:l.title}),e.jsxs("span",{className:"text-xs text-gray-500",children:[((W=l.products)==null?void 0:W.length)||0," items linked"]})]}),e.jsx("input",{value:m.title,onChange:g=>N({...m,title:g.target.value}),placeholder:"Collection title",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsx("input",{value:m.subtitle,onChange:g=>N({...m,subtitle:g.target.value}),placeholder:"Subtitle",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsx("textarea",{value:m.description,onChange:g=>N({...m,description:g.target.value}),placeholder:"Description",className:"border rounded-xl px-3 py-2 text-sm",rows:2}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx("input",{value:m.ctaLabel,onChange:g=>N({...m,ctaLabel:g.target.value}),placeholder:"CTA label",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsxs("div",{children:[e.jsx("input",{value:m.heroImage,onChange:g=>N({...m,heroImage:g.target.value}),placeholder:"Hero image URL",className:"border rounded-xl px-3 py-2 text-sm w-full"}),e.jsx("input",{type:"file",className:"mt-2 text-sm",onChange:g=>{var j;return I((j=g.target.files)==null?void 0:j[0])}}),e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("button",{type:"button",onClick:()=>N(g=>({...g,heroImage:""})),className:"text-xs text-gray-500 underline",children:"Remove hero image"}),m.heroImage&&e.jsx("a",{href:m.heroImage,target:"_blank",rel:"noreferrer",className:"text-xs text-pink-600",children:"View"})]}),m.heroImage&&e.jsx("div",{className:"mt-2 rounded-xl overflow-hidden border bg-gray-50",children:e.jsx("img",{src:G(m.heroImage),alt:"Hero preview",className:"w-full h-48 object-cover"})})]})]}),e.jsxs("div",{className:"border border-gray-100 rounded-2xl p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Hero gallery"}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-3",children:[A.map((g,j)=>e.jsxs("div",{className:"w-16 h-16 rounded-xl overflow-hidden relative",children:[e.jsx("img",{src:G(g),alt:"gallery",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>k(j),className:"absolute top-1 right-1 bg-black/60 text-white text-[10px] px-1 rounded",children:"✕"})]},`${g}-${j}`)),A.length===0&&e.jsx("p",{className:"text-xs text-gray-400",children:"No gallery images yet"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:P,onChange:g=>o(g.target.value),placeholder:"Image URL",className:"border rounded-xl px-3 py-2 text-sm flex-1"}),e.jsx("button",{type:"button",onClick:v,className:"px-3 py-2 rounded-xl bg-gray-900 text-white text-sm",children:"Add"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",className:"text-sm",onChange:g=>{var j;return $((j=g.target.files)==null?void 0:j[0])}}),i&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Uploading image..."})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[e.jsx("input",{value:m.accentColor,onChange:g=>N({...m,accentColor:g.target.value}),placeholder:"#c1275a",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsx("input",{type:"number",value:m.priority,onChange:g=>N({...m,priority:Number(g.target.value)}),placeholder:"Priority",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:m.displayOnHome,onChange:g=>N({...m,displayOnHome:g.target.checked})}),"Show on home"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("button",{onClick:()=>b({...m,heroImages:A}),className:"px-4 py-2 bg-gray-900 text-white rounded-full",children:"Save collection"}),e.jsx("button",{onClick:_,className:"text-gray-400",children:"Delete"})]})]})})}function Wt({items:l,onSave:b,onDelete:_}){const I={title:"",subtitle:"",tag:"",badge:"",ctaLabel:"",ctaLink:"/products",order:1,active:!0},[y,m]=u.useState(I),[N,A]=u.useState(null),L=i=>{A(i._id),m({title:i.title||"",subtitle:i.subtitle||"",tag:i.tag||"",badge:i.badge||"",ctaLabel:i.ctaLabel||"",ctaLink:i.ctaLink||"/products",order:i.order??1,active:i.active!==!1})},P=()=>{A(null),m(I)},o=()=>{b(y,N),P()};return e.jsxs("div",{className:"grid md:grid-cols-[1.1fr,0.9fr] gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{value:y.title,onChange:i=>m({...y,title:i.target.value}),placeholder:"Title (e.g. Flat 10% off)",className:"border rounded-xl px-3 py-2 w-full"}),e.jsx("input",{value:y.subtitle,onChange:i=>m({...y,subtitle:i.target.value}),placeholder:"Subtitle (e.g. Use code FEST10)",className:"border rounded-xl px-3 py-2 w-full"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[e.jsx("input",{value:y.tag,onChange:i=>m({...y,tag:i.target.value}),placeholder:"Tag (e.g. Limited)",className:"border rounded-xl px-3 py-2 w-full"}),e.jsx("input",{value:y.badge,onChange:i=>m({...y,badge:i.target.value}),placeholder:"Badge (e.g. Ends Sunday)",className:"border rounded-xl px-3 py-2 w-full"})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[e.jsx("input",{value:y.ctaLabel,onChange:i=>m({...y,ctaLabel:i.target.value}),placeholder:"CTA label (e.g. Shop now)",className:"border rounded-xl px-3 py-2 w-full"}),e.jsx("input",{value:y.ctaLink,onChange:i=>m({...y,ctaLink:i.target.value}),placeholder:"CTA link (e.g. /products)",className:"border rounded-xl px-3 py-2 w-full"})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",value:y.order,onChange:i=>m({...y,order:Number(i.target.value)}),placeholder:"Order (lower shows first)",className:"border rounded-xl px-3 py-2 w-full"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:y.active,onChange:i=>m({...y,active:i.target.checked})}),"Active"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-gray-900 text-white rounded-full",children:N?"Update offer":"Add offer"}),N&&e.jsx("button",{onClick:P,className:"text-sm text-gray-500 underline",children:"Cancel edit"})]})]}),e.jsxs("div",{className:"space-y-3",children:[l.map(i=>e.jsxs("div",{className:"border border-gray-200 rounded-2xl p-3 bg-white shadow-sm flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[i.title," ",i.tag&&e.jsxs("span",{className:"text-xs text-gray-500",children:["• ",i.tag]})]}),i.subtitle&&e.jsx("p",{className:"text-xs text-gray-600",children:i.subtitle}),e.jsxs("div",{className:"flex gap-2 text-[11px] text-gray-500",children:[e.jsxs("span",{children:["Order ",i.order??0]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:i.active===!1?"Hidden":"Active"})]}),(i.ctaLabel||i.ctaLink)&&e.jsxs("p",{className:"text-xs text-pink-600",children:[i.ctaLabel||"CTA"," → ",i.ctaLink||"/products"]})]}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs",children:[e.jsx("button",{onClick:()=>L(i),className:"text-pink-600",children:"Edit"}),e.jsx("button",{onClick:()=>_(i._id),className:"text-red-500",children:"Delete"})]})]},i._id)),l.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"No offers yet."})]})]})}function qt({collection:l,products:b,onUpdate:_}){const[I,y]=u.useState(""),[m,N]=u.useState(""),A=(l.products||[]).map(h=>typeof h=="string"?b.find(v=>v._id===h):h).filter(Boolean),L=A.map(h=>h._id),P=b.filter(h=>!L.includes(h._id)).filter(h=>{var v;return(v=h.name)==null?void 0:v.toLowerCase().includes(I.toLowerCase())});u.useEffect(()=>{y(""),N("")},[l==null?void 0:l._id]);const o=h=>{const v=L.filter(k=>k!==h);_(v)},i=()=>{if(!m)return;const h=[...L,m];_(h),N(""),y("")};return e.jsxs("div",{className:"border border-gray-100 rounded-3xl p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Linked products"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Attach items to this collection. They will appear on the homepage rail exactly in this order."}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Add product"}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsx("input",{value:I,onChange:h=>y(h.target.value),placeholder:"Search products",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:m,onChange:h=>N(h.target.value),className:"border rounded-xl px-3 py-2 text-sm flex-1",children:[e.jsx("option",{value:"",children:"Choose product"}),P.slice(0,30).map(h=>e.jsx("option",{value:h._id,children:h.name},h._id))]}),e.jsx("button",{onClick:i,className:"px-4 py-2 rounded-xl bg-gray-900 text-white text-sm",children:"Add"})]}),P.length===0&&e.jsx("p",{className:"text-xs text-gray-400",children:"No more products match this search."})]})]}),e.jsxs("div",{className:"mt-6 space-y-3 max-h-[420px] overflow-y-auto pr-2",children:[A.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"No products linked yet."}),A.map(h=>{var v;return e.jsxs("div",{className:"border border-gray-100 rounded-2xl p-3 flex items-center gap-3 bg-white",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl overflow-hidden bg-gray-100 flex-shrink-0",children:e.jsx("img",{src:G((v=h.images)==null?void 0:v[0]),alt:h.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:h.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(Te(h)||h.category)&&e.jsxs("span",{children:[Te(h)||h.category," • "]}),"Rs."," ",new Intl.NumberFormat("en-IN").format(h.discountPrice||h.price||0)]})]}),e.jsx("button",{onClick:()=>o(h._id),className:"text-xs text-gray-500",children:"Remove"})]},h._id)})]})]})}export{Qt as default};
