import{r as i,A as H,C as L,u as W,j as e,z as n,i as g}from"./index-99c83c38.js";const x=c=>new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(c||0),K=[{value:"COD",label:"Cash on delivery (Pay to courier)"},{value:"UPI",label:"Pay now (GPay / PhonePe / UPI)"}],Q="rzp_test_RjUFdd3BB4mysD",Z=()=>new Promise(c=>{if(window.Razorpay)return c(!0);const d=document.createElement("script");d.src="https://checkout.razorpay.com/v1/checkout.js",d.onload=()=>c(!0),d.onerror=()=>c(!1),document.body.appendChild(d)});function ee(){const{token:c,user:d}=i.useContext(H),{cart:m,fetchCart:w}=i.useContext(L),f=W(),[h,U]=i.useState("COD"),[P,z]=i.useState(!1),[b,k]=i.useState(""),[l,y]=i.useState(null),[S,R]=i.useState(!1),[r,u]=i.useState({name:(d==null?void 0:d.name)||"",phone:(d==null?void 0:d.mobile)||"",line1:"",line2:"",city:"",state:"",pincode:""}),[j,$]=i.useState(""),v=i.useMemo(()=>m.reduce((a,t)=>{var s,o;return a+((((s=t.product)==null?void 0:s.discountPrice)||((o=t.product)==null?void 0:o.price)||0)*t.quantity||0)},0),[m]),N=(l==null?void 0:l.discount)||0,A=Math.max(0,v-N),_=Math.round(A*(h==="UPI"?.1:0)),D=Math.max(0,A-_),F=()=>c?m.length?r.name.trim()?!r.phone||r.phone.replace(/\D/g,"").length<10?(n.error("Please enter a valid phone number"),null):r.line1.trim()?r.city.trim()?r.state.trim()?!r.pincode||r.pincode.replace(/\D/g,"").length<6?(n.error("Please enter a valid pincode"),null):{name:r.name.trim(),phone:r.phone.trim(),line1:r.line1.trim(),line2:r.line2.trim(),city:r.city.trim(),state:r.state.trim(),pincode:r.pincode.trim()}:(n.error("Please enter state"),null):(n.error("Please enter city"),null):(n.error("Please enter house/flat and street"),null):(n.error("Please enter recipient name"),null):(n.error("Cart is empty"),null):(f("/login"),null),B=async a=>{var s;const{data:t}=await g.post("/orders",{paymentMethod:"COD",shippingAddress:a,customerNote:j.trim(),couponCode:(l==null?void 0:l.code)||""},{headers:{Authorization:`Bearer ${c}`}});await w(),n.success(t.message||"Order placed"),f("/order-success",{state:{orderId:(s=t.order)==null?void 0:s._id,paymentMethod:"COD"}})},E=async a=>{var I,O,M;if(!await Z()){n.error("Could not load Razorpay. Check your connection.");return}const{data:s}=await g.post("/orders/create",{shippingAddress:a,customerNote:j.trim(),couponCode:(l==null?void 0:l.code)||""},{headers:{Authorization:`Bearer ${c}`}}),o=s.razorpayOrder,p=s.order;new window.Razorpay({key:Q,amount:o.amount,currency:o.currency,name:"Mrigmaya",description:((M=(O=(I=p==null?void 0:p.items)==null?void 0:I[0])==null?void 0:O.product)==null?void 0:M.name)||"Saree order",order_id:o.id,prefill:{name:a.name,contact:a.phone},handler:async C=>{try{await g.post("/orders/verify",{razorpay_payment_id:C.razorpay_payment_id,razorpay_order_id:C.razorpay_order_id,razorpay_signature:C.razorpay_signature},{headers:{Authorization:`Bearer ${c}`}}),await w(),n.success("Payment success"),f("/order-success",{state:{orderId:p==null?void 0:p._id,paymentMethod:"RAZORPAY"}})}catch(G){console.error(G),n.error("Payment verification failed. Contact support if charged.")}},modal:{ondismiss:()=>{n.error("Payment cancelled. You can try again.")}}}).open()},Y=async()=>{var t,s;const a=F();if(a){l&&!l.code&&y(null);try{z(!0),h==="UPI"?await E(a):await B(a)}catch(o){console.error(o),n.error(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.msg)||"Could not place order")}finally{z(!1)}}},q=async()=>{var a,t;if(!b.trim()){n.error("Enter a coupon code");return}R(!0);try{const{data:s}=await g.post("/coupons/apply",{code:b.trim(),amount:v},{headers:{Authorization:`Bearer ${c}`}});y(s),n.success(`Coupon applied: -Rs. ${x(s.discount)}`)}catch(s){console.error(s),n.error(((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.msg)||"Coupon not valid"),y(null)}finally{R(!1)}},T=()=>{k(""),y(null)};return m.length?e.jsxs("div",{className:"p-6 max-w-3xl mx-auto space-y-6 bg-[var(--bg)] text-[var(--ink)]",children:[e.jsxs("header",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[var(--accent)]/80",children:"Checkout"}),e.jsx("h1",{className:"text-3xl font-semibold text-[var(--primary)]",children:"Ready to place order?"}),e.jsx("p",{className:"text-[var(--ink)]/70 mt-2",children:"Select a payment option and confirm. You will receive order updates on WhatsApp/SMS."}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-3 text-sm font-semibold",children:["Shipping","Payment","Review"].map((a,t)=>e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-full border ${t===0?"bg-[var(--primary-soft)]/70 border-[var(--primary-soft)] text-[var(--ink)]":"border-[var(--border)] text-[var(--muted)] bg-white/70"}`,children:[e.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${t===0?"bg-[var(--primary)] text-white":"bg-[var(--surface-muted)] text-[var(--muted)]"}`,children:t+1}),a]},a))})]}),e.jsxs("section",{className:"bg-white rounded-2xl shadow p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Your cart"}),m.map(a=>{var t,s,o,p;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:(t=a.product)==null?void 0:t.name}),e.jsxs("p",{className:"text-gray-500",children:["Qty: ",a.quantity]}),(a.selectedColor||a.selectedSize)&&e.jsxs("p",{className:"text-xs text-gray-500",children:[a.selectedColor&&e.jsxs("span",{children:["Color: ",a.selectedColor]}),a.selectedColor&&a.selectedSize&&e.jsx("span",{children:" â€¢ "}),a.selectedSize&&e.jsxs("span",{children:["Size: ",a.selectedSize]})]})]}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Rs."," ",x((((s=a.product)==null?void 0:s.discountPrice)||((o=a.product)==null?void 0:o.price)||0)*a.quantity)]})]},(p=a.product)==null?void 0:p._id)}),e.jsxs("div",{className:"flex items-center justify-between border-t pt-3 font-semibold text-gray-900",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["Rs. ",x(v)]})]}),e.jsxs("div",{className:"border rounded-xl p-3 bg-[#f8f5ff]",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-900",children:"Have a coupon?"}),e.jsxs("div",{className:"mt-2 flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{value:b,onChange:a=>k(a.target.value),placeholder:"Enter code (e.g. FIRST200)",className:"border rounded-xl px-3 py-2 flex-1"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:q,disabled:S,className:"bg-pink-600 text-white px-4 py-2 rounded-xl text-sm font-semibold disabled:opacity-70",children:S?"Applying...":"Apply"}),l&&e.jsx("button",{onClick:T,className:"border border-gray-200 px-4 py-2 rounded-xl text-sm",children:"Remove"})]})]}),l&&e.jsxs("p",{className:"text-xs text-emerald-600 mt-2",children:["Applied ",l.code,": -Rs. ",x(l.discount)]})]}),N>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm text-emerald-700",children:[e.jsx("span",{children:"Coupon discount"}),e.jsxs("span",{children:["-Rs. ",x(N)]})]}),h==="UPI"&&e.jsxs("div",{className:"flex items-center justify-between text-xs text-emerald-600",children:[e.jsx("span",{children:"Pay now discount (10%)"}),e.jsxs("span",{children:["-Rs. ",x(_)]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t pt-3 font-semibold text-gray-900",children:[e.jsx("span",{children:"Total payable"}),e.jsxs("span",{children:["Rs. ",x(D)]})]})]}),e.jsxs("section",{className:"bg-white rounded-2xl shadow p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Delivery details"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Full name"}),e.jsx("input",{value:r.name,onChange:a=>u(t=>({...t,name:a.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Recipient name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Phone"}),e.jsx("input",{value:r.phone,onChange:a=>u(t=>({...t,phone:a.target.value.replace(/[^0-9+ ]/g,"")})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"10-digit mobile"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Address"}),e.jsx("input",{value:r.line1,onChange:a=>u(t=>({...t,line1:a.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"House / Flat, Street"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Landmark (optional)"}),e.jsx("input",{value:r.line2,onChange:a=>u(t=>({...t,line2:a.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Near temple, mall, etc."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"City"}),e.jsx("input",{value:r.city,onChange:a=>u(t=>({...t,city:a.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"City"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"State"}),e.jsx("input",{value:r.state,onChange:a=>u(t=>({...t,state:a.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"State"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Pincode"}),e.jsx("input",{value:r.pincode,onChange:a=>u(t=>({...t,pincode:a.target.value.replace(/[^0-9]/g,"")})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"6-digit pincode",maxLength:6})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Delivery note (optional)"}),e.jsx("textarea",{value:j,onChange:a=>$(a.target.value),className:"border rounded-xl px-3 py-2 w-full",rows:2,placeholder:"Gate code or delivery instructions"})]})]})]}),e.jsxs("section",{className:"bg-white rounded-2xl shadow p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Payment method"}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-gray-600",children:[e.jsx("span",{className:"px-3 py-1 rounded-full bg-green-50 text-green-700 border border-green-100",children:"UPI accepted"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100",children:"COD available"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-100",children:"Secure Razorpay checkout"})]}),e.jsx("div",{className:"space-y-3",children:K.map(a=>e.jsxs("label",{className:"flex items-center gap-3 border rounded-2xl px-4 py-3 cursor-pointer hover:border-pink-200",children:[e.jsx("input",{type:"radio",name:"payment",checked:h===a.value,onChange:()=>U(a.value)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:a.label}),a.value==="UPI"&&e.jsx("p",{className:"text-xs text-gray-500",children:"Pay now and get 10% instant discount. We will open your phone's UPI app with the payable amount."})]})]},a.value))}),e.jsx("button",{onClick:Y,disabled:P,className:"w-full bg-pink-600 text-white px-4 py-3 rounded-full font-semibold disabled:opacity-70",children:P?"Placing order...":`Place order (Rs. ${x(D)})`}),h==="COD"?e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Pay cash or UPI to the courier when your saree arrives."}):e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"10% instant discount applied. After tapping place order we open the UPI app. Complete the payment to confirm."}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-gray-600 justify-center pt-2",children:[e.jsx("span",{className:"px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-100",children:"Delivery estimate: 4-7 business days"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-sky-50 text-sky-700 border border-sky-100",children:"Free 7-day returns"})]})]})]}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Checkout"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Your cart is empty. Add sarees to continue."})]})}export{ee as default};
