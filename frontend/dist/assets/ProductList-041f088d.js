import{a as me,u as xe,r as c,C as je,c as Ne,i as H,j as s,b as Ce}from"./index-17f9266b.js";import{B as ve}from"./BrandLoader-0c019462.js";import{s as ye}from"./seo-4fb2e452.js";const Se="data:image/gif;base64,R0lGODlhAQABAAD/ACw=",be=[{value:"featured",label:"Featured"},{value:"priceLow",label:"Price: Low to High"},{value:"priceHigh",label:"Price: High to Low"},{value:"new",label:"Newest first"}],_=o=>`Rs. ${new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(o||0)}`,ae=o=>{if(o==null)return 0;if(typeof o=="number")return o;if(typeof o=="string"){const b=o.replace(/,/g,"").trim(),g=Number(b);return Number.isNaN(g)?0:g}return 0},re=(o,b=0)=>{var g,k;return Ce(((g=o==null?void 0:o.images)==null?void 0:g[b])||((k=o==null?void 0:o.images)==null?void 0:k[0]),Se)};function Ae(){var X,Y;const o=me(),b=xe(),{addToCart:g}=c.useContext(je),{slug:k}=Ne(),[C,ce]=c.useState([]),[m,le]=c.useState([]),[h,ie]=c.useState([]),[W,oe]=c.useState(["All Sarees"]),[$,q]=c.useState(!0),[z,G]=c.useState(""),[d,v]=c.useState("All Sarees"),[y,P]=c.useState(""),[u,w]=c.useState(""),[x,L]=c.useState(4e3),[O,ne]=c.useState(6e3),[A,K]=c.useState("featured"),[S,D]=c.useState(""),[B,Q]=c.useState([]),[I,V]=c.useState(""),[R,de]=c.useState(""),[J,ue]=c.useState(!1),[F,he]=c.useState(4e3),[pe,E]=c.useState(!1),[fe,M]=c.useState(!1),p=y||R;c.useEffect(()=>{const e=[];I&&e.push(I),d&&d!=="All Sarees"&&e.push(d);const t=e.length?` | ${e.join(" · ")}`:"";ye({title:`Mrigmaya | Shop sarees${t}`,description:"Explore Mrigmaya edits: handcrafted silks, chiffons, Banarasis, and contemporary drapes with concierge support and fast pan-India delivery."})},[I,d]),c.useEffect(()=>{const e=new URLSearchParams(o.search);if(!(e.has("moodId")||e.has("ids")||e.has("collectionSlug")))return;const r=document.querySelector(".product-area");r&&setTimeout(()=>r.scrollIntoView({behavior:"smooth",block:"start"}),80)},[o.search]),c.useEffect(()=>{let e=!0;return q(!0),H.get("/products").then(t=>{var r;e&&(ce(Array.isArray(t.data)?t.data:((r=t.data)==null?void 0:r.products)||[]),G(""))}).catch(()=>{e&&G("We could not load the sarees. Please try again.")}).finally(()=>e&&q(!1)),()=>{e=!1}},[]),c.useEffect(()=>{const e=C.reduce((r,n)=>{const a=n.discountPrice||n.price||0;return a>r?a:r},0),t=Math.max(e,6e3);he(t),ne(t),L(t)},[C]),c.useEffect(()=>{const e=new URLSearchParams(o.search),t=e.get("ids"),r=e.get("collectionSlug"),n=e.get("moodId");Q(t?t.split(",").map(a=>a.trim()).filter(Boolean):[]),V(r||""),P(n||""),de(n||"")},[o.search]),c.useEffect(()=>{H.get("/collections").then(e=>le(e.data||[])).catch(()=>{})},[]),c.useEffect(()=>{H.get("/home-sections").then(e=>{const t=(e.data||[]).filter(r=>r.group==="category"&&r.active!==!1).sort((r,n)=>(r.order??0)-(n.order??0));ie(t),ue(!0),y&&t.length>0&&!t.find(r=>r._id===y)&&P("")}).catch(()=>{})},[y]),c.useEffect(()=>{const e=y||R;if(!e||!J||!h.length)return;const t=h.find(r=>r._id===e);t!=null&&t.title&&v(t.title)},[y,R,h,J]),c.useEffect(()=>{const e=I||k;if(!e||!m.length)return;const t=m.find(r=>r.slug===e);t?(w(t._id),v("All Sarees")):w("")},[k,m,I]),c.useEffect(()=>{const e=h.map(l=>l.title).filter(Boolean),t=(C||[]).map(l=>(l.category||"").trim()).filter(Boolean),r=(m||[]).map(l=>l.title).filter(Boolean),a=["All Sarees",...Array.from(new Set([...e,...t,...r].filter(Boolean)))];oe(a),(a.length===1||d!=="All Sarees"&&!a.includes(d))&&(v("All Sarees"),P(""))},[C,h,m,d]);const T=c.useMemo(()=>{var r,n;let e=[...C];const t=!!p;if(B.length&&(e=e.filter(a=>B.includes(a._id)||B.includes(a.productId))),p){const a=h.find(l=>l._id===p);if(a){const l=((r=a.meta)==null?void 0:r.products)||a.productIds||[],i=a.slug;l.length?e=e.filter(f=>l.includes(f._id)||l.includes(f.productId)):i?e=e.filter(f=>(f.collections||[]).some(j=>(j.slug||j)===i||(j._id||j)===i)):a.title&&(e=e.filter(f=>(f.category||"").toLowerCase().includes(a.title.toLowerCase())))}}if(!t&&d&&d!=="All Sarees"&&(e=e.filter(a=>(a.category||"").toLowerCase().includes(d.toLowerCase()))),u&&(e=e.filter(a=>(a.collections||[]).some(l=>(l._id||l)===u))),t||(e=e.filter(a=>(a.discountPrice||a.price||0)<=x)),S.trim()&&(e=e.filter(a=>(a.name||"").toLowerCase().includes(S.trim().toLowerCase()))),A==="priceLow"?e.sort((a,l)=>(a.discountPrice||a.price||0)-(l.discountPrice||l.price||0)):A==="priceHigh"?e.sort((a,l)=>(l.discountPrice||l.price||0)-(a.discountPrice||a.price||0)):A==="new"&&e.sort((a,l)=>new Date(l.createdAt||0)-new Date(a.createdAt||0)),e.length===0&&p){const a=h.find(i=>i._id===p),l=((n=a==null?void 0:a.meta)==null?void 0:n.customProducts)||[];if(l.length)return l.map((i,f)=>{if(i.productId){const te=C.find(ge=>ge._id===i.productId);if(te)return te}const j=Array.isArray(i.images)&&i.images.length?i.images:[i.image||""],N=ae(i.price||i.sellingPrice||i.discountPrice),Z=ae(i.mrp||i.originalPrice||i.priceMrp),ee=Z>N&&N>0,se=i.productId||`custom-${f}`;return{_id:se,productId:se,isCustom:!0,name:i.name||"Custom item",price:ee?Z:N,discountPrice:ee?N:void 0,images:j,category:(a==null?void 0:a.title)||"Edit item"}})}return e},[C,d,x,S,A,u,B,y,h]),U=()=>{v("All Sarees"),P(""),w(""),L(F),K("featured"),D("")};return s.jsx("div",{className:"collection-page",children:s.jsxs("section",{className:"collection-body",children:[s.jsxs("div",{className:"product-area",children:[s.jsxs("div",{className:"product-toolbar",children:[s.jsxs("div",{className:"toolbar-copy",children:[s.jsx(ve,{compact:!0,message:""}),s.jsxs("div",{className:"meta",children:[s.jsx("span",{children:`${T.length} styles ready to ship`}),s.jsx("span",{className:"meta-dot"}),s.jsx("span",{children:`Cap ${_(x)}`}),u?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"meta-dot"}),s.jsx("span",{children:((X=m.find(e=>e._id===u))==null?void 0:X.title)||"Collection"})]}):null]})]}),s.jsxs("div",{className:"toolbar-actions",children:[s.jsxs("div",{className:"quick-filters",children:[s.jsx("button",{className:"pill pill--ghost",onClick:()=>E(!0),children:"Category"}),s.jsx("button",{className:"pill pill--ghost",onClick:()=>M(!0),children:"Filters"})]}),s.jsxs("div",{className:"search-shell",children:[s.jsx("span",{className:"search-icon",children:"Search"}),s.jsx("input",{type:"text",placeholder:"Prints, fabrics, hues...",value:S,onChange:e=>D(e.target.value)})]})]})]}),z&&s.jsx("p",{className:"error",children:z}),s.jsx("div",{className:"tag-strip",children:(u||d&&d!=="All Sarees"||!p&&x!==F||S.trim())&&s.jsxs(s.Fragment,{children:[d&&d!=="All Sarees"&&s.jsxs("span",{className:"tag-chip",onClick:()=>v("All Sarees"),children:[d," ×"]}),u&&s.jsxs("span",{className:"tag-chip",onClick:()=>w(""),children:[((Y=m.find(e=>e._id===u))==null?void 0:Y.title)||"Collection"," ×"]}),!p&&x!==F&&s.jsxs("span",{className:"tag-chip",onClick:()=>L(F),children:["Cap ",_(x)," ×"]}),S.trim()&&s.jsxs("span",{className:"tag-chip",onClick:()=>D(""),children:["“",S.trim(),"” ×"]}),s.jsx("button",{className:"tag-chip tag-chip--clear",onClick:U,children:"Clear all"})]})}),s.jsxs("div",{className:"product-grid",children:[$&&Array.from({length:8}).map((e,t)=>s.jsx("div",{className:"product-card skeleton"},t)),!$&&T.length===0&&s.jsxs("div",{className:"empty-state",children:[s.jsx("p",{children:"No sarees match these filters yet."}),s.jsx("p",{className:"text-sm text-gray-500",children:"Try clearing filters or searching a simpler term."}),s.jsx("button",{onClick:U,className:"px-4 py-2 rounded-full border border-gray-200 text-sm font-semibold",children:"Clear filters"})]}),!$&&T.map(e=>{const t=!!e.isCustom,r=e.productId||e._id,n=!t||!!e.productId,a=e.discountPrice||e.price,l=!!(e.discountPrice&&e.discountPrice!==e.price),i=l?Math.round((e.price-e.discountPrice)/e.price*100):null,f=i?`-${i}%`:"New",j=async N=>{N.stopPropagation(),!(!r||!e.productId&&t)&&(await g(r),b("/checkout"))};return s.jsxs("article",{className:"product-card",onClick:()=>{n&&b(`/product/${r}`)},children:[s.jsxs("div",{className:"card-image",children:[s.jsx("img",{src:re(e),alt:e.name,className:"card-image__img",loading:"lazy",decoding:"async"}),s.jsx("img",{src:re(e,1),alt:e.name,className:"card-image__img card-image__img--hover",loading:"lazy",decoding:"async"}),s.jsx("span",{className:"card-badge",children:f})]}),s.jsxs("div",{className:"card-body",children:[s.jsx("p",{className:"card-category",children:e.category||"Saree"}),s.jsx("h3",{children:e.name}),s.jsxs("div",{className:"card-meta",children:[s.jsx("span",{children:"Ready to ship"}),e.fabric&&s.jsx("span",{children:e.fabric})]}),s.jsxs("div",{className:"card-price",children:[s.jsx("strong",{children:_(a)}),l&&s.jsx("span",{children:_(e.price)})]}),s.jsx("button",{className:"card-cta",disabled:!r||!e.productId&&t,onClick:N=>{N.stopPropagation(),!(!r||!e.productId&&t)&&g(r)},children:"Add to cart"}),s.jsx("button",{className:"card-cta mt-2 bg-gradient-to-r from-[var(--primary)] to-[var(--accent)] text-white",disabled:!r||!e.productId&&t,onClick:j,children:"Buy now"})]})]},e._id)})]})]}),pe&&s.jsx("div",{className:"sheet-backdrop",onClick:()=>E(!1),children:s.jsxs("div",{className:"filter-panel sheet",onClick:e=>{e.stopPropagation()},children:[s.jsxs("div",{className:"sheet-header",children:[s.jsx("h3",{children:"Category"}),s.jsx("button",{className:"close-sheet",onClick:()=>E(!1),children:"Close"})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Category"}),s.jsx("div",{className:"filter-pills",children:W.map(e=>s.jsx("button",{className:e===d?"pill active":"pill",onClick:()=>{v(e);const t=h.find(r=>{var n;return((n=r.title)==null?void 0:n.toLowerCase())===e.toLowerCase()});P((t==null?void 0:t._id)||""),E(!1)},children:e},e))})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Sort"}),s.jsx("div",{className:"select-shell select-shell--sheet",children:s.jsx("select",{value:A,onChange:e=>K(e.target.value),children:be.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})})]})]})}),fe&&s.jsx("div",{className:"sheet-backdrop",onClick:()=>M(!1),children:s.jsxs("div",{className:"filter-panel sheet",onClick:e=>{e.stopPropagation()},children:[s.jsxs("div",{className:"sheet-header",children:[s.jsx("h3",{children:"Filters"}),s.jsx("button",{className:"close-sheet",onClick:()=>M(!1),children:"Close"})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Category"}),s.jsx("div",{className:"filter-pills",children:W.map(e=>s.jsx("button",{className:e===d?"pill active":"pill",onClick:()=>{v(e);const t=h.find(r=>{var n;return((n=r.title)==null?void 0:n.toLowerCase())===e.toLowerCase()});P((t==null?void 0:t._id)||"")},children:e},e))})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Collections"}),s.jsxs("div",{className:"filter-pills",children:[s.jsx("button",{className:u?"pill":"pill active",onClick:()=>w(""),children:"All"}),m.map(e=>s.jsx("button",{className:u===e._id?"pill active":"pill",onClick:()=>w(u===e._id?"":e._id),children:e.title},e._id))]})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Budget cap"}),s.jsx("input",{type:"range",min:"0",max:Math.max(1e3,O),step:"100",value:p?Math.max(1e3,O):x,onChange:e=>{p||L(Number(e.target.value))}}),s.jsx("div",{className:"price-display",children:p?"Budget cap disabled for this edit":`Up to ${_(x)}`})]}),s.jsxs("div",{className:"filter-footer",children:[s.jsx("button",{onClick:()=>{U(),M(!1)},children:"Reset filters"}),s.jsx("p",{children:"Need help styling? WhatsApp our saree expert."})]})]})})]})})}export{Ae as default};
