import{r as x,A as $t,u as Ut,z as i,i as u,j as e,b as Mt}from"./index-341cd16a.js";const V=l=>Mt(l,""),Oe=(l="")=>{const g=l.split("?")[0].toLowerCase();return/\.(mp4|webm|ogg)$/.test(g)},Fe=l=>l?Array.isArray(l.colors)&&l.colors.length?l.colors.join(", "):l.color||"":"",Be=l=>{const g=Te.find(S=>S.label.toLowerCase()===(l||"").toLowerCase());return(g==null?void 0:g.swatch)||"linear-gradient(135deg, #fdfcfb, #e2d1c3)"},Rt=l=>{if(!(l!=null&&l.startsWith("#"))||l.length!==7&&l.length!==4)return!1;const g=l.length===4?`#${l[1]}${l[1]}${l[2]}${l[2]}${l[3]}${l[3]}`:l,S=parseInt(g.slice(1),16),D=S>>16&255,k=S>>8&255,y=S&255;return(D*299+k*587+y*114)/1e3>180},ge={name:"",description:"",category:"",categoryRef:"",fabric:"",color:"",colors:[],sizes:[],amazonLink:"",flipkartLink:"",price:"",discountPrice:"",stock:"",images:"",video:"",collectionIds:[]},He={title:"",slug:"",subtitle:"",description:"",ctaLabel:"",heroImage:"",accentColor:"#c1275a",displayOnHome:!0,priority:999},zt=[{value:"processing",label:"Processing"},{value:"packed",label:"Packed"},{value:"shipped",label:"Shipped"},{value:"delivered",label:"Delivered"},{value:"cancelled",label:"Cancelled"}],Te=[{label:"Red",swatch:"#e53935"},{label:"Pink",swatch:"#f06292"},{label:"Magenta",swatch:"#d81b60"},{label:"Maroon",swatch:"#7b1fa2"},{label:"Yellow",swatch:"#fbc02d"},{label:"Mustard",swatch:"#d3a518"},{label:"Orange",swatch:"#ff7043"},{label:"Peach",swatch:"#f8b195"},{label:"Green",swatch:"#43a047"},{label:"Olive",swatch:"#708238"},{label:"Mint",swatch:"#7bdcb5"},{label:"Sea Green",swatch:"#2e8b57"},{label:"Teal",swatch:"#009688"},{label:"Blue",swatch:"#1e88e5"},{label:"Navy",swatch:"#1b3b6f"},{label:"Purple",swatch:"#9c27b0"},{label:"Lavender",swatch:"#c6a5d8"},{label:"Brown",swatch:"#8d6e63"},{label:"Beige",swatch:"#d9c4a1"},{label:"Cream",swatch:"#f6e7c1"},{label:"Grey",swatch:"#9e9e9e"},{label:"Black",swatch:"#212121"},{label:"White",swatch:"#f5f5f5"},{label:"Gold",swatch:"#d4af37"},{label:"Silver",swatch:"#c0c0c0"},{label:"Multi",swatch:"linear-gradient(120deg, #e53935, #fbc02d, #43a047, #1e88e5, #9c27b0)"}],Ot=["XS","S","M","L","XL"],Ft=[{value:"cod_pending",label:"Awaiting COD"},{value:"awaiting_upi",label:"Awaiting UPI"},{value:"awaiting_gateway",label:"Awaiting gateway"},{value:"paid",label:"Paid"},{value:"cancelled",label:"Cancelled"}];function qt(){const{token:l,user:g,logout:S}=x.useContext($t),D=Ut(),[k,y]=x.useState([]),[j,P]=x.useState([]),[L,M]=x.useState([]),[o,b]=x.useState(ge),[m,N]=x.useState([]),[C,$]=x.useState([]),[G,p]=x.useState(""),[f,O]=x.useState(!1),[X,Z]=x.useState(!1),[z,J]=x.useState(null),[w,F]=x.useState(He),[K,Ee]=x.useState([]),[ye,fe]=x.useState([{_id:null,title:"",subtitle:"",image:""},{_id:null,title:"",subtitle:"",image:""}]),[be,Ve]=x.useState([]),[v,T]=x.useState({code:"",discountType:"flat",value:"",maxDiscount:"",maxRedemptions:1,expiresAt:"",minOrderValue:"",active:!0}),[de,je]=x.useState(""),[Ge,re]=x.useState(!1),[We,Ne]=x.useState(!1),[U,R]=x.useState({title:"",subtitle:"",tag:"",ctaLabel:"",ctaLink:"/products",image:"",order:1,active:!0,productIds:[]}),[ee,ve]=x.useState(null),[qe,le]=x.useState(!1),[we,Xe]=x.useState([]),[ne,Je]=x.useState([]),Ce=x.useMemo(()=>ne.filter(t=>t.returnRequested||t.returnStatus&&t.returnStatus!=="none"),[ne]),te=x.useMemo(()=>(o.images||"").split(/[\n,]/).map(t=>t.trim()).filter(Boolean),[o.images]),q=x.useMemo(()=>L.find(t=>t._id===o.categoryRef),[L,o.categoryRef]),xe=x.useMemo(()=>`${(q==null?void 0:q.name)||""} ${(q==null?void 0:q.slug)||""} ${o.category||""}`.toLowerCase().trim(),[o.category,q]).includes("suit"),[W,Ke]=x.useState("collections"),Qe=[{id:"collections",label:"Collections"},{id:"products",label:"Products"},{id:"coupons",label:"Coupons"},{id:"homepage",label:"Homepage Slider"},{id:"orders",label:"Orders"},{id:"returns",label:"Returns"},{id:"login-visuals",label:"Login visuals"}],h=x.useMemo(()=>({headers:{Authorization:`Bearer ${l||localStorage.getItem("token")||""}`}}),[l]),Q=t=>{Xe(s=>[{message:t,ts:new Date().toISOString()},...s].slice(0,15))},ke=(t,s=2)=>{var r;if(!t)return!1;if(!((r=t.type)!=null&&r.startsWith("image/")))return i.error("Please upload an image file"),!1;const a=s*1024*1024;return t.size>a?(i.error(`Image too large. Max ${s}MB allowed.`),!1):!0},Ye=(t,s=20)=>{var c,d;if(!t)return!1;const a=(c=t.type)==null?void 0:c.startsWith("image/"),r=(d=t.type)==null?void 0:d.startsWith("video/");if(!a&&!r)return i.error("Upload an image or video"),!1;const n=s*1024*1024;return t.size>n?(i.error(`File too large. Max ${s}MB allowed.`),!1):!0},ue=t=>{b(s=>{const a=s.colors||[],n=a.includes(t)?a.filter(c=>c!==t):[...a,t];return{...s,colors:n,color:n[0]||""}})},Se=()=>{const t=G.trim();t&&(ue(t),p(""))},Ze=t=>{b(s=>{const a=s.sizes||[],n=a.includes(t)?a.filter(c=>c!==t):[...a,t];return{...s,sizes:n}})},_e=xe||f||(o.sizes||[]).length>0,et=t=>{const s=(t==null?void 0:t.shippingAddress)||{},a=[s.name,s.phone||t.customerContact,s.line1,s.line2,[s.city,s.state].filter(Boolean).join(", "),s.pincode].filter(Boolean);return a.length===0?"No address":a.join(" | ")};x.useEffect(()=>{if(!l){D("/admin/login");return}(g==null?void 0:g.role)!=="admin"&&(i.error("Admin access only"),D("/"))},[l,g,D]),x.useEffect(()=>{l&&(se(),Y(),_(),tt(),oe(),ie())},[l]),x.useEffect(()=>{_()},[]);const se=async()=>{try{const t=await u.get("/products?includeInactive=true");y(t.data)}catch(t){console.error(t)}},Y=async()=>{try{const t=await u.get("/collections?includeProducts=true");P(t.data)}catch(t){console.error(t)}},tt=async()=>{if(l)try{const t=await u.get("/categories/all",h);M(t.data||[])}catch(t){console.error(t)}},oe=async()=>{if(l)try{const t=await u.get("/coupons",h);Ve(t.data||[])}catch(t){console.error(t)}},ie=async()=>{if(l)try{const s=(await u.get("/orders",h)).data||{};Je(Array.isArray(s.orders)?s.orders:Array.isArray(s)?s:[])}catch(t){console.error(t)}},st=async t=>{try{const s=await u.get(`/orders/${t}/invoice`,{...h,responseType:"blob"}),a=new Blob([s.data],{type:"application/pdf"}),r=window.URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=`invoice-${t.slice(-6)}.pdf`,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(r)}catch(s){console.error(s),i.error("Could not download invoice")}},_=async()=>{var t;try{const s=await u.get("/home-sections?includeInactive=true");Ee(s.data)}catch(s){console.error("Home sections fetch failed",((t=s==null?void 0:s.response)==null?void 0:t.data)||s.message),i.error("Could not load homepage cards")}},A=x.useMemo(()=>[...K.filter(t=>t.group==="hero")].sort((t,s)=>(t.order??0)-(s.order??0)),[K]),Ie=x.useMemo(()=>A.length?Math.max(...A.map(t=>t.order??0)):0,[A]);x.useEffect(()=>{const t=[...K.filter(a=>{var r;return a.group==="custom"&&((r=a.meta)==null?void 0:r.loginSlot)!==void 0})].sort((a,r)=>{var n,c;return(((n=a.meta)==null?void 0:n.loginSlot)??0)-(((c=r.meta)==null?void 0:c.loginSlot)??0)}),s=[0,1].map(a=>{const r=t.find(n=>{var c;return Number((c=n.meta)==null?void 0:c.loginSlot)===a});return{_id:(r==null?void 0:r._id)||null,title:(r==null?void 0:r.title)||"",subtitle:(r==null?void 0:r.subtitle)||"",image:(r==null?void 0:r.image)||""}});fe(s)},[K]);const ce=(t,s,a)=>{fe(r=>{const n=[...r];return n[t]={...n[t],[s]:a},n})},at=async()=>{try{await Promise.all(ye.map(async(s,a)=>{const r={group:"custom",title:s.title,subtitle:s.subtitle,image:s.image,order:a,active:!0,meta:{...s.meta||{},loginSlot:a}};if(s._id){if(!s.image){await u.delete(`/home-sections/${s._id}`,h);return}await u.put(`/home-sections/${s._id}`,r,h)}else s.image&&await u.post("/home-sections",r,h)}))&&(i.success("Login visuals saved"),_())}catch(t){console.error(t),i.error("Could not save visuals")}},rt=async(t,s)=>{if(ke(t)&&t){Ne(!0);try{const a=new FormData;a.append("file",t);const n=(await u.post("/uploads",a,{headers:{...h.headers,"Content-Type":"multipart/form-data"}})).data.url;ce(s,"image",n),i.success("Image uploaded")}catch(a){console.error(a),i.error("Upload failed")}finally{Ne(!1)}}},I=x.useMemo(()=>[...K.filter(t=>t.group==="category")].sort((t,s)=>(t.order??0)-(s.order??0)),[K]);x.useEffect(()=>{if(!z){N([]);return}const t=k.find(a=>a._id===z);if(!t)return;const s=I.filter(a=>{var n;return(((n=a.meta)==null?void 0:n.products)||a.productIds||[]).includes(t._id)}).map(a=>a._id);N(s)},[z,k,I]);const Le=async t=>{if(!ke(t))return null;const s=new FormData;return s.append("file",t),(await u.post("/uploads",s,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}})).data.url},lt=async t=>{if(!Ye(t,25))return null;const s=new FormData;return s.append("file",t),(await u.post("/uploads",s,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}})).data.url},me=()=>{R({title:"",subtitle:"",tag:"",ctaLabel:"",ctaLink:"/products",image:"",order:1,active:!0,productIds:[]}),ve(null)},Ae=async(t,s)=>{await u.post("/home-sections",{group:"hero",...t,order:s,active:!0},h)},nt=async()=>{if(!U.title.trim()){i.error("Enter a title");return}if(!U.image.trim()){i.error("Add an image");return}const t={...U,order:Number(U.order)||I.length+1,group:"category"};t.meta={...t.meta||{},products:U.productIds||[]};try{ee?(await u.put(`/home-sections/${ee}`,t,h),i.success("Card updated")):(await u.post("/home-sections",t,h),i.success("Card added")),me(),_()}catch(s){console.error(s),i.error("Could not save card")}},ot=t=>{var s;ve(t._id),R({title:t.title||"",subtitle:t.subtitle||"",tag:t.tag||"",ctaLabel:t.ctaLabel||"",ctaLink:t.ctaLink||"/products",image:t.image||"",order:t.order??1,active:t.active!==!1,productIds:((s=t.meta)==null?void 0:s.products)||t.productIds||[]})},it=async t=>{if(window.confirm("Delete this card?"))try{await u.delete(`/home-sections/${t}`,h),i.success("Card deleted"),ee===t&&me(),_()}catch(s){console.error(s),i.error("Could not delete card")}},De=async(t,s)=>{const a=I.findIndex(d=>d._id===t);if(a===-1)return;const r=s==="up"?a-1:a+1;if(r<0||r>=I.length)return;const n=I[a],c=I[r];try{await Promise.all([u.put(`/home-sections/${n._id}`,{order:c.order??r},h),u.put(`/home-sections/${c._id}`,{order:n.order??a},h)]),_()}catch(d){console.error(d),i.error("Could not reorder cards")}},ct=async t=>{if(t)try{le(!0);const s=await Le(t);R(a=>({...a,image:s})),i.success("Image uploaded")}catch(s){console.error(s),i.error("Upload failed")}finally{le(!1)}},dt=async(t,s)=>{var n;if(!s)return;const a=I.find(c=>c._id===t),r=((n=a==null?void 0:a.meta)==null?void 0:n.products)||(a==null?void 0:a.productIds)||[];if(!r.includes(s))try{await u.put(`/home-sections/${t}`,{meta:{...a.meta||{},products:[...r,s]}},h),_()}catch(c){console.error(c),i.error("Could not attach product")}},Pe=()=>{T({code:"",discountType:"flat",value:"",maxDiscount:"",maxRedemptions:1,expiresAt:"",active:!0})},xt=async()=>{var t,s;if(!v.code.trim()||!v.value){i.error("Code and value are required");return}try{await u.post("/coupons",{...v,code:v.code.trim().toUpperCase(),value:Number(v.value),maxDiscount:v.maxDiscount?Number(v.maxDiscount):void 0,maxRedemptions:v.maxRedemptions?Number(v.maxRedemptions):1},h),i.success("Coupon saved"),Pe(),oe()}catch(a){i.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.msg)||"Could not save coupon")}},ut=async(t,s)=>{var Ue,Me,Re,ze;const a=I.find(H=>H._id===t),r=Array.isArray(s.images)&&s.images.length?s.images:[s.image||""],n=new FormData;n.append("name",s.name||"Custom item"),n.append("description",`Custom product for ${(a==null?void 0:a.title)||"edit"}`),n.append("category",(a==null?void 0:a.title)||"Custom"),n.append("price",Number(s.mrp||s.price||0));const c=Number(s.price||0),d=Number(s.mrp||0);d>c&&c>0&&(n.append("discountPrice",c),n.append("price",d)),n.append("stock",50),n.append("images",r.filter(Boolean).join(`
`));let B=s.productId;try{B=((Ue=(await u.post("/products",n,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}})).data)==null?void 0:Ue._id)||B,i.success("Product created & attached"),se()}catch(H){console.error("Custom product creation failed",H),i.error("Could not create product for this item");return}const he=((Me=a==null?void 0:a.meta)==null?void 0:Me.products)||(a==null?void 0:a.productIds)||[],Pt=[...(((Re=a==null?void 0:a.meta)==null?void 0:Re.productsDetails)||[]).filter(H=>(H==null?void 0:H._id)!==B),{_id:B,name:s.name||"Custom item"}];try{await u.put(`/home-sections/${t}`,{meta:{...a.meta||{},products:[...new Set([...he,B])],productsDetails:Pt,customProducts:((ze=a==null?void 0:a.meta)==null?void 0:ze.customProducts)||[]}},h),_()}catch(H){console.error(H),i.error("Could not attach product to this card")}},mt=async(t,s)=>{var c;const a=I.find(d=>d._id===t),n=(((c=a==null?void 0:a.meta)==null?void 0:c.customProducts)||[]).filter((d,E)=>E!==s);try{await u.put(`/home-sections/${t}`,{meta:{...a.meta||{},customProducts:n}},h),_()}catch(d){console.error(d),i.error("Could not remove product")}},pt=async t=>{if(!t)return"";try{return le(!0),await Le(t)}catch(s){return console.error(s),i.error("Upload failed"),""}finally{le(!1)}},ht=async(t,s)=>{var c;const a=I.find(d=>d._id===t),n=(((c=a==null?void 0:a.meta)==null?void 0:c.products)||(a==null?void 0:a.productIds)||[]).filter(d=>d!==s);try{await u.put(`/home-sections/${t}`,{meta:{...a.meta||{},products:n}},h),_()}catch(d){console.error(d),i.error("Could not remove product")}},gt=async t=>{var s;if(t!=null&&t.length){re(!0);try{let a=Ie+1;for(const r of Array.from(t)){const n=await lt(r);if(!n)continue;const c=(s=r.type)!=null&&s.startsWith("video/")||Oe(n)?{video:n}:{image:n};await Ae(c,a),a+=1}i.success("Slides added"),Q("Added hero slides via upload"),_()}catch(a){console.error(a),i.error("Could not upload slides")}finally{re(!1)}}},yt=async()=>{if(de.trim()){re(!0);try{const t=de.trim(),s=Oe(t)?{video:t}:{image:t};await Ae(s,Ie+1),je(""),i.success("Slide added"),Q("Added hero slide via link"),_()}catch(t){console.error(t),i.error("Could not save slide")}finally{re(!1)}}},ft=async(t,s)=>{try{await u.put(`/home-sections/${t}`,{active:s},h),Q(`Slide ${s?"enabled":"disabled"}`),_()}catch(a){console.error(a),i.error("Could not update slide")}},bt=async t=>{if(window.confirm("Delete this slide?"))try{await u.delete(`/home-sections/${t}`,h),i.success("Slide removed"),Q("Removed a hero slide"),_()}catch(s){console.error(s),i.error("Could not delete slide")}},$e=async(t,s)=>{const a=A.findIndex(d=>d._id===t);if(a===-1)return;const r=s==="up"?a-1:a+1;if(r<0||r>=A.length)return;const n=A[a],c=A[r];try{await Promise.all([u.put(`/home-sections/${n._id}`,{order:c.order??r},h),u.put(`/home-sections/${c._id}`,{order:n.order??a},h)]),Q("Reordered hero slides"),_()}catch(d){console.error(d),i.error("Could not reorder slides")}},jt=async(t,s)=>{if(!t||!s||t===s)return;const a=A.findIndex(d=>d._id===t),r=A.findIndex(d=>d._id===s);if(a===-1||r===-1)return;const n=A[a],c=A[r];try{await Promise.all([u.put(`/home-sections/${n._id}`,{order:c.order??r},h),u.put(`/home-sections/${c._id}`,{order:n.order??a},h)]),Q("Reordered hero slides (drag)"),_()}catch(d){console.error(d),i.error("Could not reorder slides")}},Nt=async(t,s=[])=>{const a=[];I.forEach(r=>{var E;const n=((E=r.meta)==null?void 0:E.products)||r.productIds||[],c=n.includes(t),d=s.includes(r._id);if(d&&!c&&a.push(u.put(`/home-sections/${r._id}`,{meta:{...r.meta||{},products:[...n,t]}},h)),!d&&c){const B=n.filter(he=>he!==t);a.push(u.put(`/home-sections/${r._id}`,{meta:{...r.meta||{},products:B}},h))}}),a.length&&(await Promise.all(a),_())},vt=async()=>{var t,s,a;try{if(_e&&(o.sizes||[]).length===0){i.error("Select at least one size for suits");return}const r=new FormData;r.append("name",o.name),r.append("description",o.description),r.append("category",o.category),o.categoryRef&&r.append("categoryRef",o.categoryRef),r.append("fabric",o.fabric);const n=(o.colors||[]).join(",").trim();r.append("color",n||o.color||""),r.append("colors",(o.colors||[]).join(",")),r.append("sizes",(o.sizes||[]).join(",")),r.append("price",o.price||0),o.discountPrice&&r.append("discountPrice",o.discountPrice),r.append("stock",o.stock||0),o.amazonLink&&r.append("amazonLink",o.amazonLink.trim()),o.flipkartLink&&r.append("flipkartLink",o.flipkartLink.trim()),r.append("images",o.images),o.video&&r.append("video",o.video),r.append("collections",o.collectionIds.join(",")),C.forEach(E=>r.append("images",E));const c={headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}};let d=z;z?(await u.put(`/products/${z}`,r,c),i.success("Product updated")):(d=((t=(await u.post("/products",r,c)).data)==null?void 0:t._id)||d,i.success("Product created")),d&&await Nt(d,m),b(ge),N([]),$([]),J(null),se(),Y()}catch(r){console.error(r),i.error(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.msg)||"Failed to save product")}},wt=t=>{var a,r,n,c;J(t._id),$([]),O(((a=t.sizes)==null?void 0:a.length)>0),b({name:t.name||"",description:t.description||"",category:t.category||"",categoryRef:((r=t.categoryRef)==null?void 0:r._id)||t.categoryRef||"",fabric:t.fabric||"",color:t.color||((n=t.colors)==null?void 0:n[0])||"",colors:Array.isArray(t.colors)&&t.colors.length?t.colors:t.color?t.color.split(/[,\\n]/).map(d=>d.trim()).filter(Boolean):[],sizes:t.sizes||[],amazonLink:t.amazonLink||"",flipkartLink:t.flipkartLink||"",price:t.price||"",discountPrice:t.discountPrice||"",stock:t.stock||"",images:(t.images||[]).join(`
`),video:t.video||"",collectionIds:((c=t.collections)==null?void 0:c.map(d=>d._id||d))||[]});const s=I.filter(d=>{var B;return(((B=d.meta)==null?void 0:B.products)||d.productIds||[]).includes(t._id)}).map(d=>d._id);N(s)},Ct=()=>{b(ge),N([]),$([]),p(""),O(!1),J(null)},kt=async t=>{if(window.confirm("Delete this product?"))try{await u.delete(`/products/${t}`,h),i.success("Deleted"),se(),Y()}catch{i.error("Failed to delete")}},St=async()=>{var t,s;try{await u.post("/collections",w,h),i.success("Collection created"),F(He),Y()}catch(a){i.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.msg)||"Failed to create collection")}},pe=async(t,s)=>{try{await u.put(`/collections/${t}`,s,h),i.success("Collection updated"),Y()}catch{i.error("Update failed")}},_t=async t=>{if(window.confirm("Delete this collection?"))try{await u.delete(`/collections/${t}`,h),i.success("Collection removed"),Y(),se()}catch{i.error("Could not delete")}},It=async(t,s)=>{if(s)try{const a=new FormData;a.append("file",s);const r=await u.post("/uploads",a,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}});await pe(t,{heroImage:r.data.url}),i.success("Image uploaded")}catch(a){console.error(a),i.error("Upload failed")}},Lt=async t=>{if(t)try{Z(!0);const s=new FormData;s.append("file",t);const a=await u.post("/uploads",s,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}});b(r=>({...r,video:a.data.url})),i.success("Video uploaded")}catch(s){console.error(s),i.error("Video upload failed")}finally{Z(!1)}},At=async t=>{if(!t)return"";try{const s=new FormData;s.append("file",t);const a=await u.post("/uploads",s,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}});return i.success("Image uploaded"),a.data.url}catch(s){return console.error(s),i.error("Upload failed"),""}},ae=async(t,s)=>{var a,r;try{await u.patch(`/orders/${t}`,s,h),i.success("Order updated"),ie()}catch(n){console.error(n),i.error(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.msg)||"Could not update order")}},Dt=(t=[])=>t.map(s=>{var a;return(a=j.find(r=>r._id===s))==null?void 0:a.title}).filter(Boolean).join(", ");return!l||(g==null?void 0:g.role)!=="admin"?null:e.jsxs("div",{className:"admin-page min-h-screen bg-[var(--bg)]",children:[e.jsx("header",{className:"sticky top-0 z-30 bg-gradient-to-b from-[var(--surface)]/95 to-[var(--surface-muted)]/88 backdrop-blur border-b border-[var(--border)] shadow-[0_12px_40px_rgba(24,16,10,0.08)]",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[var(--muted)]",children:"Admin"}),e.jsx("h1",{className:"text-xl font-semibold text-[var(--ink)]",children:"Mrigmaya Control Room"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-[var(--muted)]",children:["Logged in as ",g==null?void 0:g.mobile]}),e.jsx("button",{onClick:()=>{S(),D("/admin/login")},className:"pill-button secondary hover:-translate-y-0.5",children:"Logout"})]})]})}),e.jsxs("main",{className:"max-w-6xl mx-auto px-6 py-8 space-y-10 admin-main",children:[e.jsxs("section",{className:"card-shell p-6 admin-card admin-grid",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Quick sections"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"What would you like to manage?"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Pick a section below. Each panel only shows the tools needed for that part of the store."}),e.jsx("div",{className:"flex flex-wrap gap-3 mt-4",children:Qe.map(t=>e.jsx("button",{onClick:()=>Ke(t.id),className:`admin-tab px-4 py-2 rounded-full text-sm font-semibold border transition ${W===t.id?"bg-[var(--primary)] text-white border-[var(--primary)] shadow-sm":"border-[var(--border)] text-[var(--muted)] hover:border-[var(--primary)] hover:text-[var(--ink)]"}`,children:t.label},t.id))})]}),W==="coupons"&&e.jsxs("section",{className:"card-shell p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Promotions"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Coupon generator"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create one-time or limited-use coupon codes with flat or percent discounts."})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Code"}),e.jsx("input",{value:v.code,onChange:t=>T({...v,code:t.target.value}),placeholder:"FIRST123",className:"border rounded-xl px-4 py-3 w-full"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Discount type"}),e.jsxs("select",{value:v.discountType,onChange:t=>T({...v,discountType:t.target.value}),className:"border rounded-xl px-4 py-3 w-full",children:[e.jsx("option",{value:"flat",children:"Flat amount (₹)"}),e.jsx("option",{value:"percent",children:"Percent (%)"})]}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Value"}),e.jsx("input",{type:"number",min:"1",value:v.value,onChange:t=>T({...v,value:t.target.value}),placeholder:"e.g. 500 or 10",className:"border rounded-xl px-4 py-3 w-full"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Max discount (optional, for %)"}),e.jsx("input",{type:"number",min:"0",value:v.maxDiscount,onChange:t=>T({...v,maxDiscount:t.target.value}),placeholder:"Cap for percent coupons",className:"border rounded-xl px-4 py-3 w-full"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Min order value (optional)"}),e.jsx("input",{type:"number",min:"0",value:v.minOrderValue,onChange:t=>T({...v,minOrderValue:t.target.value}),placeholder:"Apply only above this amount",className:"border rounded-xl px-4 py-3 w-full"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Max redemptions (overall)"}),e.jsx("input",{type:"number",min:"1",value:v.maxRedemptions,onChange:t=>T({...v,maxRedemptions:t.target.value}),className:"border rounded-xl px-4 py-3 w-full"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Expires at (optional)"}),e.jsx("input",{type:"datetime-local",value:v.expiresAt,onChange:t=>T({...v,expiresAt:t.target.value}),className:"border rounded-xl px-4 py-3 w-full"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:v.active,onChange:t=>T({...v,active:t.target.checked})}),"Active"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:xt,className:"bg-pink-600 text-white px-6 py-3 rounded-full",children:"Save coupon"}),e.jsx("button",{onClick:Pe,className:"border border-gray-200 text-gray-600 px-4 py-3 rounded-full",children:"Clear"})]})]})]}),e.jsx("div",{className:"mt-8 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"py-2",children:"Code"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Value"}),e.jsx("th",{children:"Min"}),e.jsx("th",{children:"Used"}),e.jsx("th",{children:"Expires"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[be.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 font-semibold text-gray-900",children:t.code}),e.jsx("td",{children:t.discountType}),e.jsxs("td",{children:[t.discountType==="percent"?`${t.value}%`:`₹${t.value}`,t.maxDiscount?` (cap ₹${t.maxDiscount})`:""]}),e.jsxs("td",{children:["₹",t.minOrderValue||0]}),e.jsxs("td",{children:[t.redemptions||0," / ",t.maxRedemptions||1]}),e.jsx("td",{children:t.expiresAt?new Date(t.expiresAt).toLocaleString():"No expiry"}),e.jsx("td",{children:t.active?"Active":"Inactive"}),e.jsxs("td",{className:"space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>u.patch(`/coupons/${t._id}`,{active:!t.active},h).then(oe).catch(()=>i.error("Update failed")),className:"text-xs text-pink-600",children:t.active?"Disable":"Enable"}),e.jsx("button",{type:"button",onClick:()=>window.confirm("Delete coupon?")&&u.delete(`/coupons/${t._id}`,h).then(oe).catch(()=>i.error("Delete failed")),className:"text-xs text-red-500",children:"Delete"})]})]},t._id)),be.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-4 text-center text-gray-400",children:"No coupons yet"})})]})]})})]}),W==="orders"&&e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Orders"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Recent orders"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Update payment or delivery status from one place."})]}),e.jsx("button",{onClick:ie,className:"text-sm text-gray-500 underline",children:"Refresh"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"py-2",children:"Order"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Shipping"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Payment"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Tracking"}),e.jsx("th",{children:"Actions"})]})}),e.jsxs("tbody",{children:[ne.map(t=>{var s,a;return e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"py-2",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["#",t._id.slice(-6).toUpperCase()]}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(t.createdAt).toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.items.length," item(s)"]}),e.jsx("div",{className:"text-[11px] text-gray-500 space-y-1 mt-1",children:t.items.map((r,n)=>{var c;return e.jsxs("div",{className:"flex flex-wrap gap-1 items-center",children:[e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-gray-100 text-gray-800 border border-gray-200",children:((c=r.product)==null?void 0:c.name)||"Item"}),r.selectedColor&&e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-amber-50 text-amber-800 border border-amber-100",children:r.selectedColor}),r.selectedSize&&e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-100",children:r.selectedSize}),e.jsxs("span",{className:"text-gray-400",children:["×",r.quantity]})]},`${r.product}-${n}`)})})]}),e.jsx("td",{className:"text-xs text-gray-600",children:((s=t.user)==null?void 0:s.mobile)||t.customerContact||"NA"}),e.jsxs("td",{className:"text-xs text-gray-600 max-w-xs",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:((a=t.shippingAddress)==null?void 0:a.name)||"—"}),e.jsx("p",{className:"text-gray-500",children:et(t)}),t.customerNote&&e.jsxs("p",{className:"text-[11px] text-gray-400 mt-1",children:["Note: ",t.customerNote]})]}),e.jsxs("td",{className:"font-semibold text-gray-900",children:["₹",new Intl.NumberFormat("en-IN").format(t.amount||0)]}),e.jsx("td",{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:t.paymentMethod}),e.jsx("select",{className:"border rounded-lg px-2 py-1 text-xs",value:t.paymentStatus,onChange:r=>ae(t._id,{paymentStatus:r.target.value}),children:Ft.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]})}),e.jsx("td",{children:e.jsx("select",{className:"border rounded-lg px-2 py-1 text-xs",value:t.status,onChange:r=>ae(t._id,{status:r.target.value}),children:zt.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})}),e.jsx("td",{className:"text-xs text-gray-600",children:e.jsxs("div",{className:"space-y-1",children:[(t.trackingLink||t.trackingNumber)&&e.jsx("a",{href:(t.trackingLink||t.trackingNumber||"").startsWith("http")?t.trackingLink||t.trackingNumber:void 0,target:"_blank",rel:"noreferrer",className:"text-[11px] text-pink-600 underline",children:"Open tracking"}),e.jsx("input",{type:"text",className:"border rounded-lg px-2 py-1 w-full",placeholder:"Paste tracking URL",defaultValue:t.trackingLink||"",onBlur:r=>ae(t._id,{trackingLink:r.target.value.trim()})}),!t.trackingLink&&t.trackingNumber&&e.jsxs("p",{className:"text-[11px] text-gray-500",children:["Current: ",t.trackingNumber]})]})}),e.jsxs("td",{className:"text-right space-y-2",children:[t.paymentMethod==="UPI"&&t.upiIntent&&e.jsx("a",{href:t.upiIntent,target:"_blank",rel:"noreferrer",className:"text-xs text-pink-600",children:"UPI link"}),e.jsx("button",{type:"button",onClick:()=>st(t._id),className:"block text-xs text-pink-600 underline",children:"Download bill"})]})]},t._id)}),ne.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-6 text-center text-gray-400",children:"No orders yet"})})]})]})})]}),W==="returns"&&e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Returns"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Return requests"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Approve/reject and view photos sent by customers."})]}),e.jsx("button",{onClick:ie,className:"text-sm text-gray-500 underline",children:"Refresh"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"py-2",children:"Order"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Reason"}),e.jsx("th",{children:"Photos"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Note"})]})}),e.jsxs("tbody",{children:[Ce.map(t=>{var s,a,r;return e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"py-2",children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["#",t._id.slice(-6).toUpperCase()]}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(t.createdAt).toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.items.length," item(s)"]})]}),e.jsxs("td",{className:"text-xs text-gray-600",children:[((s=t.user)==null?void 0:s.mobile)||t.customerContact||"NA",e.jsxs("div",{className:"text-gray-500",children:[(a=t.shippingAddress)==null?void 0:a.name," ",(r=t.shippingAddress)==null?void 0:r.phone]})]}),e.jsxs("td",{className:"text-xs text-gray-600 max-w-xs",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.returnReason||"No reason"}),t.returnNote&&e.jsxs("p",{className:"text-gray-500",children:["Note: ",t.returnNote]})]}),e.jsx("td",{className:"text-xs text-gray-600",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(t.returnImages||[]).map((n,c)=>{const d=V(n);return e.jsx("a",{href:d,target:"_blank",rel:"noreferrer",className:"block w-16 h-16 rounded-lg overflow-hidden border border-gray-200",children:e.jsx("img",{src:d,alt:"return",className:"w-full h-full object-cover"})},c)}),(t.returnImages||[]).length===0&&e.jsx("span",{children:"None"})]})}),e.jsx("td",{children:e.jsx("select",{className:"border rounded-lg px-2 py-1 text-xs",value:t.returnStatus||"none",onChange:n=>ae(t._id,{returnStatus:n.target.value}),children:["requested","approved","rejected","received","refunded"].map(n=>e.jsx("option",{value:n,children:n},n))})}),e.jsx("td",{className:"text-xs",children:e.jsx("textarea",{className:"border rounded-lg px-2 py-1 text-xs w-full",placeholder:"Return note",defaultValue:t.returnNote||"",onBlur:n=>ae(t._id,{returnNote:n.target.value})})})]},t._id)}),Ce.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-6 text-center text-gray-400",children:"No return requests yet"})})]})]})})]}),W==="products"&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Catalog"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:z?"Edit product":"Create product"})]}),z&&e.jsx("button",{onClick:Ct,className:"text-sm text-gray-500 underline",children:"Cancel edit"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-6",children:[e.jsx("input",{value:o.name,onChange:t=>b({...o,name:t.target.value}),placeholder:"Product name",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Assign category"}),e.jsxs("select",{value:o.categoryRef,onChange:t=>b({...o,categoryRef:t.target.value}),className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100 w-full",children:[e.jsx("option",{value:"",children:"Select category"}),L.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsx("input",{value:o.category,onChange:t=>b({...o,category:t.target.value}),placeholder:"Display label (ex. Banarasi, Poshaak)",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100"}),e.jsx("input",{value:o.fabric,onChange:t=>b({...o,fabric:t.target.value}),placeholder:"Fabric",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Available colors (Saree / Suit)"}),o.colors.length>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[o.colors.length," selected"]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:t=>O(t.target.checked)}),"Suit product? Show size picker"]}),e.jsxs("span",{className:"text-[11px]",children:["Detected category: ",xe?"Suit":"Other"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Te.map(t=>{const s=o.colors.includes(t.label),a=Be(t.label),r=typeof a=="string"&&a.startsWith("#")&&Rt(a)?"#1f2937":"#ffffff";return e.jsx("button",{type:"button",onClick:()=>ue(t.label),title:t.label,className:`px-3 py-2 rounded-full text-xs border transition shadow-sm ${s?"ring-2 ring-pink-200 border-pink-200":"border-gray-200"}`,style:{background:a,color:s?r:"#ffffff",minWidth:64,boxShadow:s?"0 4px 12px rgba(0,0,0,0.12)":"0 2px 6px rgba(0,0,0,0.06)"},children:t.label},t.label)})}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("input",{value:G,onChange:t=>p(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),Se())},placeholder:"Add custom color (press Enter)",className:"border rounded-xl px-4 py-3 flex-1 focus:outline-none focus:ring-2 focus:ring-pink-100"}),e.jsx("button",{type:"button",onClick:Se,className:"px-4 py-3 rounded-xl bg-gray-900 text-white text-sm",children:"Add"})]}),o.colors.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:o.colors.map(t=>e.jsxs("span",{className:"px-3 py-1 rounded-full border text-xs text-gray-700 flex items-center gap-2 shadow-sm",style:{background:Be(t),borderColor:"rgba(0,0,0,0.08)",color:"#1f2937"},children:[t,e.jsx("button",{type:"button",className:"text-gray-400",onClick:()=>ue(t),children:"×"})]},t))})]}),_e&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Available sizes (Suit)"}),o.sizes.length===0&&e.jsx("span",{className:"text-xs text-red-500",children:"Select sizes for suits"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:t=>O(t.target.checked)}),"Force show sizes (for suit products without “suit” in category name)"]}),e.jsxs("span",{children:["Detected: ",xe?"Suit category":"Other"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Ot.map(t=>{const s=o.sizes.includes(t);return e.jsx("button",{type:"button",onClick:()=>Ze(t),className:`px-3 py-2 rounded-full text-xs border transition ${s?"bg-indigo-100 border-indigo-300 text-indigo-700":"bg-white border-gray-200 text-gray-600 hover:border-indigo-200"}`,children:t},t)})})]}),e.jsx("input",{value:o.amazonLink,onChange:t=>b({...o,amazonLink:t.target.value}),placeholder:"Amazon product link (optional)",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100",type:"url"}),e.jsx("input",{value:o.flipkartLink,onChange:t=>b({...o,flipkartLink:t.target.value}),placeholder:"Flipkart product link (optional)",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100",type:"url"}),e.jsx("input",{value:o.price,onChange:t=>b({...o,price:t.target.value}),placeholder:"Price (MRP)",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100",type:"number"}),e.jsx("input",{value:o.discountPrice,onChange:t=>b({...o,discountPrice:t.target.value}),placeholder:"Selling price",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100",type:"number"}),e.jsx("input",{value:o.stock,onChange:t=>b({...o,stock:t.target.value}),placeholder:"Stock",className:"border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-100",type:"number"})]}),e.jsx("textarea",{value:o.description,onChange:t=>b({...o,description:t.target.value}),placeholder:"Description / story",className:"border rounded-2xl px-4 py-3 w-full mt-4 focus:outline-none focus:ring-2 focus:ring-pink-100",rows:3}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Existing image URLs (one per line)"}),e.jsx("textarea",{value:o.images,onChange:t=>b({...o,images:t.target.value}),className:"border rounded-2xl px-4 py-3 w-full focus:outline-none focus:ring-2 focus:ring-pink-100",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Upload new images (select multiple)"}),e.jsx("input",{type:"file",multiple:!0,onChange:t=>$(Array.from(t.target.files)),className:"border rounded-xl px-4 py-3 w-full"}),C.length>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-2 space-y-1",children:[e.jsxs("p",{children:[C.length," new file(s) selected"]}),e.jsxs("ul",{className:"list-disc list-inside space-y-0.5",children:[C.slice(0,4).map(t=>e.jsx("li",{children:t.name},t.name)),C.length>4&&e.jsxs("li",{children:["+",C.length-4," more"]})]})]}),te.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Currently attached (",te.length,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[te.slice(0,8).map((t,s)=>e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-gray-200 bg-gray-50",children:e.jsx("img",{src:V(t),alt:"",className:"w-full h-full object-cover"})},`${t}-${s}`)),te.length>8&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",te.length-8," more"]})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Attach to homepage collections (Sarees / Suits / Gold / Best Seller)"}),e.jsx("select",{multiple:!0,value:o.collectionIds,onChange:t=>b({...o,collectionIds:Array.from(t.target.selectedOptions,s=>s.value)}),className:"border rounded-xl px-4 py-3 w-full focus:outline-none focus:ring-2 focus:ring-pink-100 h-40",children:j.map(t=>e.jsx("option",{value:t._id,children:t.title},t._id))}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2 text-xs",children:[j.map(t=>e.jsxs("button",{type:"button",className:"px-3 py-1 border border-gray-200 rounded-full",onClick:()=>b(s=>s.collectionIds.includes(t._id)?s:{...s,collectionIds:[...s.collectionIds,t._id]}),children:["Add to ",t.title]},`quick-${t._id}`)),o.collectionIds.length>0&&e.jsx("button",{type:"button",className:"px-3 py-1 border border-gray-200 rounded-full text-gray-500",onClick:()=>b(t=>({...t,collectionIds:[]})),children:"Clear selections"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Attach to mood cards (home tiles)"}),e.jsx("select",{multiple:!0,value:m,onChange:t=>N(Array.from(t.target.selectedOptions,s=>s.value)),className:"border rounded-xl px-4 py-3 w-full focus:outline-none focus:ring-2 focus:ring-pink-100 h-32",children:I.map(t=>e.jsxs("option",{value:t._id,children:[t.title||"Untitled"," ",t.tag?`(${t.tag})`:""]},t._id))}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2 text-xs",children:[I.map(t=>e.jsxs("button",{type:"button",className:"px-3 py-1 border border-gray-200 rounded-full",onClick:()=>N(s=>s.includes(t._id)?s:[...s,t._id]),children:["Add to ",t.title||"Mood"]},`quick-mood-${t._id}`)),m.length>0&&e.jsx("button",{type:"button",className:"px-3 py-1 border border-gray-200 rounded-full text-gray-500",onClick:()=>N([]),children:"Clear mood selection"})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Product video URL (optional)"}),e.jsx("input",{value:o.video,onChange:t=>b({...o,video:t.target.value}),placeholder:"https://... (mp4 / hosted link)",className:"border rounded-xl px-4 py-3 w-full focus:outline-none focus:ring-2 focus:ring-pink-100"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"file",accept:"video/*",className:"text-sm",onChange:t=>{var s;return Lt((s=t.target.files)==null?void 0:s[0])}}),X&&e.jsx("span",{className:"text-xs text-gray-400",children:"Uploading..."})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Paste a hosted link or upload to store on server."})]})}),e.jsx("button",{onClick:vt,className:"mt-6 bg-pink-600 text-white px-6 py-3 rounded-full",children:z?"Update product":"Create product"})]}),e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Live catalog"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Products"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500",children:[e.jsx("th",{className:"py-2",children:"Name"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Collections"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:k.map(t=>{var s;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2",children:t.name}),e.jsx("td",{children:t.discountPrice||t.price}),e.jsx("td",{className:"text-xs text-gray-500",children:Dt((s=t.collections)==null?void 0:s.map(a=>a._id||a))}),e.jsxs("td",{className:"text-right space-x-3",children:[e.jsx("button",{className:"text-pink-600",onClick:()=>wt(t),children:"Edit"}),e.jsx("button",{className:"text-gray-400",onClick:()=>kt(t._id),children:"Delete"})]})]},t._id)})})]})})]})]}),W==="collections"&&e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Homepage sections"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Collection studio"})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-6",children:[e.jsx("input",{value:w.title,onChange:t=>F({...w,title:t.target.value}),placeholder:"Title",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:w.slug,onChange:t=>F({...w,slug:t.target.value}),placeholder:"Slug (unique)",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:w.subtitle,onChange:t=>F({...w,subtitle:t.target.value}),placeholder:"Subtitle",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:w.ctaLabel,onChange:t=>F({...w,ctaLabel:t.target.value}),placeholder:"CTA Label",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:w.heroImage,onChange:t=>F({...w,heroImage:t.target.value}),placeholder:"Hero image URL",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:w.accentColor,onChange:t=>F({...w,accentColor:t.target.value}),placeholder:"Accent color",className:"border rounded-xl px-4 py-3"}),e.jsx("input",{value:w.priority,type:"number",onChange:t=>F({...w,priority:Number(t.target.value)}),placeholder:"Priority (lower first)",className:"border rounded-xl px-4 py-3"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:w.displayOnHome,onChange:t=>F({...w,displayOnHome:t.target.checked})}),"Display on homepage"]})]}),e.jsx("textarea",{value:w.description,onChange:t=>F({...w,description:t.target.value}),placeholder:"Description",className:"border rounded-2xl px-4 py-3 w-full mt-4",rows:3}),e.jsx("button",{onClick:St,className:"mt-4 bg-gray-900 text-white px-6 py-3 rounded-full",children:"Create collection"}),e.jsxs("div",{className:"mt-10 space-y-10 admin-collections",children:[j.length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:"Create a collection to start building your home tiles."}),j.map(t=>e.jsxs("div",{className:"admin-collection-row",children:[e.jsx(Tt,{collection:t,onSave:s=>pe(t._id,s),onDelete:()=>_t(t._id),onHeroUpload:s=>It(t._id,s),onGalleryUpload:s=>At(s)}),e.jsx(Et,{collection:t,products:k,onUpdate:s=>pe(t._id,{products:s})})]},t._id))]})]}),W==="homepage"&&e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Homepage slider"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Hero image manager"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Upload multiple hero images at once and they will rotate on the storefront automatically."})]}),e.jsxs("div",{className:"mt-6 border border-gray-100 rounded-2xl p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Upload photos / videos"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select one or more images or MP4/WebM clips."}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",className:"mt-3 text-sm",onChange:t=>{gt(t.target.files),t.target.value=""}})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Or paste an image / video link"}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row mt-2",children:[e.jsx("input",{value:de,onChange:t=>je(t.target.value),placeholder:"https://example.com/hero.jpg or https://example.com/hero.mp4",className:"border rounded-xl px-4 py-2 text-sm flex-1"}),e.jsx("button",{onClick:yt,className:"px-4 py-2 rounded-xl bg-gray-900 text-white text-sm",children:"Add slide"})]})]}),Ge&&e.jsx("p",{className:"text-xs text-gray-400",children:"Uploading..."})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Slides"}),e.jsxs("h3",{className:"text-xl font-semibold text-gray-900",children:[A.length," slide",A.length===1?"":"s"]})]})}),A.length===0?e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"No slides yet. Upload images to get started."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:A.map((t,s)=>e.jsx(Bt,{slide:t,index:s,isLast:s===A.length-1,onToggle:a=>ft(t._id,a),onDelete:()=>bt(t._id),onMoveUp:()=>$e(t._id,"up"),onMoveDown:()=>$e(t._id,"down"),onReorder:a=>jt(a,t._id)},t._id))})]}),we.length>0&&e.jsxs("div",{className:"mt-6 bg-white border border-gray-100 rounded-2xl p-4 space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Recent changes"}),e.jsx("ul",{className:"space-y-1 text-sm text-gray-700",children:we.map((t,s)=>e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500 text-xs",children:new Date(t.ts).toLocaleTimeString()})," ",t.message]},`${t.ts}-${s}`))})]}),e.jsxs("div",{className:"mt-10 border-t pt-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Featured edits"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Mood cards (home tiles)"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Add tiles like Saree / Suit / Jewellery. Set title, badge, link, and image."})]}),ee&&e.jsx("button",{onClick:me,className:"text-sm text-gray-500 underline",children:"Cancel edit"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Title"}),e.jsx("input",{value:U.title,onChange:t=>R(s=>({...s,title:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Saree"}),e.jsx("label",{className:"text-sm text-gray-600",children:"Subtitle"}),e.jsx("input",{value:U.subtitle,onChange:t=>R(s=>({...s,subtitle:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Pure zari woven"}),e.jsx("label",{className:"text-sm text-gray-600",children:"Badge / tag"}),e.jsx("input",{value:U.tag,onChange:t=>R(s=>({...s,tag:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Bestseller / New"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"CTA label"}),e.jsx("input",{value:U.ctaLabel,onChange:t=>R(s=>({...s,ctaLabel:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Shop sarees >"}),e.jsx("label",{className:"text-sm text-gray-600",children:"CTA link"}),e.jsx("input",{value:U.ctaLink,onChange:t=>R(s=>({...s,ctaLink:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"/products or /collection/sarees"}),e.jsx("label",{className:"text-sm text-gray-600",children:"Display order"}),e.jsx("input",{type:"number",value:U.order,onChange:t=>R(s=>({...s,order:Number(t.target.value)})),className:"border rounded-xl px-3 py-2 w-full"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Image URL"}),e.jsx("input",{value:U.image,onChange:t=>R(s=>({...s,image:t.target.value})),className:"border rounded-xl px-3 py-2 w-full",placeholder:"https://..."}),e.jsx("input",{type:"file",accept:"image/*",className:"mt-2 text-sm",onChange:t=>{var s;return ct((s=t.target.files)==null?void 0:s[0])}}),qe&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Uploading..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Attach products"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("select",{className:"border rounded-xl px-3 py-2 text-sm flex-1",value:"",onChange:t=>{const s=t.target.value;s&&R(a=>a.productIds.includes(s)?a:{...a,productIds:[...a.productIds,s]})},children:[e.jsx("option",{value:"",children:"Choose product"}),k.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]}),e.jsx("span",{className:"text-xs text-gray-500 self-center",children:"Pick items to show when opening this edit."})]}),U.productIds.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:U.productIds.map(t=>{const s=k.find(a=>a._id===t);return e.jsxs("span",{className:"px-3 py-1 rounded-full bg-gray-100 text-xs text-gray-700 flex items-center gap-2",children:[(s==null?void 0:s.name)||"Product",e.jsx("button",{type:"button",className:"text-gray-500",onClick:()=>R(a=>({...a,productIds:a.productIds.filter(r=>r!==t)})),children:"×"})]},t)})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-6",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:U.active,onChange:t=>R(s=>({...s,active:t.target.checked}))}),"Active"]}),e.jsx("button",{onClick:nt,className:"px-5 py-3 bg-pink-600 text-white rounded-full text-sm font-semibold",children:ee?"Update card":"Save card"})]}),e.jsxs("div",{className:"mt-6 grid md:grid-cols-3 gap-3",children:[I.map((t,s)=>e.jsx(Ht,{card:{...t,allProducts:k},index:s,isLast:s===I.length-1,onEdit:()=>ot(t),onDelete:()=>it(t._id),onToggle:a=>u.put(`/home-sections/${t._id}`,{active:a},h).then(_).catch(()=>i.error("Could not update card")),onMoveUp:()=>De(t._id,"up"),onMoveDown:()=>De(t._id,"down"),onAddProduct:a=>dt(t._id,a),onDeleteProduct:a=>ht(t._id,a),allProducts:k,onAddCustom:a=>ut(t._id,a),onDeleteCustom:a=>mt(t._id,a),onUploadCustom:pt},t._id)),I.length===0&&e.jsx("p",{className:"text-sm text-gray-500",children:"No mood cards yet. Add up to 3 tiles."})]})]})]}),W==="login-visuals"&&e.jsxs("section",{className:"bg-white rounded-3xl shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Login page"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Side visuals"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Update the left and right images shown on the login screen. Leave blank to hide."})]})}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:ye.map((t,s)=>e.jsxs("div",{className:"border border-gray-100 rounded-2xl p-4 space-y-3",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-800",children:["Visual ",s===0?"Left":"Right"]}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Title"}),e.jsx("input",{value:t.title,onChange:a=>ce(s,"title",a.target.value),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Sequin night"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Subtitle"}),e.jsx("input",{value:t.subtitle,onChange:a=>ce(s,"subtitle",a.target.value),className:"border rounded-xl px-3 py-2 w-full",placeholder:"Cocktail sarees"}),e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Image URL"}),e.jsx("input",{value:t.image,onChange:a=>ce(s,"image",a.target.value),className:"border rounded-xl px-3 py-2 w-full",placeholder:"https://..."}),e.jsx("input",{type:"file",accept:"image/*",className:"text-sm",onChange:a=>{var n;const r=(n=a.target.files)==null?void 0:n[0];rt(r,s),a.target.value=""}}),We&&e.jsx("p",{className:"text-xs text-gray-400",children:"Uploading..."}),t.image&&e.jsx("div",{className:"mt-2 rounded-xl overflow-hidden h-32 bg-gray-100",children:e.jsx("img",{src:V(t.image),alt:t.title,className:"w-full h-full object-cover"})})]},s))}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:at,className:"px-5 py-3 bg-pink-600 text-white rounded-full text-sm font-semibold",children:"Save visuals"})})]})]})]})}function Bt({slide:l,index:g,isLast:S,onToggle:D,onDelete:k,onMoveUp:y,onMoveDown:j,onReorder:P}){var N;const L=V(l.video||l.heroVideo||((N=l.meta)==null?void 0:N.video)||""),M=V(l.image||l.heroImage||(Array.isArray(l.images)?l.images[0]:"")),o=L||M,b=l.active!==!1,m=!!L;return e.jsxs("div",{className:"border border-gray-200 rounded-2xl p-4 space-y-3 bg-white",draggable:!0,onDragStart:C=>C.dataTransfer.setData("text/plain",l._id),onDragOver:C=>C.preventDefault(),onDrop:C=>{C.preventDefault();const $=C.dataTransfer.getData("text/plain");$&&(P==null||P($,l._id))},children:[e.jsx("div",{className:"rounded-xl overflow-hidden bg-gray-100 aspect-[16/9]",children:o?m?e.jsx("video",{src:o,poster:M||void 0,className:"w-full h-full object-cover",muted:!0,loop:!0,playsInline:!0,preload:"metadata"}):e.jsx("img",{src:o,alt:l.title||`Slide ${g+1}`,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-400",children:"No media"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["Slide ",g+1]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Order ",l.order??g+1]})]}),o&&e.jsx("a",{href:o,target:"_blank",rel:"noreferrer",className:"text-xs text-pink-600",children:"View"})]}),m&&e.jsx("span",{className:"inline-block text-[11px] text-indigo-600 font-semibold",children:"Video slide"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:C=>D(C.target.checked)}),"Show on homepage"]}),(l.title||l.description)&&e.jsxs("div",{className:"text-xs text-gray-500",children:[l.title&&e.jsx("p",{className:"font-semibold",children:l.title}),l.description&&e.jsx("p",{children:l.description})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[e.jsx("button",{type:"button",onClick:y,disabled:g===0,className:`px-3 py-2 rounded-xl border ${g===0?"text-gray-300 border-gray-200 cursor-not-allowed":"text-gray-700 border-gray-300"}`,children:"Move up"}),e.jsx("button",{type:"button",onClick:j,disabled:S,className:`px-3 py-2 rounded-xl border ${S?"text-gray-300 border-gray-200 cursor-not-allowed":"text-gray-700 border-gray-300"}`,children:"Move down"}),e.jsx("button",{type:"button",onClick:k,className:"px-3 py-2 rounded-xl border border-red-200 text-red-600",children:"Delete"})]})]})}function Ht({card:l,index:g,isLast:S,onEdit:D,onDelete:k,onToggle:y,onMoveUp:j,onMoveDown:P,onAddProduct:L,onDeleteProduct:M,onAddCustom:o,onDeleteCustom:b,onUploadCustom:m,allProducts:N}){var G,p;x.useState({name:"",price:"",mrp:"",image:"",images:[]});const C=l.active!==!1,$=((G=l.meta)==null?void 0:G.products)||l.productIds||[];return(p=l.meta)!=null&&p.customProducts,e.jsxs("div",{className:"border border-gray-200 rounded-2xl p-3 space-y-2 bg-white shadow-sm",children:[e.jsx("div",{className:"rounded-xl overflow-hidden bg-gray-100 aspect-[4/5]",children:l.image?e.jsx("img",{src:V(l.image),alt:l.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-gray-400",children:"No image"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400 flex items-center gap-2",children:[l.tag||"Mood"," ",e.jsx("span",{className:"text-gray-300",children:"·"})," Order ",l.order??g+1]}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:l.title||"Untitled"}),l.subtitle&&e.jsx("p",{className:"text-sm text-gray-500",children:l.subtitle}),$.length>0&&e.jsxs("p",{className:"text-[11px] text-gray-500",children:[$.length," product",$.length===1?"":"s"]}),l.ctaLabel&&e.jsxs("p",{className:"text-[11px] text-pink-600 mt-1",children:[l.ctaLabel," → ",l.ctaLink||"/products"]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:f=>y(f.target.checked)}),"Active"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[e.jsx("button",{onClick:D,className:"px-3 py-2 rounded-xl border border-gray-300 text-gray-700",children:"Edit"}),e.jsx("button",{onClick:j,disabled:g===0,className:`px-3 py-2 rounded-xl border ${g===0?"text-gray-300 border-gray-200 cursor-not-allowed":"text-gray-700 border-gray-300"}`,children:"Up"}),e.jsx("button",{onClick:P,disabled:S,className:`px-3 py-2 rounded-xl border ${S?"text-gray-300 border-gray-200 cursor-not-allowed":"text-gray-700 border-gray-300"}`,children:"Down"}),e.jsx("button",{onClick:k,className:"px-3 py-2 rounded-xl border border-red-200 text-red-600",children:"Delete"})]}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[e.jsx("p",{className:"font-semibold",children:"Attached products"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[$.length===0&&e.jsx("span",{className:"text-gray-400",children:"None"}),$.map(f=>{var O,X,Z,z,J;return e.jsxs("span",{className:"px-3 py-1 rounded-full bg-gray-100 text-gray-700 flex items-center gap-2",children:[((X=(O=l.products)==null?void 0:O.find(w=>w._id===f))==null?void 0:X.name)||((J=(z=(Z=l.meta)==null?void 0:Z.productsDetails)==null?void 0:z.find(w=>w._id===f))==null?void 0:J.name)||f,e.jsx("button",{type:"button",className:"text-gray-500",onClick:()=>M(f),children:"×"})]},f)})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{className:"border rounded-xl px-2 py-1 flex-1",value:"",onChange:f=>L(f.target.value),children:[e.jsx("option",{value:"",children:"Add product"}),(N||[]).map(f=>e.jsx("option",{value:f._id,children:f.name},f._id))]})})]})]})}function Tt({collection:l,onSave:g,onDelete:S,onHeroUpload:D,onGalleryUpload:k}){var G;const[y,j]=x.useState({title:l.title,subtitle:l.subtitle||"",description:l.description||"",ctaLabel:l.ctaLabel||"",heroImage:l.heroImage||"",accentColor:l.accentColor||"#c1275a",displayOnHome:l.displayOnHome,priority:l.priority}),[P,L]=x.useState(l.heroImages||[]),[M,o]=x.useState(""),[b,m]=x.useState(!1);x.useEffect(()=>{j({title:l.title,subtitle:l.subtitle||"",description:l.description||"",ctaLabel:l.ctaLabel||"",heroImage:l.heroImage||"",accentColor:l.accentColor||"#c1275a",displayOnHome:l.displayOnHome,priority:l.priority}),L(l.heroImages||[])},[l]);const N=()=>{M.trim()&&(L(p=>[...p,M.trim()]),o(""))},C=p=>{L(f=>f.filter((O,X)=>X!==p))},$=async p=>{if(p){m(!0);try{const f=await k(p);f&&L(O=>[...O,f])}finally{m(!1)}}};return e.jsx("div",{className:"border border-gray-200 rounded-2xl p-4",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:l.title}),e.jsxs("span",{className:"text-xs text-gray-500",children:[((G=l.products)==null?void 0:G.length)||0," items linked"]})]}),e.jsx("input",{value:y.title,onChange:p=>j({...y,title:p.target.value}),placeholder:"Collection title",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsx("input",{value:y.subtitle,onChange:p=>j({...y,subtitle:p.target.value}),placeholder:"Subtitle",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsx("textarea",{value:y.description,onChange:p=>j({...y,description:p.target.value}),placeholder:"Description",className:"border rounded-xl px-3 py-2 text-sm",rows:2}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx("input",{value:y.ctaLabel,onChange:p=>j({...y,ctaLabel:p.target.value}),placeholder:"CTA label",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsxs("div",{children:[e.jsx("input",{value:y.heroImage,onChange:p=>j({...y,heroImage:p.target.value}),placeholder:"Hero image URL",className:"border rounded-xl px-3 py-2 text-sm w-full"}),e.jsx("input",{type:"file",className:"mt-2 text-sm",onChange:p=>{var f;return D((f=p.target.files)==null?void 0:f[0])}}),e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsx("button",{type:"button",onClick:()=>j(p=>({...p,heroImage:""})),className:"text-xs text-gray-500 underline",children:"Remove hero image"}),y.heroImage&&e.jsx("a",{href:y.heroImage,target:"_blank",rel:"noreferrer",className:"text-xs text-pink-600",children:"View"})]}),y.heroImage&&e.jsx("div",{className:"mt-2 rounded-xl overflow-hidden border bg-gray-50",children:e.jsx("img",{src:V(y.heroImage),alt:"Hero preview",className:"w-full h-48 object-cover"})})]})]}),e.jsxs("div",{className:"border border-gray-100 rounded-2xl p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Hero gallery"}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-3",children:[P.map((p,f)=>e.jsxs("div",{className:"w-16 h-16 rounded-xl overflow-hidden relative",children:[e.jsx("img",{src:V(p),alt:"gallery",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>C(f),className:"absolute top-1 right-1 bg-black/60 text-white text-[10px] px-1 rounded",children:"✕"})]},`${p}-${f}`)),P.length===0&&e.jsx("p",{className:"text-xs text-gray-400",children:"No gallery images yet"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:M,onChange:p=>o(p.target.value),placeholder:"Image URL",className:"border rounded-xl px-3 py-2 text-sm flex-1"}),e.jsx("button",{type:"button",onClick:N,className:"px-3 py-2 rounded-xl bg-gray-900 text-white text-sm",children:"Add"})]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",className:"text-sm",onChange:p=>{var f;return $((f=p.target.files)==null?void 0:f[0])}}),b&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Uploading image..."})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[e.jsx("input",{value:y.accentColor,onChange:p=>j({...y,accentColor:p.target.value}),placeholder:"#c1275a",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsx("input",{type:"number",value:y.priority,onChange:p=>j({...y,priority:Number(p.target.value)}),placeholder:"Priority",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:y.displayOnHome,onChange:p=>j({...y,displayOnHome:p.target.checked})}),"Show on home"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("button",{onClick:()=>g({...y,heroImages:P}),className:"px-4 py-2 bg-gray-900 text-white rounded-full",children:"Save collection"}),e.jsx("button",{onClick:S,className:"text-gray-400",children:"Delete"})]})]})})}function Et({collection:l,products:g,onUpdate:S}){const[D,k]=x.useState(""),[y,j]=x.useState(""),P=(l.products||[]).map(m=>typeof m=="string"?g.find(N=>N._id===m):m).filter(Boolean),L=P.map(m=>m._id),M=g.filter(m=>!L.includes(m._id)).filter(m=>{var N;return(N=m.name)==null?void 0:N.toLowerCase().includes(D.toLowerCase())});x.useEffect(()=>{k(""),j("")},[l==null?void 0:l._id]);const o=m=>{const N=L.filter(C=>C!==m);S(N)},b=()=>{if(!y)return;const m=[...L,y];S(m),j(""),k("")};return e.jsxs("div",{className:"border border-gray-100 rounded-3xl p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Linked products"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Attach items to this collection. They will appear on the homepage rail exactly in this order."}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.4em] text-gray-400",children:"Add product"}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsx("input",{value:D,onChange:m=>k(m.target.value),placeholder:"Search products",className:"border rounded-xl px-3 py-2 text-sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:y,onChange:m=>j(m.target.value),className:"border rounded-xl px-3 py-2 text-sm flex-1",children:[e.jsx("option",{value:"",children:"Choose product"}),M.slice(0,30).map(m=>e.jsx("option",{value:m._id,children:m.name},m._id))]}),e.jsx("button",{onClick:b,className:"px-4 py-2 rounded-xl bg-gray-900 text-white text-sm",children:"Add"})]}),M.length===0&&e.jsx("p",{className:"text-xs text-gray-400",children:"No more products match this search."})]})]}),e.jsxs("div",{className:"mt-6 space-y-3 max-h-[420px] overflow-y-auto pr-2",children:[P.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"No products linked yet."}),P.map(m=>{var N;return e.jsxs("div",{className:"border border-gray-100 rounded-2xl p-3 flex items-center gap-3 bg-white",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl overflow-hidden bg-gray-100 flex-shrink-0",children:e.jsx("img",{src:V((N=m.images)==null?void 0:N[0]),alt:m.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:m.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(Fe(m)||m.category)&&e.jsxs("span",{children:[Fe(m)||m.category," • "]}),"Rs."," ",new Intl.NumberFormat("en-IN").format(m.discountPrice||m.price||0)]})]}),e.jsx("button",{onClick:()=>o(m._id),className:"text-xs text-gray-500",children:"Remove"})]},m._id)})]})]})}export{qt as default};
