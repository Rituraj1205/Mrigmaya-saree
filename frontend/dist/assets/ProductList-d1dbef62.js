import{c as ye,u as Se,r as l,C as be,d as Pe,i as O,j as s,a as we}from"./index-a1a7f1c8.js";import{B as ke}from"./BrandLoader-c47f9f10.js";import{s as Ae}from"./seo-9ae4805b.js";const Ie="data:image/gif;base64,R0lGODlhAQABAAD/ACw=",_e=[{value:"featured",label:"Featured"},{value:"priceLow",label:"Price: Low to High"},{value:"priceHigh",label:"Price: High to Low"},{value:"new",label:"Newest first"}],M=u=>`Rs. ${new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(u||0)}`,oe=u=>{if(u==null)return 0;if(typeof u=="number")return u;if(typeof u=="string"){const A=u.replace(/,/g,"").trim(),B=Number(A);return Number.isNaN(B)?0:B}return 0},ne=(u,A=0)=>we(u,Ie,A);function Ee(){var ae,re;const u=ye(),A=Se(),{addToCart:B}=l.useContext(be),{slug:V}=Pe(),[N,de]=l.useState([]),[m,ue]=l.useState([]),[f,he]=l.useState([]),[K,pe]=l.useState(["All Sarees"]),[E,Q]=l.useState(!0),[J,X]=l.useState(""),[d,C]=l.useState("All Sarees"),[v,S]=l.useState(""),[p,b]=l.useState(""),[x,F]=l.useState(4e3),[Y,fe]=l.useState(6e3),[I,Z]=l.useState("new"),[y,$]=l.useState(""),[R,ee]=l.useState([]),[_,se]=l.useState(""),[U,ge]=l.useState(""),[te,me]=l.useState(!1),[T,xe]=l.useState(4e3),[je,D]=l.useState(!1),[Ne,H]=l.useState(!1),[P,q]=l.useState(1),z=12,Ce=5,g=v||U;l.useEffect(()=>{const e=[];_&&e.push(_),d&&d!=="All Sarees"&&e.push(d);const t=e.length?` | ${e.join(" Â· ")}`:"";Ae({title:`Mrigmaya | Shop sarees${t}`,description:"Explore Mrigmaya edits: handcrafted silks, chiffons, Banarasis, and contemporary drapes with concierge support and fast pan-India delivery."})},[_,d]),l.useEffect(()=>{const e=new URLSearchParams(u.search);if(!(e.has("moodId")||e.has("ids")||e.has("collectionSlug")))return;const c=document.querySelector(".product-area");c&&setTimeout(()=>c.scrollIntoView({behavior:"smooth",block:"start"}),80)},[u.search]),l.useEffect(()=>{let e=!0;return Q(!0),O.get("/products?includeInactive=true").then(t=>{var c;e&&(de(Array.isArray(t.data)?t.data:((c=t.data)==null?void 0:c.products)||[]),X(""))}).catch(()=>{e&&X("We could not load the sarees. Please try again.")}).finally(()=>e&&Q(!1)),()=>{e=!1}},[]),l.useEffect(()=>{const e=N.reduce((c,n)=>{const a=n.discountPrice||n.price||0;return a>c?a:c},0),t=Math.max(e,6e3);xe(t),fe(t),F(t)},[N]),l.useEffect(()=>{const e=new URLSearchParams(u.search),t=e.get("ids"),c=e.get("collectionSlug"),n=e.get("moodId"),a=e.get("search")||"";$(a),ee(t?t.split(",").map(r=>r.trim()).filter(Boolean):[]),se(c||""),S(n||""),ge(n||"")},[u.search]),l.useEffect(()=>{O.get("/collections").then(e=>ue(e.data||[])).catch(()=>{})},[]),l.useEffect(()=>{O.get("/home-sections").then(e=>{const t=(e.data||[]).filter(c=>c.group==="category"&&c.active!==!1).sort((c,n)=>(c.order??0)-(n.order??0));he(t),me(!0),v&&t.length>0&&!t.find(c=>c._id===v)&&S("")}).catch(()=>{})},[v]),l.useEffect(()=>{const e=v||U;if(!e||!te||!f.length)return;const t=f.find(c=>c._id===e);t!=null&&t.title&&C(t.title)},[v,U,f,te]),l.useEffect(()=>{const e=_||V;if(!e||!m.length)return;const t=m.find(c=>c.slug===e);t?(b(t._id),C("All Sarees")):b("")},[V,m,_]),l.useEffect(()=>{const e=f.map(r=>r.title).filter(Boolean),t=(N||[]).map(r=>{var i;return(r.category||"").trim()||(((i=r.categoryRef)==null?void 0:i.name)||"").trim()}).filter(Boolean),c=(m||[]).map(r=>r.title).filter(Boolean),a=["All Sarees",...Array.from(new Set([...e,...t,...c].filter(Boolean)))];pe(a),(a.length===1||d!=="All Sarees"&&!a.includes(d))&&(C("All Sarees"),S(""))},[N,f,m,d]);const w=l.useMemo(()=>{var c,n;let e=[...N];const t=!!g;if(R.length&&(e=e.filter(a=>R.includes(a._id)||R.includes(a.productId))),g){const a=f.find(r=>r._id===g);if(a){const r=((c=a.meta)==null?void 0:c.products)||a.productIds||[],i=a.slug,j=a.title||"";r.length?e=e.filter(h=>r.includes(h._id)||r.includes(h.productId)):i?e=e.filter(h=>(h.collections||[]).some(o=>(o.slug||o)===i||(o._id||o)===i)):a.title&&(e=e.filter(h=>{var o;return[h.category||"",((o=h.categoryRef)==null?void 0:o.name)||"",...(h.collections||[]).map(k=>(k==null?void 0:k.title)||"")].join(" ").toLowerCase().includes(j.toLowerCase())}))}}if(!t&&d&&d!=="All Sarees"){const a=d.toLowerCase();e=e.filter(r=>{var j,h;return[r.category||"",((j=r.categoryRef)==null?void 0:j.name)||"",((h=r.categoryRef)==null?void 0:h.slug)||"",...(r.collections||[]).map(o=>(o==null?void 0:o.title)||(o==null?void 0:o.slug)||"")].join(" ").toLowerCase().includes(a)})}if(p&&(e=e.filter(a=>(a.collections||[]).some(r=>(r._id||r)===p))),t||(e=e.filter(a=>(a.discountPrice||a.price||0)<=x)),y.trim()&&(e=e.filter(a=>(a.name||"").toLowerCase().includes(y.trim().toLowerCase()))),I==="priceLow"?e.sort((a,r)=>(a.discountPrice||a.price||0)-(r.discountPrice||r.price||0)):I==="priceHigh"?e.sort((a,r)=>(r.discountPrice||r.price||0)-(a.discountPrice||a.price||0)):I==="new"&&e.sort((a,r)=>new Date(r.createdAt||0)-new Date(a.createdAt||0)),e.length===0&&g){const a=f.find(i=>i._id===g),r=((n=a==null?void 0:a.meta)==null?void 0:n.customProducts)||[];if(r.length)return r.map((i,j)=>{if(i.productId){const ie=N.find(ve=>ve._id===i.productId);if(ie)return ie}const h=Array.isArray(i.images)&&i.images.length?i.images:[i.image||""],o=oe(i.price||i.sellingPrice||i.discountPrice),k=oe(i.mrp||i.originalPrice||i.priceMrp),le=k>o&&o>0,ce=i.productId||`custom-${j}`;return{_id:ce,productId:ce,isCustom:!0,name:i.name||"Custom item",price:le?k:o,discountPrice:le?o:void 0,images:h,category:(a==null?void 0:a.title)||"Edit item"}})}return e},[N,d,x,y,I,p,R,v,f]);l.useEffect(()=>{q(1)},[w]),l.useEffect(()=>{const e=document.querySelector(".product-area");e?e.scrollIntoView({behavior:"auto",block:"start"}):window.scrollTo({top:0,behavior:"auto"})},[P]);const L=l.useMemo(()=>{const e=Math.ceil(w.length/z)||1;return Math.min(Ce,e)},[w.length]),W=l.useMemo(()=>{const t=(Math.min(Math.max(P,1),L)-1)*z;return w.slice(t,t+z)},[w,P,L]),G=()=>{C("All Sarees"),S(""),b(""),F(T),Z("new"),$("")};return s.jsx("div",{className:"collection-page",children:s.jsxs("section",{className:"collection-body",children:[s.jsxs("div",{className:"product-area",children:[s.jsxs("div",{className:"product-toolbar",children:[s.jsxs("div",{className:"toolbar-copy",children:[s.jsx(ke,{compact:!0,message:""}),s.jsxs("div",{className:"meta",children:[s.jsx("span",{children:`${w.length} styles ready to ship`}),s.jsx("span",{className:"meta-dot"}),s.jsx("span",{children:`Cap ${M(x)}`}),p?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"meta-dot"}),s.jsx("span",{children:((ae=m.find(e=>e._id===p))==null?void 0:ae.title)||"Collection"})]}):null]})]}),s.jsxs("div",{className:"toolbar-actions",children:[s.jsxs("div",{className:"quick-filters",children:[s.jsx("button",{className:"pill pill--ghost",onClick:()=>D(!0),children:"Category"}),s.jsx("button",{className:"pill pill--ghost",onClick:()=>H(!0),children:"Filters"})]}),s.jsxs("div",{className:"search-shell",children:[s.jsx("span",{className:"search-icon",children:"Search"}),s.jsx("input",{type:"text",placeholder:"Prints, fabrics, hues...",value:y,onChange:e=>$(e.target.value)})]})]})]}),J&&s.jsx("p",{className:"error",children:J}),s.jsx("div",{className:"tag-strip",children:(p||d&&d!=="All Sarees"||!g&&x!==T||y.trim())&&s.jsxs(s.Fragment,{children:[d&&d!=="All Sarees"&&s.jsxs("span",{className:"tag-chip",onClick:()=>C("All Sarees"),children:[d," Ã—"]}),p&&s.jsxs("span",{className:"tag-chip",onClick:()=>b(""),children:[((re=m.find(e=>e._id===p))==null?void 0:re.title)||"Collection"," Ã—"]}),!g&&x!==T&&s.jsxs("span",{className:"tag-chip",onClick:()=>F(T),children:["Cap ",M(x)," Ã—"]}),y.trim()&&s.jsxs("span",{className:"tag-chip",onClick:()=>$(""),children:["â€œ",y.trim(),"â€ Ã—"]}),s.jsx("button",{className:"tag-chip tag-chip--clear",onClick:G,children:"Clear all"})]})}),s.jsxs("div",{className:"product-grid",children:[E&&Array.from({length:8}).map((e,t)=>s.jsx("div",{className:"product-card skeleton"},t)),!E&&W.length===0&&s.jsxs("div",{className:"empty-state",children:[s.jsx("p",{children:"No sarees match these filters yet."}),s.jsx("p",{className:"text-sm text-gray-500",children:"Try clearing filters or searching a simpler term."}),s.jsx("button",{onClick:G,className:"px-4 py-2 rounded-full border border-gray-200 text-sm font-semibold",children:"Clear filters"})]}),!E&&W.map(e=>{const t=!!e.isCustom,c=e.productId||e._id,n=!t||!!e.productId,a=e.discountPrice||e.price,r=!!(e.discountPrice&&e.discountPrice!==e.price),i=r?Math.round((e.price-e.discountPrice)/e.price*100):null,j=i?`-${i}%`:"New",h=async o=>{o.stopPropagation(),!(!c||!e.productId&&t)&&await B(c)};return s.jsxs("article",{className:"product-card",onClick:()=>{n&&A(`/product/${c}`)},children:[s.jsxs("div",{className:"card-image",children:[s.jsx("img",{src:ne(e),alt:e.name,className:"card-image__img",loading:"lazy",decoding:"async"}),s.jsx("img",{src:ne(e,1),alt:e.name,className:"card-image__img card-image__img--hover",loading:"lazy",decoding:"async"}),s.jsx("span",{className:"card-badge",children:j}),n&&s.jsx("button",{type:"button",className:"card-icon-btn",onClick:h,"aria-label":"Add to cart",children:"ðŸ›’"})]}),s.jsxs("div",{className:"card-body",children:[s.jsx("p",{className:"card-category",children:e.category||"Saree"}),s.jsx("h3",{children:e.name}),s.jsxs("div",{className:"card-meta",children:[s.jsx("span",{children:"Ready to ship"}),e.fabric&&s.jsx("span",{children:e.fabric})]}),s.jsxs("div",{className:"card-price",children:[s.jsx("strong",{children:M(a)}),r&&s.jsx("span",{children:M(e.price)})]})]})]},e._id)})]}),!E&&W.length>0&&s.jsxs("div",{className:"pagination-controls",children:[s.jsx("button",{type:"button",className:"pill pill--ghost",onClick:()=>q(e=>Math.max(1,e-1)),disabled:P===1,children:"Previous"}),s.jsx("span",{className:"pagination-meta",children:`Page ${P} of ${L}`}),s.jsx("button",{type:"button",className:"pill pill--ghost",onClick:()=>q(e=>Math.min(L,e+1)),disabled:P===L,children:"Next"})]})]}),je&&s.jsx("div",{className:"sheet-backdrop",onClick:()=>D(!1),children:s.jsxs("div",{className:"filter-panel sheet",onClick:e=>{e.stopPropagation()},children:[s.jsxs("div",{className:"sheet-header",children:[s.jsx("h3",{children:"Category"}),s.jsx("button",{className:"close-sheet",onClick:()=>D(!1),children:"Close"})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Category"}),s.jsx("div",{className:"filter-pills",children:K.map(e=>s.jsx("button",{className:e===d?"pill active":"pill",onClick:()=>{C(e);const t=f.find(c=>{var n;return((n=c.title)==null?void 0:n.toLowerCase())===e.toLowerCase()});S((t==null?void 0:t._id)||""),D(!1)},children:e},e))})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Sort"}),s.jsx("div",{className:"select-shell select-shell--sheet",children:s.jsx("select",{value:I,onChange:e=>Z(e.target.value),children:_e.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})})]})]})}),Ne&&s.jsx("div",{className:"sheet-backdrop",onClick:()=>H(!1),children:s.jsxs("div",{className:"filter-panel sheet",onClick:e=>{e.stopPropagation()},children:[s.jsxs("div",{className:"sheet-header",children:[s.jsx("h3",{children:"Filters"}),s.jsx("button",{className:"close-sheet",onClick:()=>H(!1),children:"Close"})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Category"}),s.jsx("div",{className:"filter-pills",children:K.map(e=>s.jsx("button",{className:e===d?"pill active":"pill",onClick:()=>{C(e);const t=f.find(c=>{var n;return((n=c.title)==null?void 0:n.toLowerCase())===e.toLowerCase()});S((t==null?void 0:t._id)||"")},children:e},e))})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Collections"}),s.jsxs("div",{className:"filter-pills",children:[s.jsx("button",{className:p?"pill":"pill active",onClick:()=>b(""),children:"All"}),m.map(e=>s.jsx("button",{className:p===e._id?"pill active":"pill",onClick:()=>b(p===e._id?"":e._id),children:e.title},e._id))]})]}),s.jsxs("div",{className:"filter-card",children:[s.jsx("p",{className:"filter-label",children:"Budget cap"}),s.jsx("input",{type:"range",min:"0",max:Math.max(1e3,Y),step:"100",value:g?Math.max(1e3,Y):x,onChange:e=>{g||F(Number(e.target.value))}}),s.jsx("div",{className:"price-display",children:g?"Budget cap disabled for this edit":`Up to ${M(x)}`})]}),s.jsxs("div",{className:"filter-footer",children:[s.jsx("button",{onClick:()=>{G(),H(!1)},children:"Reset filters"}),s.jsx("p",{children:"Need help styling? WhatsApp our saree expert."})]})]})})]})})}export{Ee as default};
