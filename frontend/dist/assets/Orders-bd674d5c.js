import{r as l,A as pe,C as me,u as ge,i as h,j as e,L as se,b as he,z as m}from"./index-341cd16a.js";const ae=a=>`Rs. ${new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(a||0)}`,ie="data:image/gif;base64,R0lGODlhAQABAAD/ACw=",be=a=>{var d;return he((d=a==null?void 0:a.images)==null?void 0:d[0],ie)},re={processing:"Processing",packed:"Packed",shipped:"Shipped",delivered:"Delivered",cancelled:"Cancelled"},ne={none:"No return",requested:"Return requested",approved:"Return approved",rejected:"Return rejected",received:"Item received",refunded:"Refunded"},ye=a=>{if(a.status!=="delivered")return!1;const d=a.createdAt?new Date(a.createdAt).getTime():0;return(Date.now()-d)/(1e3*60*60*24)<=7},fe={cod_pending:"Awaiting COD",awaiting_upi:"Awaiting UPI",awaiting_gateway:"Awaiting gateway",paid:"Paid",cancelled:"Cancelled"},je=a=>a!=null&&a.trackingLink&&a.trackingLink.startsWith("http")?a.trackingLink:a!=null&&a.trackingNumber&&a.trackingNumber.startsWith("http")?a.trackingNumber:null;function ve(){const{token:a,user:d}=l.useContext(pe),{addToCart:_}=l.useContext(me),A=ge(),[b,$]=l.useState([]),[le,D]=l.useState(!0),[q,O]=l.useState(""),[g,R]=l.useState(1),[y,C]=l.useState(1),[I,B]=l.useState(!1),[ce,S]=l.useState(null),[P,f]=l.useState(""),[T,j]=l.useState(""),[U,N]=l.useState(null),[E,F]=l.useState(!1),[v,de]=l.useState(null),x=a||localStorage.getItem("token");l.useEffect(()=>{if(!x){A("/login");return}let t=!0;return D(!0),h.get(`/orders?page=${g}&limit=10`,{headers:{Authorization:`Bearer ${x}`}}).then(r=>{if(!t)return;const s=r.data,n=Array.isArray(s)?s:s==null?void 0:s.orders;$(n||[]),s!=null&&s.totalPages?C(s.totalPages):C(1),O("")}).catch(()=>{t&&O("Could not load your orders right now.")}).finally(()=>t&&D(!1)),()=>{t=!1}},[x,A,g]);const z=["processing","packed","shipped","delivered"],M=l.useMemo(()=>[...b].sort((t,r)=>new Date(r.createdAt)-new Date(t.createdAt)),[b]),W=l.useMemo(()=>{const t=[];return b.forEach(r=>{const s=r.shippingAddress||{},n=`${s.name||""}-${s.phone||""}-${s.line1||""}-${s.city||""}-${s.pincode||""}`;s.name&&!t.find(c=>c.key===n)&&t.push({key:n,...s})}),t},[b]),oe=async t=>{var r;try{const s=t.items||[];for(const n of s){const c=((r=n.product)==null?void 0:r._id)||n.product;c&&await _(c,n.quantity||1)}m.success("Items added to cart"),A("/cart")}catch(s){console.error(s),m.error("Could not add items to cart")}},xe=async t=>{try{const r=await h.get(`/orders/${t}/invoice`,{headers:{Authorization:`Bearer ${x}`},responseType:"blob"}),s=new Blob([r.data],{type:"application/pdf"}),n=window.URL.createObjectURL(s),c=document.createElement("a");c.href=n,c.download=`invoice-${t.slice(-6)}.pdf`,document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(n)}catch(r){console.error(r),m.error("Could not download invoice")}},ue=async t=>{var r,s;if(!P.trim()){m.error("Please add a reason");return}B(!0);try{let n="";if(U){F(!0);const p=new FormData;p.append("file",U),n=(await h.post("/uploads",p,{headers:{Authorization:`Bearer ${x}`,"Content-Type":"multipart/form-data"}})).data.url}await h.post(`/orders/${t}/return-request`,{reason:P.trim(),note:T.trim(),images:n?[n]:[]},{headers:{Authorization:`Bearer ${x}`}}),m.success("Return request submitted"),R(1);const o=(await h.get("/orders?page=1&limit=10",{headers:{Authorization:`Bearer ${x}`}})).data,k=Array.isArray(o)?o:o==null?void 0:o.orders;$(k||[]),C((o==null?void 0:o.totalPages)||1)}catch(n){console.error(n),m.error(((s=(r=n.response)==null?void 0:r.data)==null?void 0:s.msg)||"Could not submit return request")}finally{B(!1),F(!1),de({orderId:t,message:"Return request submitted"}),S(null),f(""),j(""),N(null)}};return x?e.jsx("div",{className:"bg-[#fefbfe] min-h-screen",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-10 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-500",children:"Your orders"}),e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Track and manage"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Status updates appear here as soon as admin changes them."})]}),e.jsx(se,{to:"/products",className:"text-sm text-pink-600 font-semibold border border-pink-100 rounded-full px-4 py-2",children:"Continue shopping"})]}),W.length>0&&e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-3",children:W.map(t=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-3 text-sm text-gray-700",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("p",{children:t.line1}),t.line2&&e.jsx("p",{children:t.line2}),e.jsxs("p",{children:[t.city,", ",t.state," ",t.pincode]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Phone: ",t.phone]})]},t.key))}),le?e.jsx("div",{className:"grid gap-4",children:Array.from({length:3}).map((t,r)=>e.jsx("div",{className:"h-32 bg-white rounded-3xl animate-pulse"},r))}):q?e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-2xl p-4 text-sm",children:q}):M.length===0?e.jsxs("div",{className:"bg-white border border-gray-100 rounded-3xl p-8 text-center space-y-3",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No orders found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"If you just placed an order, refresh once. Orders show only for the account youâ€™re signed in with."}),e.jsx(se,{to:"/products",className:"inline-flex items-center justify-center px-5 py-3 bg-pink-600 text-white rounded-full text-sm font-semibold",children:"Browse sarees"})]}):e.jsxs("div",{className:"space-y-4",children:[M.map(t=>{var L,G,Q,K,Y,H,J,V,X;const r=t.status||"processing",s=t.paymentStatus||"cod_pending",n=t.createdAt?new Date(t.createdAt).toLocaleString():"",c=z.indexOf(r),o=t.items||[],k=je(t),p=t.trackingLink||t.trackingNumber;return e.jsxs("div",{className:"bg-white border border-gray-100 rounded-3xl p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:["ORDER #",(G=(L=t._id)==null?void 0:L.slice(-6))==null?void 0:G.toUpperCase()]}),e.jsx("p",{className:"text-sm text-gray-500",children:n})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"px-3 py-1 rounded-full bg-amber-50 text-amber-700 text-xs font-semibold border border-amber-100",children:re[r]||r}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-semibold border border-emerald-100",children:fe[s]||s}),e.jsx("button",{onClick:()=>xe(t._id),className:"text-[var(--primary)] text-xs font-semibold underline",type:"button",children:"Download bill"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[z.map((i,u)=>{const w=c>=u;return e.jsx("div",{className:`px-3 py-2 rounded-full text-xs font-semibold border ${w?"bg-pink-600 text-white border-pink-600":"bg-gray-50 text-gray-500 border-gray-200"}`,children:re[i]},i)}),t.returnStatus&&t.returnStatus!=="none"&&e.jsx("span",{className:"px-3 py-2 rounded-full text-xs font-semibold border bg-amber-50 text-amber-700 border-amber-100",children:ne[t.returnStatus]||t.returnStatus})]}),e.jsxs("div",{className:"grid md:grid-cols-[2fr,1fr] gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[o.map(i=>{var u,w,Z,ee,te;return e.jsxs("div",{className:"flex items-center justify-between text-sm border-b border-gray-100 py-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:(w=(u=i.product)==null?void 0:u.images)!=null&&w.length?be(i.product):ie,alt:((Z=i.product)==null?void 0:Z.name)||"Product",className:"w-14 h-14 object-cover rounded-xl border border-gray-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:((ee=i.product)==null?void 0:ee.name)||"Product"}),e.jsxs("p",{className:"text-gray-500",children:["Qty: ",i.quantity]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold text-gray-900",children:ae((i.price||0)*(i.quantity||1))})})]},i._id||((te=i.product)==null?void 0:te._id)||Math.random())}),e.jsx("button",{type:"button",onClick:()=>oe(t),className:"inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-semibold bg-white border border-pink-200 text-pink-600 hover:bg-pink-50",children:"Reorder these items"}),t.status==="delivered"&&(t.returnStatus==="none"||t.returnStatus==="rejected")&&e.jsx("div",{className:"mt-3 space-y-2",children:ye(t)?e.jsxs(e.Fragment,{children:[(v==null?void 0:v.orderId)===t._id&&e.jsx("p",{className:"text-xs text-emerald-600",children:v.message}),ce===t._id?e.jsxs("div",{className:"space-y-2 bg-white border border-pink-100 rounded-2xl p-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Reason"}),e.jsx("textarea",{value:P,onChange:i=>f(i.target.value),className:"border rounded-xl px-3 py-2 w-full text-sm",rows:2,placeholder:"Why are you returning?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Note (optional)"}),e.jsx("textarea",{value:T,onChange:i=>j(i.target.value),className:"border rounded-xl px-3 py-2 w-full text-sm",rows:2,placeholder:"Any extra details"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Photo (optional)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:i=>{var u;return N(((u=i.target.files)==null?void 0:u[0])||null)},className:"text-xs"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>ue(t._id),disabled:I||E,className:"inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-semibold bg-pink-600 text-white hover:bg-pink-700 disabled:opacity-60",children:I||E?"Submitting...":"Submit return"}),e.jsx("button",{type:"button",onClick:()=>{S(null),f(""),j(""),N(null)},className:"inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-semibold bg-white border border-gray-200 text-gray-700 hover:bg-gray-50",children:"Cancel"})]})]}):e.jsx("button",{type:"button",onClick:()=>{S(t._id),f(""),j(""),N(null)},className:"inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-semibold bg-white border border-pink-200 text-pink-600 hover:bg-pink-50 disabled:opacity-60",children:"Request return"})]}):e.jsx("p",{className:"text-xs text-gray-400",children:"Return window (7 days) has expired."})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-3 space-y-2 text-sm text-gray-700",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Delivery"}),e.jsx("p",{className:"text-gray-600",children:((Q=t.shippingAddress)==null?void 0:Q.name)||(d==null?void 0:d.name)||"Customer"}),e.jsx("p",{className:"text-gray-500",children:((K=t.shippingAddress)==null?void 0:K.phone)||(d==null?void 0:d.mobile)}),e.jsx("p",{className:"text-gray-500",children:[(Y=t.shippingAddress)==null?void 0:Y.line1,(H=t.shippingAddress)==null?void 0:H.line2].filter(Boolean).join(", ")}),e.jsxs("p",{className:"text-gray-500",children:[[(J=t.shippingAddress)==null?void 0:J.city,(V=t.shippingAddress)==null?void 0:V.state].filter(Boolean).join(", "),(X=t.shippingAddress)!=null&&X.pincode?` - ${t.shippingAddress.pincode}`:""]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Total"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:ae(t.amount)}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Payment: ",t.paymentMethod||"COD"]}),(p||t.carrier)&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Tracking"}),e.jsxs("div",{className:"flex items-center flex-wrap gap-3",children:[p&&e.jsx("span",{className:"text-xs text-gray-600 break-all",children:p}),k&&e.jsx("a",{href:k,target:"_blank",rel:"noreferrer",className:"text-xs text-pink-600 underline",children:"Track shipment"}),t.carrier&&e.jsx("span",{className:"text-xs text-gray-500 border border-gray-200 rounded-full px-3 py-1",children:t.carrier})]})]}),t.returnStatus&&t.returnStatus!=="none"&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-gray-400",children:"Return"}),e.jsx("p",{className:"text-xs text-gray-600",children:ne[t.returnStatus]||t.returnStatus}),t.returnReason&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Reason: ",t.returnReason]}),t.returnNote&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Note: ",t.returnNote]})]})]})]})]})]},t._id)}),y>1&&e.jsxs("div",{className:"flex items-center justify-center gap-3 pt-2",children:[e.jsx("button",{className:"px-3 py-2 border rounded-full text-sm",onClick:()=>R(t=>Math.max(1,t-1)),disabled:g===1,children:"Prev"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",g," of ",y]}),e.jsx("button",{className:"px-3 py-2 border rounded-full text-sm",onClick:()=>R(t=>Math.min(y,t+1)),disabled:g===y,children:"Next"})]})]})]})}):null}export{ve as default};
